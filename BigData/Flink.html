<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 15">
<meta name=Originator content="Microsoft Word 15">
<link rel=File-List href="Flink.files/filelist.xml">
<link rel=Edit-Time-Data href="Flink.files/editdata.mso">
<link rel=dataStoreItem href="Flink.files/item0001.xml"
target="Flink.files/props002.xml">
<link rel=themeData href="Flink.files/themedata.thmx">
<link rel=colorSchemeMapping href="Flink.files/colorschememapping.xml">

<link href="./css/treemenu.css" rel="stylesheet" type="text/css">
<!-- GitHub Pages只认./js/xxx这种相对定位，不认js/xxx这种 -->
<script src="./js/jquery-3.4.1.min.js"></script>
<script src="./js/test.js"></script>
<script src="./js/treemenu.js"></script>
</head>

<body bgcolor=white lang=ZH-CN link=blue vlink=purple style='tab-interval:21.0pt;
text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<div id="noScroll" class="divcss5-right">
	<ul id="menuId" class="tree">
	</ul>
	<div style="font-size: 10px; color: #161FB0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 （Ctrl+滚动鼠标可缩放页面）</div>
</div> 

<p class=MsoNormal align=center style='text-align:center;mso-line-height-alt:
11.0pt'><span lang=EN-US style='font-size:22.0pt'>Flink<o:p></o:p></span></p>

<p class=MsoNormal align=right style='text-align:right;mso-line-height-alt:
11.0pt'><span lang=EN-US style='font-size:12.0pt'><span
style='mso-spacerun:yes'> </span></span><span style='font-size:12.0pt;
font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>作者：尚硅谷章鹏</span><span lang=EN-US style='font-size:12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=right style='text-align:right;mso-line-height-alt:
11.0pt'><span style='font-size:12.0pt;mso-bidi-font-size:11.0pt;font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>整理：小邹</span><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:11.0pt'>[yw_forgit@163.com]</span><span
lang=EN-US style='font-size:12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;mso-line-height-alt:
11.0pt'><span lang=EN-US style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=center style='text-align:center;mso-line-height-alt:
11.0pt'><span style='font-size:12.0pt;font-family:"微软雅黑","sans-serif";
mso-hansi-font-family:"Times New Roman";mso-bidi-font-family:微软雅黑;mso-font-kerning:
0pt'>版本：<span lang=EN-US>V1.0<o:p></o:p></span></span></p>

<h1 style='margin-left:77.25pt;text-indent:-77.25pt;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='mso-bidi-font-family:宋体'><span style='mso-list:Ignore'>第一章<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>概述</span></h1>

<h2 style='margin-left:30.0pt;text-indent:-30.0pt;mso-list:l15 level2 lfo3'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial;mso-bidi-font-family:Arial'><span
style='mso-list:Ignore'>1.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>流处理技术的演变</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在开源世界里，</span><span lang=EN-US>Apache Storm</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>项目是流处理的先锋。</span><span lang=EN-US>Storm</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>最早由</span><span lang=EN-US>Nathan Marz</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>和创业公司</span><span lang=EN-US>BackType</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的一个团队开发，后来才被</span><span lang=EN-US>Apache</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>基金会接纳。</span><span lang=EN-US>Storm</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>提供了低延迟的流处理，但是它为实时性付出了一些代价：<b style='mso-bidi-font-weight:
normal'><span style='color:red'>很难实现高吞吐</span></b>，并且其正确性没能达到通常所需的水平，换句话说，它<b
style='mso-bidi-font-weight:normal'><span style='color:red'>并不能保证</span></b></span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>exactly-once</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>（精确一致性）</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，即便是它能够保证的正确性级别，其开销也相当大。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在低延迟和高吞吐的流处理系统中维持良好的容错性是非常困难的，但是为了得到有保障的准确状态，人们想到了一种替代方法：<b
style='mso-bidi-font-weight:normal'><span style='color:red'>将连续时间中的流数据分割成一系列微小的批量作业</span></b>。如果分割得足够小（即所谓的微批处理作业），计算就几乎可以实现真正的流处理。因为存在延迟，所以不可能做到完全实时，但是每个简单的应用程序都可以实现仅有几秒甚至几亚秒的延迟。这就是在</span><span
lang=EN-US>Spark</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>批处理引擎上运行的</span><span lang=EN-US>Spark
Streaming</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>所使用的方法。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>更重要的是，使用微批处理方法，可以实现</span><span lang=EN-US>exactly-once</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>语义，从而保障状态的一致性。如果一个微批处理失败了，它可以重新运行，这比连续的流处理方法更容易。</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Storm Trident</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>是对</span><span
lang=EN-US style='color:red'>Storm</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的延伸，它的底层流处理引擎就是基于微批处理方法来进行计算的，从而实现了</span><span
lang=EN-US style='color:red'>exactly-once</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>语义，但是在延迟性方面付出了很大的代价</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>对于</span><span lang=EN-US>Storm Trident</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>以及</span><span lang=EN-US>Spark Streaming</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>等微批处理策略，只能根据批量作业时间的倍数进行分割，无法根据实际情况分割事件数据，并且，对于一些对延迟比较敏感的作业，往往需要开发者在写业务代码时花费大量精力来提升性能。这些灵活性和表现力方面的缺陷，使得这些微批处理策略开发速度变慢，运维成本变高。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>于是，</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>出现了，这一技术框架可以避免上述弊端，并且拥有所需的诸多功能，还能按照连续事件高效地处理数据，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的部分特性如下图所示：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shapetype id="_x0000_t75"
 coordsize="21600,21600" o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe"
 filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="图片_x0020_1" o:spid="_x0000_i1025" type="#_x0000_t75"
 style='width:274.8pt;height:178.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image001.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=458 height=298
src="Flink.files/image001.png" v:shapes="图片_x0020_1"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的部分特性</span></p>

<h2><span lang=EN-US>1.2 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>初识</span><span lang=EN-US>Flink</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>起源于</span><span lang=EN-US>Stratosphere</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>项目，</span><span lang=EN-US>Stratosphere</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是在</span><span lang=EN-US>2010~2014</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>年由</span><span lang=EN-US>3</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>所地处柏林的大学和欧洲的一些其他的大学共同进行的研究项目，</span><span
lang=EN-US>2014</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>年</span><span lang=EN-US>4</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>月</span><span lang=EN-US>Stratosphere</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的代码被复制并捐赠给了</span><span lang=EN-US>Apache</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>软件基金会，参加这个孵化项目的初始成员是</span><span lang=EN-US>Stratosphere</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>系统的核心开发人员，</span><span lang=EN-US>2014</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>年</span><span lang=EN-US>12</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>月，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>一跃成为</span><span lang=EN-US>Apache</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>软件基金会的顶级项目。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在德语中，</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>一词表示快速和灵巧，项目采用一只松鼠的彩色图案作为</span><span lang=EN-US>logo</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，这不仅是因为松鼠具有快速和灵巧的特点，还因为柏林的松鼠有一种迷人的红棕色，而</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的松鼠</span><span lang=EN-US>logo</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>拥有可爱的尾巴，尾巴的颜色与</span><span lang=EN-US>Apache</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>软件基金会的</span><span lang=EN-US>logo</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>颜色相呼应，也就是说，这是一只</span><span lang=EN-US>Apache</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>风格的松鼠。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1026"
 type="#_x0000_t75" style='width:178.8pt;height:73.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image003.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=298 height=122
src="Flink.files/image003.png" v:shapes="_x0000_i1026"><![endif]><span
style='mso-tab-count:1'>   </span><!--[if gte vml 1]><v:shape id="_x0000_i1027"
 type="#_x0000_t75" style='width:110.4pt;height:109.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image005.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=184 height=183
src="Flink.files/image005.png" v:shapes="_x0000_i1027"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink Logo</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>主页在其顶部展示了该项目的理念：“</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:red'>Apache Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>是为分布式、高性能、随时可用以及准确的流处理应用程序打造的开源流处理框架</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>”。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Apache
Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是一个框架和分布式处理引擎，用于对无界和有界数据流进行有状态计算。</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>被设计在所有常见的集群环境中运行，以内存执行速度和任意规模来执行计算。</span></p>

<h2 style='margin-left:30.0pt;text-indent:-30.0pt;mso-list:l11 level2 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial;mso-bidi-font-family:Arial'><span
style='mso-list:Ignore'>1.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>批处理与流处理</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>批处理的特点是有界、持久、大量，批处理非常适合需要访问全套记录才能完成的计算工作，一般用于离线统计。流处理的特点是无界、实时，流处理方式无需针对整个数据集执行操作，而是对通过系统传输的每个数据项执行操作，一般用于实时统计。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>Spark</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>生态体系中，对于批处理和流处理采用了不同的技术框架，批处理由</span><span
lang=EN-US>SparkSQL</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>实现，流处理由</span><span
lang=EN-US>Spark Streaming</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>实现，这也是大部分框架采用的策略，使用独立的处理器实现批处理和流处理，而</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>可以同时实现批处理和流处理。</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>   
</span>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是如何同时实现批处理与流处理的呢？答案是，</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Flink</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>将批处理（即处理有限的静态数据）视作一种特殊的流处理</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>   
</span>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的核心计算架构是下图中的</span><span lang=EN-US>Flink
Runtime</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>执行引擎，它是一个分布式系统，能够接受数据流程序并在一台或多台机器上以容错方式执行。</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>    </span>Flink
Runtime</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>执行引擎可以作为</span><span lang=EN-US>YARN</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（</span><span lang=EN-US>Yet Another Resource Negotiator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）的应用程序在集群上运行，也可以在</span><span lang=EN-US>Mesos</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>集群上运行，还可以在单机上运行（这对于调试</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>应用程序来说非常有用）。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1028"
 type="#_x0000_t75" style='width:360.6pt;height:219pt'>
 <v:imagedata src="Flink.files/image007.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\9116fe36-ac5c-4bcd-9e47-f4e8c9f74b26\128\index_files\463338b7-6cd7-45dd-aced-0e594e9170b4.png"/>
</v:shape><![endif]--><![if !vml]><img width=601 height=365
src="Flink.files/image008.png" v:shapes="_x0000_i1028"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>计算架构</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>上图为</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>技术栈的核心组成部分，值得一提的是，</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>分别提供了面向流式处理的接口（</span><span
lang=EN-US style='color:red'>DataStream API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>）和面向批处理的接口（</span><span
lang=EN-US style='color:red'>DataSet API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>）</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。因此，</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>既可以完成流处理，也可以完成批处理。</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>支持的拓展库涉及机器学习（</span><span lang=EN-US>FlinkML</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）、复杂事件处理（</span><span lang=EN-US>CEP</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）、以及图计算（</span><span lang=EN-US>Gelly</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），还有分别针对流处理和批处理的</span><span lang=EN-US>Table API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>能被</span><span lang=EN-US>Flink Runtime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>执行引擎接受的程序很强大，但是这样的程序有着冗长的代码，编写起来也很费力，基于这个原因，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>提供了封装在</span><span lang=EN-US>Runtime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>执行引擎之上的</span><span lang=EN-US>API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，以帮助用户方便地生成流式计算程序。</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:red'>Flink </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>提供了用于流处理的</span><span
lang=EN-US style='color:red'>DataStream API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>和用于批处理的</span><span
lang=EN-US style='color:red'>DataSet API</span></b><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。值得注意的是，尽管</span><span
lang=EN-US>Flink Runtime</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>执行引擎是基于流处理的，但是</span><span
lang=EN-US>DataSet API</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>先于</span><span
lang=EN-US>DataStream API</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>被开发出来，这是因为工业界对无限流处理的需求在</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>诞生之初并不大。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>DataStream
API</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>可以流畅地分析无限数据流，并且可以用</span><span
lang=EN-US>Java</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>或者</span><span lang=EN-US>Scala</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>来实现。开发人员需要基于一个叫</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的数据结构来开发，这个数据结构用于表示永不停止的分布式数据流。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的分布式特点体现在它能够在成百上千台机器上运行，它将大型的计算任务分成许多小的部分，每个机器执行一部分。</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>能够自动地确保发生机器故障或者其他错误时计算能够持续进行，或者在修复</span><span
lang=EN-US>bug</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>或进行版本升级后有计划地再执行一次。这种能力使得开发人员不需要担心运行失败。</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>本质上使用容错性数据流，这使得开发人员可以分析持续生成且永远不结束的数据（即流处理）。</span></p>

<h1 style='margin-left:77.25pt;text-indent:-77.25pt;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='mso-bidi-font-family:宋体'><span style='mso-list:Ignore'>第二章<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>基本架构</span></h1>

<h2><span lang=EN-US>2.5 JobManager</span><span style='font-family:黑体;
mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>与</span><span
lang=EN-US>TaskManager</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>运行时包含了两种类型的处理器（这是两个</span><span lang=EN-US>JVM</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进程）：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US>JobManager</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>处理器：</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>也称之为</span><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（更新</span><span lang=EN-US>Driver</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），用于协调分布式执行，它们用来调度</span><span lang=EN-US>task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，协调检查点，协调失败时恢复等。</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>运行时至少存在一个</span><span lang=EN-US>master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>处理器，如果配置高可用模式则会存在多个</span><span lang=EN-US>master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>处理器，它们其中有一个是</span><span lang=EN-US>leader</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，而其他的都是</span><span lang=EN-US>standby</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>TaskManager</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>处理器</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：也称之为</span><span lang=EN-US>Worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（其实更像是</span><span lang=EN-US>Execute</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，这是进程，</span><span lang=EN-US>Worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是一个节点），用于执行一个</span><span lang=EN-US>dataflow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>task(</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>或者特殊的</span><span
lang=EN-US>subtask)</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、数据缓冲和</span><span
lang=EN-US>data stream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的交换，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>运行时至少会存在一个</span><span lang=EN-US>worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>处理器。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1029"
 type="#_x0000_t75" style='width:313.8pt;height:138.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image009.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img width=523 height=231
src="Flink.files/image009.png" v:shapes="_x0000_i1029"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span><span lang=EN-US> JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>与</span><span lang=EN-US>TaskManager</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>和</span><span lang=EN-US>Worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>处理器可以直接在物理机上启动，或者通过像</span><span lang=EN-US>YARN</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>这样的资源调度框架。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>连接到</span><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，告知自身的可用性进而获得任务分配。</span></p>

<h2><span lang=EN-US>2.1 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>无界数据流与有界数据流</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>用于处理有界和无界数据：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>无界数据流</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：<b style='mso-bidi-font-weight:normal'><span
style='color:red'>无界数据流有一个开始但是没有结束</span></b>，它们不会在生成时终止并提供数据，必须连续处理无界流，也就是说必须在获取后立即处理</span><span
lang=EN-US>event</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>。对于无界数据流我们无法等待所有数据都到达，因为输入是无界的，并且在任何时间点都不会完成。处理无界数据通常要求以特定顺序（例如事件发生的顺序）获取</span><span
lang=EN-US>event</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，以便能够推断结果完整性。（无界的数据无法聚合，想聚合要变成有界的）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>有界数据流</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：<b style='mso-bidi-font-weight:normal'><span
style='color:red'>有界数据流有明确定义的开始和结束</span></b>，可以在执行任何计算之前通过获取所有数据来处理有界流，处理有界流不需要有序获取，因为可以始终对有界数据集进行排序，有界流的处理也称为批处理。</span></p>

<p class=aeCxSpLast align=center style='margin-top:3.1pt;margin-right:0cm;
margin-bottom:3.1pt;margin-left:0cm;mso-add-space:auto;text-align:center;
text-indent:0cm;mso-char-indent-count:0'><span lang=EN-US><!--[if gte vml 1]><v:shape
 id="_x0000_i1030" type="#_x0000_t75" style='width:324pt;height:76.8pt'>
 <v:imagedata src="Flink.files/image010.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\86024b92-5a5a-4922-9447-23faa9f9aaa6.jpg"/>
</v:shape><![endif]--><![if !vml]><img width=540 height=128
src="Flink.files/image011.jpg" v:shapes="_x0000_i1030"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>无界数据流与有解数据流</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Apache
Flink</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:red'>是一个面向分布式数据流处理和批量数据处理的开源计算平台，它能够基于同一个</span><span lang=EN-US
style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>运行时</span><span lang=EN-US style='color:red'>(Flink
Runtime)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>，提供支持流处理和批处理两种类型应用的功能</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。现有的开源计算方案，会把流处理和批处理作为两种不同的应用类型，因为它们要实现的目标是完全不相同的：<b
style='mso-bidi-font-weight:normal'><span style='color:red'>流处理一般需要支持低延迟、</span></b></span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Exactly-once</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>保证</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，而<b style='mso-bidi-font-weight:normal'><span
style='color:red'>批处理需要支持高吞吐、高效处理</span></b>，所以在实现的时候通常是分别给出两套实现方法，或者通过一个独立的开源框架来实现其中每一种处理方案。例如，实现批处理的开源方案有</span><span
lang=EN-US>MapReduce</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>Tez</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>、</span><span lang=EN-US>Crunch</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>Spark</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，实现流处理的开源方案有</span><span
lang=EN-US>Samza</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>、</span><span lang=EN-US>Storm</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在实现流处理和批处理时，与传统的一些方案完全不同，它从另一个视角看待流处理和批处理，将二者统一起来：</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Flink</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>是完全支持流处理，也就是说作为流处理看待时输入数据流是无界的</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>；<b style='mso-bidi-font-weight:normal'><span
style='color:red'>批处理被作为一种特殊的流处理，只是它的输入数据流被定义为有界的</span></b>。基于同一个</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>运行时</span><span lang=EN-US>(Flink
Runtime)</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，分别提供了流处理和批处理</span><span lang=EN-US>API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，而这两种</span><span lang=EN-US>API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>也是实现上层面向流处理、批处理类型应用框架的基础。</span></p>

<h2><span lang=EN-US>2.2 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>数据流编程模型</span></h2>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US
style='background:white'>Flink</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";background:white'>提供了不同级别的抽象，以开发流或批处理作业，如下图所示：</span><span
lang=EN-US style='background:white'><o:p></o:p></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1031"
 type="#_x0000_t75" style='width:352.2pt;height:150.6pt'>
 <v:imagedata src="Flink.files/image013.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\e535014d-6ec9-4460-bf66-23b18b894b24.png"/>
</v:shape><![endif]--><![if !vml]><img width=587 height=251
src="Flink.files/image014.png" v:shapes="_x0000_i1031"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>抽象级别</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>最底层级的抽象仅仅提供了有状态流，它将通过过程函数（</span><span lang=EN-US>Process
Function</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）被嵌入到</span><span lang=EN-US>DataStream
API</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中。底层过程函数（</span><span lang=EN-US>Process
Function</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>与</span><span
lang=EN-US> DataStream API </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>相集成，使其可以对某些特定的操作进行底层的抽象，它允许用户可以自由地处理来自一个或多个数据流的事件，并使用一致的容错的状态。除此之外，用户可以注册事件时间并处理时间回调，从而使程序可以处理复杂的计算。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>实际上，<b style='mso-bidi-font-weight:normal'><span
style='color:red'>大多数应用并不需要上述的底层抽象，而是针对核心</span></b></span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:red'>API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>（</span><span lang=EN-US
style='color:red'>Core APIs</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>）</span><span style='color:red'> </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>进行编程，比如</span><span
lang=EN-US style='color:red'>DataStream API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>（有界或无界流数据）以及</span><span
lang=EN-US style='color:red'>DataSet API</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>（有界数据集）</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。这些</span><span lang=EN-US>API</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>为数据处理提供了通用的构建模块，比如由用户定义的多种形式的转换（</span><span
lang=EN-US>transformations</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>），连接（</span><span
lang=EN-US>joins</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>），聚合（</span><span lang=EN-US>aggregations</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），窗口操作（</span><span lang=EN-US>windows</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）等等。</span><span lang=EN-US>DataSet API </span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>为有界数据集提供了额外的支持，例如循环与迭代。这些</span><span lang=EN-US>API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>处理的数据类型以类（</span><span lang=EN-US>classes</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）的形式由各自的编程语言所表示。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Table
API </span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是以表为中心的声明式编程，其中表可能会动态变化（在表达流数据时）。</span><span
lang=EN-US>Table API</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>遵循（扩展的）关系模型：表有二维数据结构（</span><span
lang=EN-US>schema</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）（类似于关系数据库中的表），同时</span><span
lang=EN-US>API</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>提供可比较的操作，例如</span><span lang=EN-US>select</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>project</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>join</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>group-by</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>aggregate</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>等。</span><span
lang=EN-US>Table API</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>程序声明式地定义了什么逻辑操作应该执行，而不是准确地确定这些操作代码的看上去如何</span>
<span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span> <span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>尽管</span><span
lang=EN-US>Table API</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>可以通过多种类型的用户自定义函数（</span><span
lang=EN-US>UDF</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）进行扩展，其仍不如核心</span><span lang=EN-US>API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>更具表达能力，但是使用起来却更加简洁（代码量更少）。除此之外，</span><span lang=EN-US>Table
API</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>程序在执行之前会经过内置优化器进行优化。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>你可以在表与</span><span
lang=EN-US style='color:red'> DataStream/DataSet </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>之间无缝切换，以允许程序将</span><span
lang=EN-US style='color:red'> Table API </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>与</span><span lang=EN-US
style='color:red'> DataStream </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>以及</span><span lang=EN-US style='color:red'>
DataSet </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>混合使用</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>提供的最高层级的抽象是</span><span lang=EN-US> SQL </span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。这一层抽象在语法与表达能力上与</span><span lang=EN-US> Table API </span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>类似，但是是以</span><span lang=EN-US>SQL</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>查询表达式的形式表现程序。</span><span lang=EN-US>SQL</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>抽象与</span><span lang=EN-US>Table API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>交互密切，同时</span><span lang=EN-US>SQL</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>查询可以直接在</span><span lang=EN-US>Table API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>定义的表上执行。</span></p>

<h1 style='margin-left:77.25pt;text-indent:-77.25pt;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='mso-bidi-font-family:宋体'><span style='mso-list:Ignore'>第三章<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>集群搭建</span></h1>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可以选择的部署方式有：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US
style='color:red'>Local</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>Standalone</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（资源利用率低）、</span><span
lang=EN-US>Yarn</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>、</span><span lang=EN-US>Mesos</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>Docker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>Kubernetes</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>AWS</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>我们主要对</span><span lang=EN-US>Standalone</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>模式和</span><span lang=EN-US>Yarn</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>模式下的</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>集群部署进行分析。</span></p>

<h2 style='margin-left:22.5pt;text-indent:-22.5pt;mso-list:l5 level2 lfo5'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial;mso-bidi-font-family:Arial'><span
style='mso-list:Ignore'>3.1</span></span><![endif]><span lang=EN-US>Standalone</span><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>模式安装</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>我们对</span><span lang=EN-US>standalone</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>模式的</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>集群进行安装，准备三台虚拟机，其中一台作为</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（</span><span lang=EN-US>hadoop-senior01</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），另外两台作为</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（</span><span lang=EN-US>hadoop-senior02</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>hadoop-senior03</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在官网下载</span><span lang=EN-US>1.6.1</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>版本</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（</span><span lang=EN-US><a
href="https://archive.apache.org/dist/flink/flink-1.6.1/">https://archive.apache.org/dist/flink/flink-1.6.1/</a></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将安装包上传到</span><span lang=EN-US style='color:red'>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的节点（</span><span lang=EN-US>hadoop-senior01</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进入</span><span lang=EN-US>Linux</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>系统对安装包进行解压：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1032"
 type="#_x0000_t75" style='width:422.4pt;height:15.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image015.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=704 height=26
src="Flink.files/image015.png" v:shapes="_x0000_i1032"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>修改安装目录下</span><span lang=EN-US>conf</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>文件夹内的</span><span lang=EN-US>flink-conf.yaml</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>配置文件，指定</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1033"
 type="#_x0000_t75" style='width:423pt;height:25.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image017.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=42
src="Flink.files/image017.png" v:shapes="_x0000_i1033"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1034"
 type="#_x0000_t75" style='width:196.2pt;height:19.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image019.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=327 height=32
src="Flink.files/image019.png" v:shapes="_x0000_i1034"><![endif]></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>这是作为</span><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的主机名</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1035"
 type="#_x0000_t75" style='width:423pt;height:139.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image020.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=232
src="Flink.files/image020.png" v:shapes="_x0000_i1035"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>修改安装目录下</span><span lang=EN-US>conf</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>文件夹内的</span><span lang=EN-US>slave</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>配置文件，指定</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1036"
 type="#_x0000_t75" style='width:423pt;height:17.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image022.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=29
src="Flink.files/image022.png" v:shapes="_x0000_i1036"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1037"
 type="#_x0000_t75" style='width:423.6pt;height:53.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image024.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=706 height=89
src="Flink.files/image024.png" v:shapes="_x0000_i1037"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将配置好的</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>目录分发给其他的两台节点：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1038"
 type="#_x0000_t75" style='width:415.2pt;height:7.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image026.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=12
src="Flink.files/image026.png" v:shapes="_x0000_i1038"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>hadoop-senior01</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>节点启动集群：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1039"
 type="#_x0000_t75" style='width:415.2pt;height:15pt;visibility:visible'>
 <v:imagedata src="Flink.files/image028.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=25
src="Flink.files/image028.png" v:shapes="_x0000_i1039"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>通过</span><span lang=EN-US>jps</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>查看进程信息：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1040"
 type="#_x0000_t75" style='width:415.2pt;height:34.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image030.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=58
src="Flink.files/image030.png" v:shapes="_x0000_i1040"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1041"
 type="#_x0000_t75" style='width:415.2pt;height:27pt;visibility:visible'>
 <v:imagedata src="Flink.files/image032.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=45
src="Flink.files/image032.png" v:shapes="_x0000_i1041"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1042"
 type="#_x0000_t75" style='width:415.2pt;height:28.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image034.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=47
src="Flink.files/image034.png" v:shapes="_x0000_i1042"><![endif]></span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l8 level1 lfo6'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>访问集群</span><span lang=EN-US>web</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>界面（</span><span lang=EN-US>8081</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>端口）：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1043"
 type="#_x0000_t75" style='width:478.2pt;height:154.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image036.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=797 height=258
src="Flink.files/image036.png" v:shapes="_x0000_i1043"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>可以这样子提交任务</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1044"
 type="#_x0000_t75" style='width:524.4pt;height:159.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image038.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=874 height=266
src="Flink.files/image038.png" v:shapes="_x0000_i1044"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>这是</span><span
lang=EN-US style='mso-no-proof:yes'>Flink</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>自带的一个</span><span lang=EN-US style='mso-no-proof:yes'>jar</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";mso-no-proof:yes'>，上传</span><span lang=EN-US
style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1045"
 type="#_x0000_t75" style='width:567pt;height:161.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image040.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=269
src="Flink.files/image040.png" v:shapes="_x0000_i1045"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1046"
 type="#_x0000_t75" style='width:567pt;height:167.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image042.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=279
src="Flink.files/image042.png" v:shapes="_x0000_i1046"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>三步骤，通过</span><span
lang=EN-US style='mso-no-proof:yes'>Source</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>把数据拿过来，中间一步是一系列的算子，对流式数据进行处理，最好通过</span><span lang=EN-US
style='mso-no-proof:yes'>Sink</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>写出到指定的输出源。</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1047"
 type="#_x0000_t75" style='width:567pt;height:206.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image044.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=344
src="Flink.files/image044.png" v:shapes="_x0000_i1047"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>任务完成</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1048"
 type="#_x0000_t75" style='width:567pt;height:96.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image046.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=161
src="Flink.files/image046.png" v:shapes="_x0000_i1048"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1049"
 type="#_x0000_t75" style='width:567pt;height:74.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image048.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=124
src="Flink.files/image048.png" v:shapes="_x0000_i1049"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1050"
 type="#_x0000_t75" style='width:567pt;height:145.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image050.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=243
src="Flink.files/image050.png" v:shapes="_x0000_i1050"><![endif]><o:p></o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>在</span><span
lang=EN-US style='mso-no-proof:yes'>Standalone</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>模式下运行，</span><span lang=EN-US style='mso-no-proof:yes'>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";mso-no-proof:yes'>、</span><span lang=EN-US style='mso-no-proof:
yes'>TaskManager</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>都在一个节点上运行，分别对应着</span><span
lang=EN-US style='mso-no-proof:yes'>spark</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>的</span><span lang=EN-US style='mso-no-proof:yes'>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";mso-no-proof:yes'>、</span><span lang=EN-US style='mso-no-proof:
yes'>Work</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>。</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<h2 style='margin-left:22.5pt;text-indent:-22.5pt;mso-list:l5 level2 lfo5'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial;mso-bidi-font-family:Arial'><span
style='mso-list:Ignore'>3.2</span></span><![endif]><span lang=EN-US>Yarn</span><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>模式安装</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在官网下载</span><span lang=EN-US>1.6.1</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>版本</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（</span><span lang=EN-US><a
href="https://archive.apache.org/dist/flink/flink-1.6.1/">https://archive.apache.org/dist/flink/flink-1.6.1/</a></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将安装包上传到要按照</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的节点（</span><span lang=EN-US>hadoop-senior01</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进入</span><span lang=EN-US>Linux</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>系统对安装包进行解压：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1051"
 type="#_x0000_t75" style='width:422.4pt;height:15.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image015.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=704 height=26
src="Flink.files/image015.png" v:shapes="_x0000_i1051"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>修改安装目录下</span><span lang=EN-US>conf</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>文件夹内的</span><span lang=EN-US>flink-conf.yaml</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>配置文件，指定</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1052"
 type="#_x0000_t75" style='width:423pt;height:25.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image017.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=42
src="Flink.files/image017.png" v:shapes="_x0000_i1052"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1053"
 type="#_x0000_t75" style='width:423pt;height:139.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image020.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=232
src="Flink.files/image020.png" v:shapes="_x0000_i1053"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>修改安装目录下</span><span lang=EN-US>conf</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>文件夹内的</span><span lang=EN-US>slave</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>配置文件，指定</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1054"
 type="#_x0000_t75" style='width:423pt;height:17.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image022.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=705 height=29
src="Flink.files/image022.png" v:shapes="_x0000_i1054"><![endif]></span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1055"
 type="#_x0000_t75" style='width:423.6pt;height:53.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image024.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=706 height=89
src="Flink.files/image024.png" v:shapes="_x0000_i1055"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:22.5pt;mso-add-space:auto;text-indent:-22.5pt;mso-char-indent-count:
0;mso-list:l23 level1 lfo7'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>6<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将配置好的</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>目录分发给其他的两台节点：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1056"
 type="#_x0000_t75" style='width:415.2pt;height:7.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image026.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=12
src="Flink.files/image026.png" v:shapes="_x0000_i1056"><![endif]></span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>明确虚拟机中已经设置好了环境变量</span><span lang=EN-US>HADOOP_HOME</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。（前面都一样，就这里开始不一样）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动</span><span lang=EN-US>Hadoop</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>集群（</span><span lang=EN-US>HDFS</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>和</span><span lang=EN-US>Yarn</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>hadoop-senior01</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>节点提交</span><span lang=EN-US>Yarn-Session</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，使用安装目录下</span><span lang=EN-US>bin</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>目录中的</span><span lang=EN-US>yarn-session.sh</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>脚本进行提交：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>/opt/modules/flink-1.6.1/bin/yarn-session.sh -n 2 -s 6 -jm
1024 -tm 1024 -nm test -d<o:p></o:p></span></b></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>其中：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-n(--container)</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的数量。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-s(--slots)</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><span lang=EN-US><span style='mso-tab-count:1'>      </span></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>每个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>slot</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>数量，默认一个</span><span
lang=EN-US>slot</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>一个</span><span lang=EN-US>core</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，默认每个</span><span lang=EN-US>taskmanager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>slot</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的个数为</span><span
lang=EN-US>1</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，有时可以多一些</span><span lang=EN-US>taskmanager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，做冗余。（一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>有几个</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，这些</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>就分均分</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的内存，只分内存不分</span><span lang=EN-US>CPU</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，每个</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可以运行一个</span><span lang=EN-US>Task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-jm</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的内存（单位</span><span lang=EN-US>MB)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-tm</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：每个</span><span lang=EN-US>taskmanager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的内存（单位</span><span lang=EN-US>MB)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-nm</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><span lang=EN-US>yarn </span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的</span><span
lang=EN-US>appName(</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>现在</span><span
lang=EN-US>yarn</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的</span><span lang=EN-US>ui</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>上的名字</span><span lang=EN-US>)</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span><span
lang=EN-US> </span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>-d</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：后台执行。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>10.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动后查看</span><span lang=EN-US>Yarn</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>Web</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>页面，可以看到刚才提交的会话：（这任务一直都在，除非退出）</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1057"
 type="#_x0000_t75" style='width:560.4pt;height:124.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image057.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=934 height=208
src="Flink.files/image057.png" v:shapes="_x0000_i1057"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>11.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在提交</span><span lang=EN-US>Session</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的节点查看进程：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1058"
 type="#_x0000_t75" style='width:421.2pt;height:44.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image059.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=702 height=74
src="Flink.files/image059.png" v:shapes="_x0000_i1058"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>12.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>提交</span><span lang=EN-US>Jar</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>到集群运行：（</span><span
lang=EN-US>-m</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是指定</span><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，这是</span><span lang=EN-US>yarn</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>集群；后面是官方提供的</span><span lang=EN-US>jar</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>/opt/modules/flink-1.6.1/bin/flink run -m yarn-cluster
examples/batch/WordCount.jar<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>13.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>提交后在</span><span lang=EN-US>Yarn</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>Web</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>页面查看任务运行情况：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1059"
 type="#_x0000_t75" style='width:501pt;height:127.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image061.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=835 height=212
src="Flink.files/image061.png" v:shapes="_x0000_i1059"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:21.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l19 level1 lfo24'><![if !supportLists]><span lang=EN-US
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>14.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>任务运行结束后在控制台打印如下输出：</span></p>

<p class=ac style='text-align:justify;text-justify:inter-ideograph'><span
lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1060" type="#_x0000_t75"
 style='width:415.2pt;height:169.8pt;visibility:visible'>
 <v:imagedata src="Flink.files/image063.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=692 height=283
src="Flink.files/image063.png" v:shapes="_x0000_i1060"><![endif]></span></p>

<h1><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>第四章</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>运行架构</span></h1>

<h2><span lang=EN-US>4.1 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>任务提交流程</span></h2>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1061"
 type="#_x0000_t75" style='width:441pt;height:197.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image065.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=735 height=329
src="Flink.files/image065.png" v:shapes="_x0000_i1061"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Yarn</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>模式任务提交流程</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>任务提交后，</span><span lang=EN-US>Client</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>向</span><span lang=EN-US>HDFS</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>上传</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的</span><span lang=EN-US>Jar</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>包和配置，之后向</span><span lang=EN-US>Yarn ResourceManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>提交任务，</span><span lang=EN-US>ResourceManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分配</span><span lang=EN-US>Container</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>资源并通知对应的</span><span lang=EN-US>NodeManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动</span><span lang=EN-US>ApplicationMaster</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，</span><span lang=EN-US>ApplicationMaster</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动后加载</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>Jar</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>包和配置构建环境，然后启动</span><span
lang=EN-US>JobManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，之后</span><span
lang=EN-US>ApplicationMaster</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>向</span><span
lang=EN-US>ResourceManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>申请资源启动</span><span
lang=EN-US>TaskManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，</span><span
lang=EN-US>ResourceManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>分配</span><span
lang=EN-US>Container</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>资源后，由</span><span
lang=EN-US>ApplicationMaster</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>通知资源所在节点的</span><span
lang=EN-US>NodeManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>启动</span><span
lang=EN-US>TaskManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，</span><span
lang=EN-US>NodeManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>加载</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的</span><span lang=EN-US>Jar</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>包和配置构建环境并启动</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动后向</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>发送心跳包，并等待</span><span lang=EN-US>JobManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>向其分配任务。</span></p>

<h2><span lang=EN-US>4.2 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>任务调度原理</span></h2>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1062"
 type="#_x0000_t75" style='width:358.2pt;height:258.6pt'>
 <v:imagedata src="Flink.files/image067.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\ab3e89cb-2602-43db-b6b2-cb0a35ecc2b4\128\index_files\snipaste_20181112_203710.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=597 height=431
src="Flink.files/image068.png" v:shapes="_x0000_i1062"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>任务调度原理</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>客户端不是运行时和程序执行的一部分，但它用于准备并发送（通过</span><span lang=EN-US>Actor</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>发送）</span><span lang=EN-US>dataflow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（把代码抽象成数据流图</span><span lang=EN-US>(Dataflow)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）给</span><span lang=EN-US>Master</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（根据</span><span lang=EN-US>Dataflow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>里面的相邻的两个算子之间有没有并行度的变化或者说有没有分区数的变化来划分</span><span lang=EN-US>Task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，之后把</span><span lang=EN-US>Task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分发给</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，通过</span><span lang=EN-US>Actor</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分发），然后，客户端断开连接或者维持连接以等待接收计算结果，客户端可以以两种方式运行：要么作为</span><span
lang=EN-US>Java/Scala</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>程序的一部分被程序触发执行，要么以命令行</span><span
lang=EN-US>./bin/flink run</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的方式执行。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的个数是</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>最大同时运行</span><span lang=EN-US>Task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的个数，如果并行度是</span><span lang=EN-US>1</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，则同一时间只有一个</span><span lang=EN-US>Slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>执行</span><span lang=EN-US>Task</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><span lang=EN-US>4.3 Worker</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>与</span><span lang=EN-US>Slots </span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>每一个</span><span
lang=EN-US style='color:red'>worker(TaskManager)</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>是一个</span><span lang=EN-US
style='color:red'>JVM</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>进程（</span><span lang=EN-US style='color:red'>yarn</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>模式），它可能会在独立的线程上执行一个或多个</span><span
lang=EN-US style='color:red'>subtask</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。为了控制一个</span><span
lang=EN-US>worker</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>能接收多少个</span><span lang=EN-US>task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，</span><span lang=EN-US>worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>通过</span><span lang=EN-US>task slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>来进行控制（一个</span><span lang=EN-US>worker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>至少有一个</span><span lang=EN-US>task slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。（</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是根据还有多少个</span><span lang=EN-US>Slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>来分配任务的，而</span><span lang=EN-US>spark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是根据还有多少内存来分配任务的）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>每个</span><span lang=EN-US>task slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>表示</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>拥有资源的一个固定大小的子集。假如一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>有三个</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，那么它会将其管理的内存分成三份给各个</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（如果一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>只有一个</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，则该</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>task</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会独享一个</span><span
lang=EN-US>JVM</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的空间）。<b style='mso-bidi-font-weight:
normal'><span style='color:red'>资源</span></b></span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:red'>slot</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>化意味着一个</span><span
lang=EN-US style='color:red'>subtask</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>将不需要跟来自其他</span><span
lang=EN-US style='color:red'>job</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>的</span><span lang=EN-US style='color:red'>subtask</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>竞争被管理的内存，取而代之的是它将拥有一定数量的内存储备</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。需要注意的是，这里不会涉及到</span><span lang=EN-US>CPU</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的隔离，</span><span lang=EN-US>slot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>目前仅仅用来隔离</span><span lang=EN-US>task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的受管理的内存。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>通过调整</span><span
lang=EN-US style='color:red'>task slot</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的数量，允许用户定义</span><span
lang=EN-US style='color:red'>subtask</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>之间如何互相隔离</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。如果一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>一个</span><span lang=EN-US>slot</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，那将意味着每个</span><span
lang=EN-US>task group</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>运行在独立的</span><span
lang=EN-US>JVM</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中（该</span><span lang=EN-US>JVM</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可能是通过一个特定的容器启动的），而一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>多个</span><span lang=EN-US>slot</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>意味着更多的</span><span
lang=EN-US>subtask</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>可以共享同一个</span><span
lang=EN-US>JVM</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>。而在同一个</span><span lang=EN-US>JVM</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进程中的</span><span lang=EN-US>task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将共享</span><span lang=EN-US>TCP</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>连接（基于多路复用）和心跳消息。它们也可能共享数据集和数据结构，因此这减少了每个</span><span
lang=EN-US>task</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的负载。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1063"
 type="#_x0000_t75" style='width:353.4pt;height:115.2pt'>
 <v:imagedata src="Flink.files/image069.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\ab3e89cb-2602-43db-b6b2-cb0a35ecc2b4\128\index_files\snipaste_20181113_205958.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=589 height=192
src="Flink.files/image069.png" v:shapes="_x0000_i1063"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>与</span><span lang=EN-US>Slot</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Task Slot</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>是静态的概念，是指</span><span
lang=EN-US style='color:red'>TaskManager</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>具有的并发执行能力</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，可以通过参数</span><span lang=EN-US>taskmanager.numberOfTaskSlots</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进行配置，而<b style='mso-bidi-font-weight:normal'><span
style='color:red'>并行度</span></b></span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:red'>parallelism</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>是动态概念，即</span><span
lang=EN-US style='color:red'>TaskManager</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>运行程序时实际使用的并发能力</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，可以通过参数</span><span lang=EN-US>parallelism.default</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进行配置。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>也就是说，假设一共有</span><span lang=EN-US>3</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，每一个</span><span lang=EN-US>TaskManager</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中的分配</span><span lang=EN-US>3</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>个</span><span
lang=EN-US>TaskSlot</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，也就是每个</span><span
lang=EN-US>TaskManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>可以接收</span><span
lang=EN-US>3</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>个</span><span lang=EN-US>task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，一共</span><span lang=EN-US>9</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>个</span><span
lang=EN-US>TaskSlot</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，如果我们设置</span><span
lang=EN-US>parallelism.default=1</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，即运行程序默认的并行度为</span><span
lang=EN-US>1</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，</span><span lang=EN-US>9</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>个</span><span lang=EN-US>TaskSlot</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>只用了</span><span lang=EN-US>1</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>个，有</span><span
lang=EN-US>8</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>个空闲，因此，设置合适的并行度才能提高效率。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>spark</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>中，划分</span><span
lang=EN-US>stage</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>之后，一个不会触发</span><span lang=EN-US>shuffle</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>stage</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>内的所有算子都是由一个</span><span
lang=EN-US>Task</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>完成的，而不是一个算子一个</span><span lang=EN-US>Task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，因为算子之间可能有数据交互。而</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>也是做了这种优化，就是算子与算子之间并行度（分区）发生了变化就会划分为两个</span><span
lang=EN-US>task</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>。</span></p>

<h2><span lang=EN-US>4.4 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>程序与数据流</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>程序的基础构建模块是</span> <b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>流</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（</span><span
lang=EN-US>streams</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，就是算子与算子之间的数据流）</span>
<span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>与</span> <b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>转换</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（</span><span
lang=EN-US>transformations</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，就是算子）（需要注意的是，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的</span><span lang=EN-US>DataSet API</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>所使用的</span><span lang=EN-US>DataSets</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>其内部也是</span><span lang=EN-US>stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）。一个</span><span lang=EN-US>stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可以看成一个中间结果，而一个</span><span lang=EN-US>transformations</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是以一个或多个</span><span lang=EN-US>stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>作为输入的某种</span><span lang=EN-US>operation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，该</span><span lang=EN-US>operation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>利用这些</span><span lang=EN-US>stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进行计算从而产生一个或多个</span><span lang=EN-US>result stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>在运行时，</span><span
lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>上运行的程序会被映射成</span><span
lang=EN-US style='color:red'>streaming dataflows</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>，它包含了</span><span
lang=EN-US style='color:red'>streams</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>和</span><span lang=EN-US
style='color:red'>transformations operators</span></b><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。每一个</span><span
lang=EN-US>dataflow</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>以一个或多个</span><span
lang=EN-US>sources</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>开始以一个或多个</span><span
lang=EN-US>sinks</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>结束。</span><span lang=EN-US>dataflow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>类似于任意的有向无环图（</span><span lang=EN-US>DAG</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），当然特定形式的环可以通过</span><span lang=EN-US>iteration</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>构建。在大部分情况下，程序中的</span><span lang=EN-US>transformations</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>跟</span><span lang=EN-US>dataflow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中的</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是一一对应的关系，但有时候，一个</span><span lang=EN-US>transformation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可能对应多个</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Source</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>读取数据，</span><span lang=EN-US>Transformation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是中间的算子，</span><span lang=EN-US>Sink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是输出。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1064"
 type="#_x0000_t75" style='width:282.6pt;height:220.2pt'>
 <v:imagedata src="Flink.files/image070.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\de9f9c3f-77e9-410c-ae37-2452df0cfc3f.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=471 height=367
src="Flink.files/image071.png" v:shapes="_x0000_i1064"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>程序与数据流</span></p>

<h2><span lang=EN-US>4.5 </span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>并行数据流</span></h2>

<p class=MsoNormal><span lang=EN-US>task</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会在</span><span
lang=EN-US>slots</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中并行执行。</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Flink</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>程序的执行具有并行、分布式的特性</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。在执行过程中，一个</span><span lang=EN-US> stream </span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>包含一个或多个</span><span lang=EN-US> stream partition</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（流分区取决于并行度的设置）</span> <span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，而每一个</span><span
lang=EN-US> operator</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（就是一个算子，一个算子有多少个</span><span
lang=EN-US>subtask</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>取决于</span><span
lang=EN-US>stream partition</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span> <span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>包含一个或多个</span><span lang=EN-US> operator subtask</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，这些</span><span lang=EN-US>operator subtasks</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>（在</span><span lang=EN-US>slot</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>执行）在不同的线程、不同的物理机或不同的容器中彼此互不依赖得执行。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>一个特定</span><span
lang=EN-US style='color:red'>operator</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的</span><span lang=EN-US
style='color:red'>subtask</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>的个数被称之为其</span><span lang=EN-US style='color:red'>parallelism(</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>并行度</span><span
lang=EN-US style='color:red'>)</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。一个</span><span
lang=EN-US>stream</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的并行度总是等同于其</span><span lang=EN-US>producing
operator</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的并行度。一个程序中，不同的</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可能具有不同的并行度。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>由于</span><span lang=EN-US>Source</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的并行度被设置为</span><span lang=EN-US>2</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，就会有两个分区，然后有两个</span><span lang=EN-US>subtask</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>去读取数据。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1065"
 type="#_x0000_t75" style='width:270pt;height:178.8pt'>
 <v:imagedata src="Flink.files/image072.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\cb734784-3284-41c8-8565-43bfd909064d.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=450 height=298
src="Flink.files/image073.png" v:shapes="_x0000_i1065"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>并行数据流</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>之间传输数据的形式可以是</span><span lang=EN-US>one-to-one(forwarding)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的模式也可以是</span><span lang=EN-US>redistributing</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的模式，具体是哪一种形式，取决于</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的种类。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>One-to-one</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:red'>stream(</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>比如在</span><span lang=EN-US
style='color:red'>source</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>和</span><span lang=EN-US style='color:red'>map
operator</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>之间</span><span lang=EN-US style='color:red'>)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>维护着分区以及元素的顺序</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。那意味着</span><span lang=EN-US>map operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>subtask</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>看到的元素的个数以及顺序跟</span><span lang=EN-US>source operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的</span><span lang=EN-US>subtask</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>生产的元素的个数、顺序相同，</span><span lang=EN-US>map</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>fliter</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>flatMap</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>等算子都是</span><span lang=EN-US>one-to-one</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的对应关系。（就是一个分区的内容，经过一个算子之后这些分区是一一对应的，就是数据所处的分区位置没有变化，比如</span><span
lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1066"
 type="#_x0000_t75" style='width:64.2pt;height:22.2pt;visibility:visible'>
 <v:imagedata src="Flink.files/image074.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=107 height=37
src="Flink.files/image074.png" v:shapes="_x0000_i1066"><![endif]></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>Redistributing</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:red'>stream(map()</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>跟</span><span lang=EN-US
style='color:red'>keyBy/window</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>之间或者</span><span lang=EN-US style='color:red'>keyBy/window</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>跟</span><span
lang=EN-US style='color:red'>sink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>之间</span><span lang=EN-US
style='color:red'>)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>的分区会发生改变</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。每一个</span><span
lang=EN-US>operator subtask</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>依据所选择的</span><span
lang=EN-US>transformation</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>发送数据到不同的目标</span><span
lang=EN-US>subtask</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。例如，</span><span
lang=EN-US>keyBy() </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>基于</span><span
lang=EN-US>hashCode</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>重分区、</span><span
lang=EN-US>broadcast</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>和</span><span
lang=EN-US>rebalance</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会随机重新分区，这些算子都会引起</span><span
lang=EN-US>redistribute</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>过程，而</span><span
lang=EN-US>redistribute</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>过程就类似于</span><span
lang=EN-US>Spark</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中的</span><span lang=EN-US>shuffle</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>过程。（经过算子之后，原分区数据被打散到其他的分区，比如</span><span lang=EN-US
style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="_x0000_i1067" type="#_x0000_t75"
 style='width:76.2pt;height:68.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image076.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=127 height=114
src="Flink.files/image076.png" v:shapes="_x0000_i1067"><![endif]></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）</span></p>

<h2><span lang=EN-US>4.6 task</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>与</span><span lang=EN-US>operator chains</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>出于分布式执行的目的，</span><span
lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>将</span><span lang=EN-US
style='color:red'>operator</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>的</span><span lang=EN-US style='color:red'>subtask</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>链接在一起形成</span><span
lang=EN-US style='color:red'>task</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>，每个</span><span lang=EN-US
style='color:red'>task</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>在一个线程中执行</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。将</span><span
lang=EN-US>operators</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>链接成</span><span
lang=EN-US>task</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是非常有效的优化：<b style='mso-bidi-font-weight:
normal'><span style='color:red'>它能减少线程之间的切换和基于缓存区的数据交换，在减少时延的同时提升吞吐量</span></b>。链接的行为可以在编程</span><span
lang=EN-US>API</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中进行指定。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>下面这幅图，展示了</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>个</span><span lang=EN-US>subtask</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>以</span><span lang=EN-US>5</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>个并行的线程来执行：</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>对于</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>One-to-one</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的算子，会组合成</span><span
lang=EN-US>Operator chain</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，然后用一个</span><span
lang=EN-US>Task</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>来执行。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1068"
 type="#_x0000_t75" style='width:267pt;height:187.2pt'>
 <v:imagedata src="Flink.files/image078.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\snipaste_20181113_204216.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=445 height=312
src="Flink.files/image079.png" v:shapes="_x0000_i1068"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span><span lang=EN-US> task</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>与</span><span lang=EN-US>operator chains</span></p>

<h1 style='margin-left:77.25pt;text-indent:-77.25pt;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='mso-bidi-font-family:宋体'><span style='mso-list:Ignore'>第四章<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>Flink DataStream API</span></h1>

<h2><span lang=EN-US>5.1 Flink</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>运行模型</span></h2>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1069"
 type="#_x0000_t75" style='width:313.2pt;height:83.4pt'>
 <v:imagedata src="Flink.files/image079.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\d3581bfc-7435-4e4f-bf1f-d6bebb6c319d\128\index_files\70796826-a229-41f2-89fc-87ef87f954d3.jpg"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=522 height=139
src="Flink.files/image080.jpg" v:shapes="_x0000_i1069"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>查询模型</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>以上为</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的运行模型，</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的程序主要由三部分构成，分别为</span><span lang=EN-US>Source</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>Transformation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>Sink</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span><span
lang=EN-US>DataSource</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>主要负责数据的读取，</span><span
lang=EN-US>Transformation</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>主要负责对属于的转换操作，</span><span
lang=EN-US>Sink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>负责最终数据的输出。</span></p>

<h2><span lang=EN-US>5.2 Flink</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>程序架构</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>每个</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>程序都包含以下的若干流程：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:42.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l20 level1 lfo9'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>获得一个执行环境；（</span><span
lang=EN-US>Execution Environment</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）相当于</span><span
lang=EN-US>spark</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的</span><span lang=EN-US>sparkcontext</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:42.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l20 level1 lfo9'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>加载</span><span
lang=EN-US>/</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>创建初始数据；（</span><span lang=EN-US>Source</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:42.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l20 level1 lfo9'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>指定转换这些数据；（</span><span
lang=EN-US>Transformation</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:42.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l20 level1 lfo9'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>指定放置计算结果的位置；（</span><span
lang=EN-US>Sink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:42.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l20 level1 lfo9'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>触发程序执行。</span></p>

<h2><span lang=EN-US>5.3 Environment</span></h2>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>项目依赖</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1070" type="#_x0000_t75" style='width:367.8pt;height:279pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image082.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=613 height=465
src="Flink.files/image082.png" v:shapes="_x0000_i1070"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1071" type="#_x0000_t75" style='width:374.4pt;height:212.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image084.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=624 height=354
src="Flink.files/image084.png" v:shapes="_x0000_i1071"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>要</span><span
lang=EN-US style='mso-no-proof:yes'>add</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>一下，这样右键才能添加</span><span lang=EN-US style='mso-no-proof:yes'>Scala</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";mso-no-proof:yes'>类等</span><span lang=EN-US style='mso-no-proof:
yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1072" type="#_x0000_t75" style='width:483.6pt;height:203.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image086.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=806 height=339
src="Flink.files/image086.png" v:shapes="_x0000_i1072"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>执行环境</span><span
lang=EN-US style='color:red'>StreamExecutionEnvironment</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>是所有</span><span
lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>程序的基础</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>创建执行环境有三种方式，分别为：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>StreamExecutionEnvironment.getExecutionEnvironment </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:black'>（绝大多数是调用这个）</span><span
lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>StreamExecutionEnvironment.createLocalEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>StreamExecutionEnvironment.createRemoteEnvironment<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.3.1 StreamExecutionEnvironment.getExecutionEnvironment</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>创建一个执行环境，表示当前执行程序的上下文。</span>
<span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>如果程序是独立调用的，则此方法返回本地执行环境（</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:black'>LocalEnvironment</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>）；如果从命令行客户端调用程序以提交到集群，则此方法返回此集群的执行环境（</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>RemoteEnvironment</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>），也就是说，</span><span lang=EN-US>getExecutionEnvironment</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>会根据查询运行的方式决定返回什么样的运行环境，是<span style='color:red'>最常用的一种</span>创建执行环境的方式。不需要指定参数，默认并行度是</span><span
lang=EN-US>8</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.3.2 StreamExecutionEnvironment.createLocalEnvironment</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>返回本地执行环境，需要在调用时指定默认的并行度。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.createLocalEnvironment(1)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.3.3 StreamExecutionEnvironment.createRemoteEnvironment</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>返回集群执行环境，将</span><span
lang=EN-US>Jar</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>提交到远程服务器。需要在调用时指定</span><span
lang=EN-US>JobManager</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的</span><span
lang=EN-US>IP</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>和端口号，并指定要在集群中运行的</span><span
lang=EN-US>Jar</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>包。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.createRemoteEnvironment(1)<o:p></o:p></span></b></p>

<h2><span lang=EN-US>5.4 Source</span></h2>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>数据</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1073" type="#_x0000_t75" style='width:320.4pt;height:179.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image088.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=534 height=299
src="Flink.files/image088.png" v:shapes="_x0000_i1073"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1074" type="#_x0000_t75" style='width:323.4pt;height:130.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image089.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=539 height=218
src="Flink.files/image089.png" v:shapes="_x0000_i1074"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1075" type="#_x0000_t75" style='width:333.6pt;height:143.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image091.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=556 height=239
src="Flink.files/image091.png" v:shapes="_x0000_i1075"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US>5.4.1 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>基于</span><span
lang=EN-US>File</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的数据源</span></h3>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>1. readTextFile(path)</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>一列一列的读取遵循</span><span
lang=EN-US>TextInputFormat</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>规范的文本文件，并将结果作为</span><span
lang=EN-US>String</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>返回。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<span
style='mso-spacerun:yes'>  </span></span><span lang=EN-US style='color:#538135'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:"Courier New";
color:#538135'>创建运行环境</span><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;/opt/modules/test00.txt&quot;)<span
style='mso-spacerun:yes'>   </span></span><span lang=EN-US style='color:#538135'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:"Courier New";
color:#538135'>获取数据源（</span><span lang=EN-US style='color:#538135'>Source</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>）</span><span
lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<span style='mso-spacerun:yes'>  </span></span><span
lang=EN-US style='color:#538135'>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>打印数据（</span><span
lang=EN-US style='color:#538135'>Sink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>）</span><span lang=EN-US
style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<span
style='mso-spacerun:yes'>  </span></span><span lang=EN-US style='color:#538135'>//
</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:"Courier New";
color:#538135'>执行任务。</span><span lang=EN-US style='color:#538135'>FirstJob</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>起一个名字</span><span
lang=EN-US style='color:#538135'><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>这里举个例子</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1076" type="#_x0000_t75" style='width:567pt;height:213pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image093.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=355
src="Flink.files/image093.png" v:shapes="_x0000_i1076"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>就是这个报错</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1077" type="#_x0000_t75" style='width:567pt;height:84pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image095.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=140
src="Flink.files/image095.png" v:shapes="_x0000_i1077"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>打印结果，左边是处理这条数据的线程编号</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1078" type="#_x0000_t75" style='width:213.6pt;height:104.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image097.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=356 height=174
src="Flink.files/image097.png" v:shapes="_x0000_i1078"><![endif]></span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>2.
readFile(fileInputFormat, path)</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>按照指定的文件格式读取文件。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val path = new Path(&quot;/opt/modules/test00.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readFile(new TextInputFormat(path),
&quot;/opt/modules/test.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.4.2 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>基于</span><span
lang=EN-US>Socket</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的数据源</span></h3>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>1. socketTextStream</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>从</span><span
lang=EN-US>Socket</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中读取信息，元素可以用分隔符分开。（调试的时候可以用这种）</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>这是</span><span lang=EN-US>netcat</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，起一个服务器，然后代码程序跑起来连接上来，这里就可以输入内容了</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1079" type="#_x0000_t75" style='width:496.2pt;height:42pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image098.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=827 height=70
src="Flink.files/image098.png" v:shapes="_x0000_i1079"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1080" type="#_x0000_t75" style='width:496.8pt;height:276pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image100.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=828 height=460
src="Flink.files/image100.png" v:shapes="_x0000_i1080"><![endif]></span></p>

<h3><span lang=EN-US>5.4.3 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>基于集合（</span><span
lang=EN-US>Collection</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）的数据源</span></h3>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>1. <span style='color:
red'>fromCollection(seq)<o:p></o:p></span></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>从集合中创建一个数据流，集合中所有元素的类型是一致的。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val list = List(1,2,3,4)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.fromCollection(list)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1081" type="#_x0000_t75" style='width:207pt;height:94.2pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image102.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=345 height=157
src="Flink.files/image102.png" v:shapes="_x0000_i1081"><![endif]></span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>2.<span style='color:red'>
fromCollection(Iterator) </span></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>从迭代</span><span
lang=EN-US>(Iterator)</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>中创建一个数据流，指定元素数据类型的类由</span><span
lang=EN-US>iterator</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>返回。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val iterator = Iterator(1,2,3,4)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.fromCollection(iterator)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1082" type="#_x0000_t75" style='width:66pt;height:88.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image103.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=110 height=148
src="Flink.files/image103.png" v:shapes="_x0000_i1082"><![endif]></span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>3. fromElements(elements:_*)</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>从一个给定的对象序列中创建一个数据流，所有的对象必须是相同类型的。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val list = List(1,2,3,4)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.fromElement(list)<span
style='mso-spacerun:yes'>  </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:black'>可以传</span></b><span
lang=EN-US style='color:red'>seq</span><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:black'>，也可以传</span></b><span lang=EN-US style='color:red'>Iterator</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;text-indent:22.0pt'><span lang=EN-US>4. <span style='color:
red'>generateSequence(from, to)<o:p></o:p></span></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>从给定的间隔中并行地产生一个数字序列。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.generateSequence(1,10)<span
style='mso-spacerun:yes'>  </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:black'>生成从</span><span lang=EN-US
style='color:black'>1-10</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:black'>的序列</span><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>stream.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1083" type="#_x0000_t75" style='width:83.4pt;height:135.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image104.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=139 height=226
src="Flink.files/image104.png" v:shapes="_x0000_i1083"><![endif]></span></p>

<h2><span lang=EN-US>5.5 Sink</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Data
Sink </span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>消费</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中的数据，并将它们转发到文件、套接字、外部系统或者打印出。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>有许多封装在</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>操作里的内置输出格式。</span></p>

<h3><span lang=EN-US>5.6.1 writeAsText</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>将元素以字符串形式逐行写入（</span><span
lang=EN-US>TextOutputFormat</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>），这些字符串通过调用每个元素的</span><span
lang=EN-US>toString()</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>方法来获取。</span></p>

<h3><span lang=EN-US>5.6.2 WriteAsCsv</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>将元组以逗号分隔写入文件中（</span><span
lang=EN-US>CsvOutputFormat</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>），行及字段之间的分隔是可配置的。每个字段的值来自对象的</span><span
lang=EN-US>toString()</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>方法。</span></p>

<h3><span lang=EN-US>5.6.3 print/printToErr</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>打印每个元素的</span><span
lang=EN-US>toString()</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>方法的值到标准输出或者标准错误输出流中。或者也可以在输出流中添加一个前缀，这个可以帮助区分不同的打印调用，如果并行度大于</span><span
lang=EN-US>1</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，那么输出也会有一个标识由哪个任务产生的标志。</span></p>

<h3><span lang=EN-US>5.6.4 writeUsingOutputFormat</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>自定义文件输出的方法和基类（</span><span
lang=EN-US>FileOutputFormat</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>），支持自定义对象到字节的转换。</span></p>

<h3><span lang=EN-US>5.6.5 writeToSocket</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>根据</span><span
lang=EN-US>SerializationSchema </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>将元素写入到</span><span
lang=EN-US>socket</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>中。</span></p>

<h2><span lang=EN-US>5.6 Transformation</span></h2>

<h3><span lang=EN-US>5.6.1 Map</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>DataStream </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US> DataStream</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：输入一个参数产生一个参数。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.generateSequence(1,10)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamMap = stream.map { x =&gt; x * 2 }<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamFilter.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1084" type="#_x0000_t75" style='width:78.6pt;height:110.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image106.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=131 height=184
src="Flink.files/image106.png" v:shapes="_x0000_i1084"><![endif]></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red;background:white'>注意</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>：</span><b><span lang=EN-US
style='background:white'>stream.print()</span></b><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>：每一行前面的数字代表这一行是哪一个并行线程输出的。</span><span style='background:
white'> <span lang=EN-US><span style='mso-tab-count:1'>   </span><o:p></o:p></span></span></p>

<h3><span lang=EN-US>5.6.2 FlatMap</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US>DataStream </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>→</span><span
lang=EN-US> DataStream</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：输入一个参数，产生</span><span
lang=EN-US>0</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>个、</span><span lang=EN-US>1</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>个或者多个输出。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;test00.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap = stream.flatMap{<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>x =&gt;
x.split(&quot; &quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamFilter.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1085" type="#_x0000_t75" style='width:132.6pt;height:171.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image108.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=221 height=286
src="Flink.files/image108.png" v:shapes="_x0000_i1085"><![endif]></span></p>

<h3><span lang=EN-US>5.6.3 Filter</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US>DataStream </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>→</span><span
lang=EN-US> DataStream</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：结算每个元素的布尔值，并返回布尔值为</span><span
lang=EN-US>true</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的元素。下面这个例子是过滤出非</span><span
lang=EN-US>0</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的元素：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.generateSequence(1,10)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFilter = stream.filter{<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>x =&gt; x == 1<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamFilter.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1086" type="#_x0000_t75" style='width:101.4pt;height:61.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image110.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=169 height=103
src="Flink.files/image110.png" v:shapes="_x0000_i1086"><![endif]></span></p>

<h3><span lang=EN-US>5.6.4 <span style='color:red'>Connect<o:p></o:p></span></span></h3>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1087"
 type="#_x0000_t75" style='width:258pt;height:126.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image112.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=430 height=211
src="Flink.files/image112.png" v:shapes="_x0000_i1087"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Connect</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>算子</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:0'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>DataStream,DataStream</span></b><i
style='mso-bidi-font-style:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（这俩输入的类型）</span></i><b
style='mso-bidi-font-weight:normal'> </b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>→</span><span lang=EN-US> ConnectedStreams</span></b><i
style='mso-bidi-font-style:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>（输出的类型）</span></i><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：连接两个保持他们类型的数据流，两个数据流被</span><span lang=EN-US>Connect</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>之后，只是被放在了一个同一个流（</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US>ConnectedStreams</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）中，内部依然保持各自的数据和形式不发生任何变化，两个流相互独立。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;test00.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamMap = stream.flatMap(item =&gt; item.split(&quot;
&quot;)).filter(item =&gt; item.equals(&quot;hadoop&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamCollect = env.fromCollection(List(1,2,3,4))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamConnect = streamMap.connect(streamCollect)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#538135'>// Connect</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>之后，要</span><span lang=EN-US style='color:#538135'>map</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>的话，要传入两个函数，分别处理</span><span
lang=EN-US style='color:#538135'>Stream1</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>、</span><span lang=EN-US
style='color:#538135'>Stream2</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>，这俩一点关系都没有</span><span lang=EN-US
style='color:#538135'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamConnect.map(item=&gt;println(item),
item=&gt;println(item))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.6.5 <span style='color:red'>CoMap,CoFlatMap<o:p></o:p></span></span></h3>

<p class=MsoNormal><span lang=EN-US>map</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>或</span><span
lang=EN-US>flatmap</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>之后，会把</span><span
lang=EN-US>Stream1</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>、</span><span
lang=EN-US>Stream2</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>经过函数的处理之后的结果合并为一个</span><span
lang=EN-US>DataStream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1088"
 type="#_x0000_t75" style='width:252.6pt;height:180.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image114.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=421 height=301
src="Flink.files/image114.png" v:shapes="_x0000_i1088"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>CoMap/CoFlatMap</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span lang=EN-US>ConnectedStreams</span></b><i
style='mso-bidi-font-style:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";mso-bidi-font-weight:
bold'>（输入类型）</span></i><b><span lang=EN-US> → DataStream</span></b><i
style='mso-bidi-font-style:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";mso-bidi-font-weight:
bold'>（输出类型）</span></i><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>：作用于</span><span lang=EN-US
style='background:white'>ConnectedStreams</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>上，功能与</span><span
lang=EN-US>map</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>和</span><span lang=EN-US>flatMap</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>一样，对</span><span lang=EN-US style='background:white'>ConnectedStreams</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>中的每一个</span><span lang=EN-US
style='background:white'>Stream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";background:white'>分别进行</span><span
lang=EN-US style='background:white'>map</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>（就叫</span><span lang=EN-US style='background:white'>CoMap</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>）和</span><span lang=EN-US style='background:
white'>flatMap</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";background:white'>（叫</span><span
lang=EN-US style='background:white'>CoFlatMap</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>）处理。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream1 = env.readTextFile(&quot;test.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap = stream1.flatMap(x =&gt; x.split(&quot;
&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream2 = env.fromCollection(List(1,2,3,4))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamConnect = streamFlatMap.connect(stream2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamCoMap = streamConnect.</span><span lang=EN-US
style='color:red'>map</span><span lang=EN-US style='color:black'>(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>(str) =&gt; str +
&quot;connect&quot;,<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>(in) =&gt; in +
100<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:0'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream1 = env.readTextFile(&quot;test.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream2 = env.readTextFile(&quot;test1.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamConnect = stream1.connect(stream2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamCoMap = streamConnect.</span><span lang=EN-US
style='color:red'>flatMap</span><span lang=EN-US style='color:black'>(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>(str1) =&gt;
str1.split(&quot; &quot;),<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>(str2) =&gt;
str2.split(&quot; &quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamConnect.map(item=&gt;println(item),
item=&gt;println(item))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.6.6 Split</span></h3>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1089"
 type="#_x0000_t75" style='width:248.4pt;height:159pt;visibility:visible'>
 <v:imagedata src="Flink.files/image116.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=414 height=265
src="Flink.files/image116.png" v:shapes="_x0000_i1089"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Split</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>DataStream </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US> SplitStream</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：根据某些特征把一个</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>拆分成两个或者多个</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;test.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap = stream.flatMap(x =&gt; x.split(&quot;
&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamSplit = streamFlatMap.split(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>num =&gt;<o:p></o:p></span></b></p>

<p class=a0 style='text-indent:16.05pt;mso-char-indent-count:2.0'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:#00B050'># </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>字符串内容为</span><span
lang=EN-US style='color:#00B050'>hadoop</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>的组成一个</span><span
lang=EN-US style='color:#00B050'>DataStream</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>，其余的组成一个</span><span
lang=EN-US style='color:#00B050'>DataStream</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>，把流拆成两部分。结合</span><span
lang=EN-US style='color:#00B050'>Select</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>算子一起使用</span><span
lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>   
</span>(num.equals(&quot;hadoop&quot;)) match{ </span><span lang=EN-US
style='color:#538135'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>模式匹配</span><span lang=EN-US style='color:#538135'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#538135'><span style='mso-spacerun:yes'> </span><span
style='mso-spacerun:yes'>       </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>名为</span><span lang=EN-US
style='color:#538135'>hadoop</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>的</span><span lang=EN-US style='color:#538135'>List</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>，</span><span
lang=EN-US style='color:#538135'>other</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>也一样</span><span lang=EN-US
style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>        </span>case true
=&gt; List(&quot;hadoop&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>        </span>case false
=&gt; List(&quot;other&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.6.7 Select</span></h3>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1090"
 type="#_x0000_t75" style='width:250.2pt;height:120.6pt;visibility:visible'>
 <v:imagedata src="Flink.files/image118.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=417 height=201
src="Flink.files/image118.png" v:shapes="_x0000_i1090"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Select</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>SplitStream</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US>DataStream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>从一个</span><span lang=EN-US>SplitStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中获取一个或者多个</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;test.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap = stream.flatMap(x =&gt; x.split(&quot;
&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamSplit = streamFlatMap.split(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>num =&gt;<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>   
</span>(num.equals(&quot;hadoop&quot;)) match{<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>        </span>case true
=&gt; List(&quot;hadoop&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>        </span>case false
=&gt; List(&quot;other&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#538135'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>取出名为</span><span lang=EN-US style='color:#538135'>hadoop</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>的</span><span
lang=EN-US style='color:#538135'>List<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val hadoop = streamSplit.select(&quot;hadoop&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val other = streamSplit.select(&quot;other&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>hadoop.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>hadoop</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1091" type="#_x0000_t75" style='width:137.4pt;height:60.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image120.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=229 height=101
src="Flink.files/image120.png" v:shapes="_x0000_i1091"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'>other<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1092" type="#_x0000_t75" style='width:106.2pt;height:201pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image122.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=177 height=335
src="Flink.files/image122.png" v:shapes="_x0000_i1092"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>Split</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>比</span><span
lang=EN-US>Filter</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>灵活，因为</span><span lang=EN-US>Filter</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>只能返回一种满足条件的，而</span><span lang=EN-US>Split</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可以返回多种。</span></p>

<h3><span lang=EN-US>5.6.8 Union</span></h3>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1093"
 type="#_x0000_t75" style='width:207.6pt;height:134.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image123.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=346 height=224
src="Flink.files/image123.png" v:shapes="_x0000_i1093"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Union</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US>DataStream </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>→</span><span
lang=EN-US> DataStream</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：对两个或者两个以上的</span><span
lang=EN-US>DataStream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>进行</span><span
lang=EN-US>union</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>操作，产生一个包含所有</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>元素的新</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。注意</span><span lang=EN-US>:</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>如果你将一个</span><span
lang=EN-US>DataStream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>跟它自己做</span><span
lang=EN-US>union</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>操作，在新的</span><span lang=EN-US>DataStream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中，你将看到每一个元素都出现两次。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream1 = env.readTextFile(&quot;test00.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap1 = stream1.flatMap(x =&gt; x.split(&quot;
&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream2 = env.readTextFile(&quot;test01.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap2 = stream2.flatMap(x =&gt; x.split(&quot;
&quot;))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamConnect = streamFlatMap1.union(streamFlatMap2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.6.9 KeyBy</span></h3>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>把所有相同的</span><span lang=EN-US>key</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>划分到一起，后面讲解的算子操作都是在</span><span lang=EN-US>KeyBy</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>之后的。</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US>DataStream </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>→</span><span
lang=EN-US> KeyedStream</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：输入必须是</span><span
lang=EN-US>Tuple</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>类型，逻辑地将一个流拆分成不相交的分区，每个分区包含具有相同</span><span
lang=EN-US>key</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的元素，在内部以</span><span lang=EN-US>hash</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的形式实现的。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.readTextFile(&quot;test00.txt&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFlatMap = stream.flatMap{<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>x =&gt;
x.split(&quot; &quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamMap = streamFlatMap.map{<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>    </span>x =&gt; </span><span
lang=EN-US style='color:red'>(x,1)</span><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#538135'>// 0</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>表示以元祖（</span><span lang=EN-US style='color:#538135'>x
=&gt; </span><span lang=EN-US style='color:red'>(x,1)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>）的第一个元素为</span><span
lang=EN-US style='color:#538135'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>，</span><span lang=EN-US
style='color:#538135'>1</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>表示以第二个为</span><span lang=EN-US style='color:#538135'>key<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = streamMap.keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1094" type="#_x0000_t75" style='width:229.2pt;height:354pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image125.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=382 height=590
src="Flink.files/image125.png" v:shapes="_x0000_i1094"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US><span style='mso-spacerun:yes'> </span>‘5.6.10 Reduce</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>KeyedStream </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US> DataStream</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：一个分组数据流的聚合操作，合并当前的元素和上次聚合的结果，产生一个新的值，返回的流中包含每一次聚合的结果，而不是只返回最后一次聚合的最终结果。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream =
env.readTextFile(&quot;test.txt&quot;).flatMap(item =&gt; item.split(&quot;
&quot;)).map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#538135'>// wordcount<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = stream.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>结果却是这样子的（后面讲窗口函数）</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1095" type="#_x0000_t75" style='width:328.8pt;height:349.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image127.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=548 height=583
src="Flink.files/image127.png" v:shapes="_x0000_i1095"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='text-indent:15.05pt;mso-char-indent-count:1.0'><span lang=EN-US>5.6.11
Fold</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>KeyedStream </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US> DataStream</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：一个有初始值的分组数据流的滚动折叠操作，合并当前元素和前一次折叠操作的结果，并产生一个新的值，返回的流中包含每一次折叠的结果，而不是只返回最后一次折叠的最终结果。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream =
env.readTextFile(&quot;test.txt&quot;).flatMap(item =&gt; item.split(&quot;
&quot;)).map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = stream.fold(100)(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(begin, item) =&gt;
(begin + item._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<h3><span lang=EN-US>5.6.12 Aggregations</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span lang=EN-US>KeyedStream </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>→</span><span
lang=EN-US> DataStream</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>：分组数据流上的滚动聚合操作。</span><span
lang=EN-US>min</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>和</span><span lang=EN-US>minBy</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的区别是</span><span lang=EN-US>min</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>返回的是一个最小值，而</span><span lang=EN-US>minBy</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>返回的是其字段中包含最小值的元素</span><span lang=EN-US>(</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>同样原理适用于</span><span lang=EN-US>max</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>和</span><span lang=EN-US>maxBy)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，返回的流中包含每一次聚合的结果，而不是只返回最后一次聚合的最终结果。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.sum(0) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.sum(&quot;key&quot;) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.min(0) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.min(&quot;key&quot;) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.max(0) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.max(&quot;key&quot;) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.minBy(0) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.minBy(&quot;key&quot;) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.maxBy(0) <o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>keyedStream.maxBy(&quot;key&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:0'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream =
env.readTextFile(&quot;test02.txt&quot;).map(item =&gt; (item.split(&quot;
&quot;)(0), item.split(&quot; &quot;)(1).toLong)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = stream.sum(1)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;FirstJob&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:0'><span
lang=EN-US><span style='mso-spacerun:yes'>    </span></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>在</span><span lang=EN-US>2.3.10</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>之前的算子都是可以直接作用在</span><span lang=EN-US>Stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>上的，因为他们不是聚合类型的操作，但是到</span><span lang=EN-US>2.3.10</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>后你会发现，我们虽然可以对一个无边界的流数据直接应用聚合算子，但是它会记录下每一次的聚合结果，这往往不是我们想要的，其实，</span><span
lang=EN-US style='color:red'>reduce</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:red'>、</span><span lang=EN-US style='color:red'>fold</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>、</span><span lang=EN-US style='color:red'>aggregation</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>这些聚合算子都是和</span><span lang=EN-US style='color:
red'>Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>配合使用的，只有配合</span><span
lang=EN-US style='color:red'>Window</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:red'>，才能得到想要的结果。</span><span lang=EN-US style='color:red'><o:p></o:p></span></p>

<h1><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>第六章</span> <span lang=EN-US>Time</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>与</span><span lang=EN-US>Window</span></h1>

<h2><span lang=EN-US>6.1 Time</span></h2>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>在</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的流式处理中，会涉及到时间的不同概念，如下图所示：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1096"
 type="#_x0000_t75" style='width:385.2pt;height:184.2pt'>
 <v:imagedata src="Flink.files/image129.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\41410ff7-573b-46d9-b299-4a5b591a12a6\128\index_files\af567ec1-1fdb-4b1d-94b7-b49acc0a1ba6.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=642 height=307
src="Flink.files/image130.png" v:shapes="_x0000_i1096"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>时间概念</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>Event Time</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：是事件创建的时间。它通常由事件中的时间戳描述，例如采集的日志数据中，每一条日志都会记录自己的生成时间，</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>通过时间戳分配器访问事件时间戳。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>Ingestion Time</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：是数据进入</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的时间。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US>Processing Time</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：是每一个执行基于时间操作的算子的本地系统时间，与机器相关，默认的时间属性就是</span><span
lang=EN-US>Processing Time</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>例如，一条日志进入</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的时间为</span><span lang=EN-US>2017-11-12 10:00:00.123</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，到达</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的系统时间为</span><span lang=EN-US>2017-11-12 10:00:01.234</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，日志的内容如下：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>2017-11-02 18:37:15.624 INFO Fail over to rm2<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>对于业务来说，要统计</span><span
lang=EN-US>1min</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>内的故障日志个数，哪个时间是最有意义的？——</span><span
lang=EN-US> eventTime</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，因为我们要根据日志的生成时间进行统计。</span></p>

<h2><span lang=EN-US>6.2 Window</span></h2>

<h3 style='text-indent:15.05pt;mso-char-indent-count:1.0'><span lang=EN-US>6.2.1
Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>概述</span></h3>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>streaming</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>流式计算是一种被设计用于处理无限数据集的数据处理引擎，而无限数据集是指一种不断增长的本质上无限的数据集，而</span><span
lang=EN-US>window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是一种切割无限数据为有限块进行处理的手段。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是无限数据流处理的核心，</span><span lang=EN-US>fWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>将一个无限的</span><span lang=EN-US>stream</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>拆分成有限大小的”</span><span lang=EN-US>buckets</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>”桶，我们可以在这些桶上做计算操作。做聚合操作，必须制定</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，否则聚合的数据不是我们想要的。</span></p>

<h3><span lang=EN-US>6.2.2 Window</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>类型</span></h3>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>可以分成两类（</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>种）：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:44.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l3 level1 lfo10'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>CountWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：按照指定的数据条数生成一个</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，与时间无关。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:44.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l3 level1 lfo10'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>TimeWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：按照时间生成</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，不管有没有数据都会切一个窗口，没有数据就不输出。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:11.0pt;mso-add-space:auto;mso-char-indent-count:0'><span
lang=EN-US>CountWindow</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>可以分成滚动窗口（</span><span
lang=EN-US>Tumbling Window</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）、滑动窗口（</span><span
lang=EN-US>Sliding Window</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:11.0pt;mso-add-space:auto;mso-char-indent-count:0'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>对于</span><span lang=EN-US>TimeWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，可以根据窗口实现原理的不同分成三类：滚动窗口（</span><span lang=EN-US>Tumbling
Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）、滑动窗口（</span><span lang=EN-US>Sliding
Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）和会话窗口（</span><span lang=EN-US>Session
Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）。</span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:40.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:l4 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>滚动窗口（</span><span
lang=EN-US>Tumbling Windows</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>）</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>将数据依据固定的窗口长度对数据进行切片</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>特点</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：<b style='mso-bidi-font-weight:normal'><span
style='color:red'>时间对齐，窗口长度固定，没有重叠</span></b>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>滚动窗口分配器将每个元素分配到一个指定窗口大小的窗口中，滚动窗口有一个固定的大小，并且不会出现重叠。例如：如果你指定了一个</span><span
lang=EN-US>5</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>分钟大小的滚动窗口，窗口的创建如下图所示：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1097"
 type="#_x0000_t75" style='width:340.2pt;height:210.6pt'>
 <v:imagedata src="Flink.files/image131.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\a60dc494-a3b8-4078-a368-e6a9fe8334e2\128\index_files\e3dece4d-e6f9-4d99-aa5a-89298c4522e1.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=567 height=351
src="Flink.files/image132.png" v:shapes="_x0000_i1097"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>滚动窗口</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>适用场景</span></b><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>：适合做</span><span lang=EN-US style='background:white'>BI</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>统计等（做每个时间段的聚合计算）。</span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:40.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:l4 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>滑动窗口（</span><span
lang=EN-US>Sliding Windows</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>）</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>滑动窗口是固定窗口的更广义的一种形式，滑动窗口由固定的窗口长度和滑动间隔组成</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>特点</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：<b style='mso-bidi-font-weight:normal'><span
style='color:red'>时间对齐，窗口长度固定，有重叠（也可以没有重叠，跟</span></b></span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>spark</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>的一样）</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>滑动窗口分配器将元素分配到固定长度的窗口中，与滚动窗口类似，窗口的大小由窗口大小参数来配置，另一个窗口滑动参数控制滑动窗口开始的频率。因此，滑动窗口如果滑动参数小于窗口大小的话，窗口是可以重叠的，在这种情况下元素会被分配到多个窗口中。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>例如，你有</span><span lang=EN-US>10</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分钟的窗口和</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分钟的滑动，那么每个窗口中</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分钟的窗口里包含着上个</span><span lang=EN-US>10</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>分钟产生的数据，如下图所示：</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1098"
 type="#_x0000_t75" style='width:328.8pt;height:202.8pt'>
 <v:imagedata src="Flink.files/image133.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\a60dc494-a3b8-4078-a368-e6a9fe8334e2\128\index_files\a1fe1834-9347-4bcf-b72a-2ae418fe5552.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=548 height=338
src="Flink.files/image134.png" v:shapes="_x0000_i1098"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>滑动窗口</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span
style='font-family:宋体;mso-ascii-font-family:Helvetica;mso-hansi-font-family:
Helvetica;mso-bidi-font-family:Helvetica;color:black;background:white'>适用场景</span></b><span
style='font-family:宋体;mso-ascii-font-family:Helvetica;mso-hansi-font-family:
Helvetica;mso-bidi-font-family:Helvetica;color:black;background:white'>：对最近一个时间段内的统计（求某接口最近</span><span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black;background:
white'>5min</span><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>的失败率来决定是否要报警）。</span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:40.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:l4 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>会话窗口（</span><span
lang=EN-US>Session Windows</span><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>）</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>由一系列事件组合一个指定时间长度的</span><span
lang=EN-US style='color:red'>timeout</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>间隙组成，类似于</span><span
lang=EN-US style='color:red'>web</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>应用的</span><span lang=EN-US style='color:red'>session</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>，也就是一段时间没有接收到新数据就会生成新的窗口</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。（比如两个数据进来，这俩进来的间隔超过指定的时间大小比如</span><span lang=EN-US>10s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，则触发第一个数据生成的窗口，发送出去）</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>特点</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：<b style='mso-bidi-font-weight:normal'><span
style='color:red'>时间无对齐</span></b>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>session</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>窗口分配器通过</span><span lang=EN-US>session</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>活动来对元素进行分组，</span><span lang=EN-US>session</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>窗口跟滚动窗口和滑动窗口相比，不会有重叠和固定的开始时间和结束时间的情况，相反，<b style='mso-bidi-font-weight:
normal'><span style='color:red'>当它在一个固定的时间周期内不再收到元素，即非活动间隔产生，那个这个窗口就会关闭</span></b>。一个</span><span
lang=EN-US>session</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>窗口通过一个</span><span
lang=EN-US>session</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>间隔来配置，这个</span><span
lang=EN-US>session</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>间隔定义了非活跃周期的长度，当这个非活跃周期产生，那么当前的</span><span
lang=EN-US>session</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>将关闭并且后续的元素将被分配到新的</span><span
lang=EN-US>session</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>窗口中去。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1099"
 type="#_x0000_t75" style='width:343.2pt;height:201.6pt'>
 <v:imagedata src="Flink.files/image135.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\a60dc494-a3b8-4078-a368-e6a9fe8334e2\128\index_files\3b3d55c4-89e1-4125-8a36-2306d600afaa.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=572 height=336
src="Flink.files/image136.png" v:shapes="_x0000_i1099"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会话窗口</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2 style='margin-left:36.0pt;text-indent:-36.0pt;mso-list:l1 level2 lfo17'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial;mso-bidi-font-family:Arial'><span
style='mso-list:Ignore'>6.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Window API</span></h2>

<h3 style='margin-left:36.0pt;text-indent:-36.0pt;mso-list:l1 level3 lfo17'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:"Times New Roman"'><span
style='mso-list:Ignore'>6.3.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>CountWindow</span></h3>

<p class=MsoNormal><span lang=EN-US>64</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>CountWindow</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>根据窗口中相同</span><span
lang=EN-US style='color:red'>key</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>元素的数量来触发执行，执行时只计算元素数量达到窗口大小的</span><span
lang=EN-US style='color:red'>key</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>对应的结果</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>注意：</span><span
lang=EN-US style='color:red'>CountWindow</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的</span><span lang=EN-US
style='color:red'>window_size</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>指的是相同</span><span lang=EN-US style='color:red'>Key</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>的元素的个数，不是输入的所有元素的总数</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:22.5pt;text-indent:-22.5pt;mso-char-indent-count:0;mso-list:l9 level1 lfo21'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>滚动窗口</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>默认的</span><span
lang=EN-US>CountWindow</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>是一个滚动窗口，只需要指定窗口大小即可，当元素数量达到窗口大小时，就会触发窗口的执行。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item.split(&quot;
&quot;)(0), item.split(&quot; &quot;)(1).toLong)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>这里的</span><span lang=EN-US style='color:#00B050'>5</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>指的是</span><span
lang=EN-US style='color:#00B050'>5</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>个相同</span><span lang=EN-US
style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>的元素计算一次</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.</span><span lang=EN-US
style='color:red'>countWindow(5)</span><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>结果</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1100" type="#_x0000_t75" style='width:567pt;height:174.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image137.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=291
src="Flink.files/image137.png" v:shapes="_x0000_i1100"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>是单个</span><span
lang=EN-US style='mso-no-proof:yes'>key</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-no-proof:yes'>满足</span><span lang=EN-US style='mso-no-proof:yes'>countWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";mso-no-proof:yes'>条件才触发</span><span lang=EN-US
style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1101" type="#_x0000_t75" style='width:567pt;height:196.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image139.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=328
src="Flink.files/image139.png" v:shapes="_x0000_i1101"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>再来</span><span
lang=EN-US style='mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1102" type="#_x0000_t75" style='width:567pt;height:194.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image141.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=324
src="Flink.files/image141.png" v:shapes="_x0000_i1102"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:22.5pt;text-indent:-22.5pt;mso-char-indent-count:0;mso-list:l9 level1 lfo21'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:黑体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial'>滑动窗口</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>滑动窗口和滚动窗口的函数名是完全一致的，只是在传参数时需要传入两个参数，一个是</span><span
lang=EN-US>window_size</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，一个是</span><span
lang=EN-US>sliding_size</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>下面代码中的</span><span lang=EN-US>sliding_size</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>设置为了</span><span lang=EN-US>2</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，也就是说，每收到两个相同</span><span
lang=EN-US>key</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的数据就计算一次，每一次计算的</span><span
lang=EN-US>window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>范围是</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>个元素。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item.split(&quot;
&quot;)(0), item.split(&quot; &quot;)(1).toLong)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>当相同</span><span lang=EN-US style='color:#00B050'>key</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>的元素个数达到</span><span
lang=EN-US style='color:#00B050'>2</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>个时（即滑动步长为</span><span
lang=EN-US style='color:#00B050'>2</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>），触发窗口计算，计算的窗口范围为</span><span
lang=EN-US style='color:#00B050'>5<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.</span><span lang=EN-US
style='color:red'>countWindow(5,2)</span><span lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>理解</span><span lang=EN-US>spark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的窗口，这里就很简单啦</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1103" type="#_x0000_t75" style='width:566.4pt;height:154.2pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image142.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=257
src="Flink.files/image142.png" v:shapes="_x0000_i1103"><![endif]></span></p>

<h3 style='margin-left:36.0pt;text-indent:-36.0pt;mso-list:l1 level3 lfo17'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:"Times New Roman"'><span
style='mso-list:Ignore'>6.3.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>TimeWindow</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>TimeWindow</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是将指定时间范围内的所有数据组成一个</span><span lang=EN-US>window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，一次对一个</span><span lang=EN-US>window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>里面的所有数据进行计算。</span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:39.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:l10 level1 lfo15'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>滚动窗口</span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>默认的时间窗口根据</span><span lang=EN-US>Processing Time </span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进行窗口的划分，将</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>获取到的数据根据进入</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的时间划分到不同的窗口中。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入时间窗口。</span><span lang=EN-US style='color:#00B050'>Processing
Time</span></b><b style='mso-bidi-font-weight:normal'><span style='font-family:
宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:"Courier New";
color:#00B050'>是</span><span lang=EN-US style='color:#00B050'>5</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>，即每</span><span
lang=EN-US style='color:#00B050'>5</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>秒切一个</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.</span><span lang=EN-US
style='color:red'>timeWindow(Time.seconds(5))</span><span lang=EN-US
style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>时间间隔可以通过</span><span lang=EN-US style='background:white'>Time.milliseconds(x)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>，</span><span lang=EN-US style='background:
white'>Time.seconds(x)</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";background:white'>，</span><span
lang=EN-US style='background:white'>Time.minutes(x)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>等其中的一个来指定。</span><span lang=EN-US
style='background:white'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1104" type="#_x0000_t75" style='width:567pt;height:75.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image144.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=126
src="Flink.files/image144.png" v:shapes="_x0000_i1104"><![endif]></span></p>

<p class=a6 style='margin-top:6.2pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:39.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:l10 level1 lfo15'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:Arial'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-family:黑体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>滑动窗口（</span><span
lang=EN-US>SlidingEventTimeWindows</span><span style='font-family:黑体;
mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>）</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>滑动窗口和滚动窗口的函数名是完全一致的，只是在传参数时需要传入两个参数，一个是</span><span
lang=EN-US>window_size</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，一个是</span><span
lang=EN-US>sliding_size</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>下面代码中的</span><span lang=EN-US>sliding_size</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>设置为了</span><span lang=EN-US>2s</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，也就是说，窗口每</span><span
lang=EN-US>2s</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>就计算一次，每一次计算的</span><span lang=EN-US>window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>范围是</span><span lang=EN-US>5s</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>内的所有元素。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口，窗口大小为</span><span lang=EN-US
style='color:#00B050'>10</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>秒，滑动步长为</span><span lang=EN-US style='color:#00B050'>2</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>秒，即每</span><span
lang=EN-US style='color:#00B050'>2</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>秒执行一次，窗口大小是最新的</span><span
lang=EN-US style='color:#00B050'>10</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>秒数据</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.</span><span lang=EN-US
style='color:red'>timeWindow(Time.seconds(5), Time.seconds(2))</span><span
lang=EN-US style='color:black'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
background:white'>时间间隔可以通过</span><span lang=EN-US style='background:white'>Time.milliseconds(x)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>，</span><span lang=EN-US style='background:
white'>Time.seconds(x)</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";background:white'>，</span><span
lang=EN-US style='background:white'>Time.minutes(x)</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>等其中的一个来指定。</span><span lang=EN-US
style='background:white'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>输入之后停止不输入，每</span><span lang=EN-US>2</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>秒就输出一次，窗口大小不够，所以都一样了</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1105" type="#_x0000_t75" style='width:566.4pt;height:100.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image146.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=168
src="Flink.files/image146.png" v:shapes="_x0000_i1105"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US>6.3.3 Window Reduce</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US>WindowedStream </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>→</span><span lang=EN-US> DataStream</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>：给</span><span lang=EN-US>window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>赋一个</span><span lang=EN-US>reduce</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>功能的函数，并返回一个聚合的结果。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入时间窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.timeWindow(Time.seconds(5))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<h3 style='margin-left:36.0pt;text-indent:-36.0pt;mso-list:l7 level3 lfo22'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:"Times New Roman"'><span
style='mso-list:Ignore'>6.3.4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Window Fold</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>WindowedStream
→ DataStream</span></b><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>：给窗口赋一个</span><span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black;background:white'>fold</span><span style='font-family:宋体;
mso-ascii-font-family:Helvetica;mso-hansi-font-family:Helvetica;mso-bidi-font-family:
Helvetica;color:black;background:white'>功能的函数，并返回一个</span><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>fold</span><span
style='font-family:宋体;mso-ascii-font-family:Helvetica;mso-hansi-font-family:
Helvetica;mso-bidi-font-family:Helvetica;color:black;background:white'>后的结果。</span><span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black;background:
white'><o:p></o:p></span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111,'\n',3)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item, 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.timeWindow(Time.seconds(5))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行</span><span lang=EN-US style='color:#00B050'>fold</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>操作</span><span
lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamFold = streamWindow.fold(100){<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(begin, item) =&gt;<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>begin + item._2<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamFold.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<h3 style='margin-left:36.0pt;text-indent:-36.0pt;mso-list:l7 level3 lfo22'><![if !supportLists]><span
lang=EN-US style='mso-fareast-font-family:"Times New Roman"'><span
style='mso-list:Ignore'>6.3.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Aggregation on Window</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>WindowedStream
→ DataStream</span></b><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>：对一个</span><span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black;background:white'>window</span><span style='font-family:宋体;
mso-ascii-font-family:Helvetica;mso-hansi-font-family:Helvetica;mso-bidi-font-family:
Helvetica;color:black;background:white'>内的所有元素做聚合操作。</span><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>min</span><span
style='font-family:宋体;mso-ascii-font-family:Helvetica;mso-hansi-font-family:
Helvetica;mso-bidi-font-family:Helvetica;color:black;background:white'>和</span><span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black;background:
white'> minBy</span><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>的区别是</span><span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black;background:white'>min</span><span style='font-family:宋体;mso-ascii-font-family:
Helvetica;mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;
color:black;background:white'>返回的是最小值，而</span><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>minBy</span><span
style='font-family:宋体;mso-ascii-font-family:Helvetica;mso-hansi-font-family:
Helvetica;mso-bidi-font-family:Helvetica;color:black;background:white'>返回的是包含最小值字段的元素</span><span
lang=EN-US style='font-family:"Helvetica","sans-serif";color:black;background:
white'>(</span><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>同样的原理适用于</span><span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black;background:white'> max </span><span style='font-family:宋体;
mso-ascii-font-family:Helvetica;mso-hansi-font-family:Helvetica;mso-bidi-font-family:
Helvetica;color:black;background:white'>和</span><span lang=EN-US
style='font-family:"Helvetica","sans-serif";color:black;background:white'>
maxBy)</span><span style='font-family:宋体;mso-ascii-font-family:Helvetica;
mso-hansi-font-family:Helvetica;mso-bidi-font-family:Helvetica;color:black;
background:white'>。</span><span lang=EN-US style='font-family:"Helvetica","sans-serif";
color:black;background:white'><o:p></o:p></span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.map(item =&gt; (item.split(&quot;
&quot;)(0), item.split(&quot; &quot;)(1))).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.timeWindow(Time.seconds(5))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamMax = streamWindow.max(1)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamMax.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<h1><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";background:white'>第七章</span><span
style='background:white'> <span lang=EN-US>EventTime</span></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";background:white'>与</span><span lang=EN-US style='background:
white'>Window<o:p></o:p></span></h1>

<h2><span lang=EN-US>7.1 EventTime</span><span style='font-family:黑体;
mso-ascii-font-family:Arial;mso-hansi-font-family:Arial'>的引入</span></h2>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>在</span><span
lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的流式处理中，绝大部分的业务都会使用</span><span
lang=EN-US style='color:red'>eventTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>，一般只在</span><span
lang=EN-US style='color:red'>eventTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>无法使用时，才会被迫使用</span><span
lang=EN-US style='color:red'>ProcessingTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>或者</span><span lang=EN-US
style='color:red'>IngestionTime</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>如果要使用</span><span lang=EN-US>EventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，那么需要引入</span><span lang=EN-US>EventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的时间属性，引入方式如下所示：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>从调用时刻开始给</span><span lang=EN-US style='color:#00B050'>env</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>创建的每一个</span><span
lang=EN-US style='color:#00B050'>stream</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>追加时间特征</span><span
lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)<span
style='mso-spacerun:yes'>  </span>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:black'>把默认的</span><span lang=EN-US
style='color:black'>processing time</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:black'>改为</span><span lang=EN-US
style='color:black'>eventtime<o:p></o:p></span></b></p>

<h2><span lang=EN-US>7.2 Watermark</span></h2>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>解决乱序问题。</span></p>

<h3><span lang=EN-US>7.2.1 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>基本概念</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>我们知道，流处理从事件产生，到流经</span><span
lang=EN-US>source</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，再到</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，中间是有一个过程和时间的，虽然大部分情况下，流到</span><span lang=EN-US>operator</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的数据都是按照事件产生的时间顺序来的，但是也不排除由于网络、背压等原因，导致乱序的产生，所谓乱序，就是指</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>接收到的事件的先后顺序不是严格按照事件的</span><span
lang=EN-US>Event Time</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>顺序排列的。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1106"
 type="#_x0000_t75" style='width:220.2pt;height:150pt'>
 <v:imagedata src="Flink.files/image147.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\252a127f-cd70-4246-a1ef-95e58428f4c8\128\index_files\99c95e2b-4890-413e-ac22-a1f1737f97de.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=367 height=250
src="Flink.files/image148.png" v:shapes="_x0000_i1106"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>数据的乱序</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>那么此时出现一个问题，一旦出现乱序，如果只根据</span><span lang=EN-US>eventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>决定</span><span lang=EN-US>window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的运行，我们不能明确数据是否全部到位，但又不能无限期的等下去，此时必须要有个机制来保证一个特定的时间后，必须触发</span><span
lang=EN-US>window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>去进行计算了，这个特别的机制，就是</span><span
lang=EN-US>Watermark</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是一种衡量</span><span lang=EN-US>Event Time</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>进展的机制，它是数据本身的一个隐藏属性，数据本身携带着对应的</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Watermark</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>是用于处理乱序事件的，而正确的处理乱序事件，通常用</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>机制结合</span><span lang=EN-US
style='color:red'>window</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>来实现</span></b><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>数据流中的</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>用于表示</span><span lang=EN-US
style='color:red'>EventTime</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>小于</span><span lang=EN-US style='color:red'>Watermark</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>的数据，都已经到达了，因此，</span><span
lang=EN-US style='color:red'>window</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的执行也是由</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>触发的</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Watermark</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>可以理解成一个延迟触发机制，我们可以设置</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的延时时长</span><span
lang=EN-US style='color:red'>t</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>，每次系统会校验已经到达的数据中最大的</span><span lang=EN-US
style='color:red'>maxEventTime</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>，然后认定</span><span lang=EN-US style='color:red'>eventTime</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>小于</span><span
lang=EN-US style='color:red'>maxEventTime - t</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的所有数据都已经到达，如果有窗口的停止时间等于</span><span
lang=EN-US style='color:red'>maxEventTime – t</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>，那么这个窗口被触发执行</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>有序流的</span><span lang=EN-US>Watermarker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>如下图所示：（</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>设置为</span><span lang=EN-US>0</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1107"
 type="#_x0000_t75" style='width:398.4pt;height:61.8pt'>
 <v:imagedata src="Flink.files/image149.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\252a127f-cd70-4246-a1ef-95e58428f4c8\128\index_files\796640b3-0750-4267-a73f-bd2d8d6e3b61.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=664 height=103
src="Flink.files/image150.png" v:shapes="_x0000_i1107"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>有序数据的</span><span
lang=EN-US>Watermark</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1108" type="#_x0000_t75" style='width:7in;height:234.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image151.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=840 height=391
src="Flink.files/image151.png" v:shapes="_x0000_i1108"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>乱序流的</span><span
lang=EN-US>Watermarker</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>如下图所示：（</span><span
lang=EN-US>Watermark</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>设置为</span><span
lang=EN-US>2</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>）</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1109"
 type="#_x0000_t75" style='width:394.2pt;height:60pt'>
 <v:imagedata src="Flink.files/image153.png" o:href="file:///C:\Users\CrazyJack\Documents\My%20Knowledge\temp\252a127f-cd70-4246-a1ef-95e58428f4c8\128\index_files\1f914470-1ba1-42dc-9d33-4c8c192ddee3.png"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=657 height=100
src="Flink.files/image154.png" v:shapes="_x0000_i1109"><![endif]></span></p>

<p class=a9 style='margin-top:1.55pt;margin-right:0cm;margin-bottom:6.2pt;
margin-left:0cm'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>图</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>无序数据的</span><span
lang=EN-US>Watermark</span></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>当</span><span
lang=EN-US style='color:red'>Flink</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>接收到每一条数据时，都会产生一条</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>，这条</span><span lang=EN-US
style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>就等于当前所有到达数据中的</span><span lang=EN-US
style='color:red'>maxEventTime - </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>延迟时长，也就是说，</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>是由数据携带的，一旦数据携带的</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>比当前未触发的窗口的停止时间要晚，那么就会触发相应窗口的执行。由于</span><span
lang=EN-US style='color:red'>Watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>是由数据携带的，因此，如果运行过程中无法获取新的数据，那么没有被触发的窗口将永远都不被触发</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>上图中，我们设置的允许最大延迟到达时间为</span><span lang=EN-US>2s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，所以时间戳为</span><span lang=EN-US>7s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的事件对应的</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是</span><span lang=EN-US>5s</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，时间戳为</span><span
lang=EN-US>12s</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>的事件的</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是</span><span lang=EN-US>10s</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，如果我们的窗口</span><span
lang=EN-US>1</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>是</span><span lang=EN-US>1s~5s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，窗口</span><span lang=EN-US>2</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>是</span><span
lang=EN-US>6s~10s</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>，那么时间戳为</span><span lang=EN-US>7s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的事件到达时的</span><span lang=EN-US>Watermarker</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>恰好触发窗口</span><span lang=EN-US>1</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，时间戳为</span><span lang=EN-US>12s</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的事件到达时的</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>恰好触发窗口</span><span lang=EN-US>2</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1110" type="#_x0000_t75" style='width:567pt;height:267.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image155.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=446
src="Flink.files/image155.png" v:shapes="_x0000_i1110"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US>7.2.2 Watermark</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的引入</span></h3>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>这种不好测试。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>从调用时刻开始给</span><span lang=EN-US style='color:#00B050'>env</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>创建的每一个</span><span
lang=EN-US style='color:#00B050'>stream</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>追加时间特征</span><span
lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream =
env.readTextFile(&quot;eventTest.txt&quot;).assignTimestampsAndWatermarks(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>new
BoundedOutOfOrdernessTimestampExtractor[String](Time.milliseconds(200)) {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>override def
extractTimestamp(t: String): Long = {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span></span><span
lang=EN-US style='color:#00B050'>// EventTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>是日志生成时间，我们从日志中解析</span><span
lang=EN-US style='color:#00B050'>EventTime<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>t.split(&quot;
&quot;)(0).toLong<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>}<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>})<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:0cm;mso-char-indent-count:0'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><span lang=EN-US>7.3 EvnetTimeWindow API</span></h2>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>当使用</span><span
lang=EN-US>EventTimeWindow</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>时，所有的</span><span
lang=EN-US>Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>在</span><span lang=EN-US>EventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的时间轴上进行划分，也就是说，在</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>启动后，会根据初始的</span><span lang=EN-US>EventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>时间每隔一段时间划分一个窗口，如果</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>大小是</span><span lang=EN-US>3</span><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>秒，那么</span><span
lang=EN-US>1</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>分钟内会把</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>划分为如下的形式：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:00,00:00:03)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:03,00:00:06)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>...<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:57,00:01:00)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>如果</span><span
lang=EN-US>Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>大小是</span><span lang=EN-US>10</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>秒，则</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>会被分为如下的形式：</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:00,00:00:10)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:10,00:00:20)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>...<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>[00:00:50,00:01:00)<o:p></o:p></span></b></p>

<p class=aeCxSpFirst style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
color:red'>注意，窗口是左闭右开的，形式为：</span><span lang=EN-US style='color:red'>[window_start_time,window_end_time)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>。</span><span
lang=EN-US style='color:red'><o:p></o:p></span></b></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><b style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:red'>Window</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>的设定无关数据本身，而是系统定义好了的，也就是说，</span><span
lang=EN-US style='color:red'>Window</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>会一直按照指定的时间间隔进行划分，不论这个</span><span
lang=EN-US style='color:red'>Window</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>中有没有数据，</span><span
lang=EN-US style='color:red'>EventTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>在这个</span><span lang=EN-US
style='color:red'>Window</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>期间的数据会进入这个</span><span lang=EN-US
style='color:red'>Window</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span lang=EN-US>Window</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会不断产生，属于这个</span><span
lang=EN-US>Window</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>范围的数据会被不断加入到</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中，所有未被触发的</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>都会等待触发，只要</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>还没触发，属于这个</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>范围的数据就会一直被加入到</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>中，直到</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>被触发才会停止数据的追加，而当</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>触发之后才接受到的属于被触发</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的数据会被丢弃。</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:21.0pt;mso-char-indent-count:
0'><span lang=EN-US>Window</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会在以下的条件满足时被触发执行：</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:44.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l17 level1 lfo23'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:red'>watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>时间</span><span lang=EN-US
style='color:red'> &gt;= window_end_time</span></b><span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>；</span></p>

<p class=aeCxSpMiddle style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:44.0pt;mso-add-space:auto;text-indent:-21.0pt;mso-char-indent-count:
0;mso-list:l17 level1 lfo23'><![if !supportLists]><span lang=EN-US
style='font-family:Wingdings;mso-fareast-font-family:Wingdings;mso-bidi-font-family:
Wingdings'><span style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman";color:red'>在</span><span lang=EN-US style='color:red'>[window_start_time,window_end_time)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:red'>中有数据存在</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=aeCxSpLast style='margin-top:3.1pt;margin-right:0cm;margin-bottom:
3.1pt;margin-left:0cm;mso-add-space:auto;text-indent:23.0pt'><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>我们通过下图来说明</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>、</span><span lang=EN-US>EventTime</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>和</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的关系。</span></p>

<p class=ac><span lang=EN-US><!--[if gte vml 1]><v:shape id="_x0000_i1111"
 type="#_x0000_t75" style='width:375pt;height:173.4pt;visibility:visible'>
 <v:imagedata src="Flink.files/image157.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=625 height=289
src="Flink.files/image157.png" v:shapes="_x0000_i1111"><![endif]></span></p>

<h3><span lang=EN-US>7.3.1 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>滚动窗口（</span><span
lang=EN-US>TumblingEventTimeWindows</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span></h3>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.assignTimestampsAndWatermarks(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span></span><span
lang=EN-US style='color:#538135'>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#538135'>告诉</span><span lang=EN-US
style='color:#538135'>Flink</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#538135'>，怎么获取</span><span lang=EN-US style='color:#538135'>eventTime</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#538135'>。</span><span
lang=EN-US style='color:#70AD47'>Time.milliseconds(0)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#70AD47'>延迟多少毫秒，即</span><span
lang=EN-US style='color:#70AD47'>watermark</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#70AD47'>，为</span><span lang=EN-US
style='color:#70AD47'>0</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#70AD47'>就没有延迟</span><span lang=EN-US style='color:#538135'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(0)</span><span lang=EN-US style='color:
black'>) {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>override def
extractTimestamp(element: String): Long = {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>       </span></span><span
lang=EN-US style='color:#70AD47'>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#70AD47'>进来的一条数据，数据格式是</span><span
lang=EN-US style='color:#70AD47'>eventTime word<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'> </span><span style='mso-spacerun:yes'> </span>val
eventTime = element.split(&quot; &quot;)(0).toLong<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>println(eventTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>       </span></span><span
lang=EN-US style='color:#70AD47'>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#70AD47'>返回</span><span lang=EN-US
style='color:#70AD47'>eventTime<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>eventTime<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>}}).map(item =&gt;
(item.split(&quot; &quot;)(1), 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滚动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.window(</span><span
lang=EN-US style='color:red'>TumblingEventTimeWindows.of(Time.seconds(5))</span><span
lang=EN-US style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print()<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>结果是按照</span><span
lang=EN-US style='color:red'>Event Time</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的时间窗口计算得出的，而无关系统的时间（包括输入的快慢）</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>没有延迟，也就是单纯看滚动窗口。</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1112" type="#_x0000_t75" style='width:567pt;height:168.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image159.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=281
src="Flink.files/image159.png" v:shapes="_x0000_i1112"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1113" type="#_x0000_t75" style='width:566.4pt;height:259.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image161.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=433
src="Flink.files/image161.png" v:shapes="_x0000_i1113"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>改</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='color:black'>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(3000)</span><span lang=EN-US
style='color:black'>)</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，即</span><span
lang=EN-US>Watermark</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>为</span><span
lang=EN-US>3</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>秒，也就是延迟</span><span lang=EN-US>3</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>秒。</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1114" type="#_x0000_t75" style='width:566.4pt;height:231pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image163.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=385
src="Flink.files/image163.png" v:shapes="_x0000_i1114"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1115" type="#_x0000_t75" style='width:567pt;height:158.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image165.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=264
src="Flink.files/image165.png" v:shapes="_x0000_i1115"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1116" type="#_x0000_t75" style='width:566.4pt;height:144.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image167.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=241
src="Flink.files/image167.png" v:shapes="_x0000_i1116"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US>7.3.2 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>滑动窗口（</span><span
lang=EN-US>SlidingEventTimeWindows</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span></h3>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env = StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.assignTimestampsAndWatermarks(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span></span><span
lang=EN-US style='color:#70AD47'>// </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#70AD47'>没有延迟，先单纯看滑动窗口</span><span
lang=EN-US style='color:#70AD47'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(0)</span><span lang=EN-US style='color:
black'>) {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>override def
extractTimestamp(element: String): Long = {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>val sysTime = element.split(&quot;
&quot;)(0).toLong<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>println(sysTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>sysTime<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>}}).map(item =&gt;
(item.split(&quot; &quot;)(1), 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入滑动窗口</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow =
streamKeyBy.window(SlidingEventTimeWindows.of(</span><span lang=EN-US
style='color:red'>Time.seconds(10), Time.seconds(5)</span><span lang=EN-US
style='color:black'>))<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1117" type="#_x0000_t75" style='width:566.4pt;height:195.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image169.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=326
src="Flink.files/image169.png" v:shapes="_x0000_i1117"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1118" type="#_x0000_t75" style='width:566.4pt;height:172.2pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image171.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=287
src="Flink.files/image171.png" v:shapes="_x0000_i1118"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1119" type="#_x0000_t75" style='width:566.4pt;height:156pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image173.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=260
src="Flink.files/image173.png" v:shapes="_x0000_i1119"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1120" type="#_x0000_t75" style='width:566.4pt;height:169.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image175.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=283
src="Flink.files/image175.png" v:shapes="_x0000_i1120"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>加上延迟</span><span lang=EN-US>3</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>秒</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='color:black'>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(3000)</span><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1121" type="#_x0000_t75" style='width:566.4pt;height:153.6pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image177.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=944 height=256
src="Flink.files/image177.png" v:shapes="_x0000_i1121"><![endif]></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><span lang=EN-US>7.3.3 </span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>会话窗口（</span><span
lang=EN-US>EventTimeSessionWindows</span><span style='font-family:宋体;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>）</span></h3>

<p class=ae style='margin-top:3.1pt;margin-right:0cm;margin-bottom:3.1pt;
margin-left:0cm;mso-add-space:auto;text-indent:23.1pt'><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>相邻两次数据的</span><span
lang=EN-US style='color:red'>EventTime</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";color:red'>的时间差超过指定的时间间隔就会触发执行</span></b><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>。如果加入</span><span lang=EN-US>Watermark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>，那么当触发执行时，所有满足时间间隔而还没有触发的</span><span lang=EN-US>Window</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>会同时触发执行。</span></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>获取执行环境</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val env =
StreamExecutionEnvironment.getExecutionEnvironment<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>创建</span><span lang=EN-US style='color:#00B050'>SocketSource<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val stream = env.socketTextStream(&quot;localhost&quot;,
11111)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>对</span><span lang=EN-US style='color:#00B050'>stream</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:宋体;mso-ascii-font-family:
"Courier New";mso-hansi-font-family:"Courier New";color:#00B050'>进行处理并按</span><span
lang=EN-US style='color:#00B050'>key</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:宋体;mso-ascii-font-family:"Courier New";
mso-hansi-font-family:"Courier New";color:#00B050'>聚合</span><span lang=EN-US
style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamKeyBy = stream.assignTimestampsAndWatermarks(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(0)</span><span lang=EN-US style='color:
black'>) {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>override def
extractTimestamp(element: String): Long = {<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>val sysTime = element.split(&quot;
&quot;)(0).toLong<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>println(sysTime)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>  </span>sysTime<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-tab-count:1'>    </span>}}).map(item =&gt;
(item.split(&quot; &quot;)(1), 1)).keyBy(0)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>引入会话窗口，相邻超过</span><span lang=EN-US
style='color:#00B050'>5</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>秒就触发</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamWindow = streamKeyBy.window(</span><span
lang=EN-US style='color:red'>EventTimeSessionWindows.withGap(Time.seconds(5))</span><span
lang=EN-US style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行聚合操作</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>val streamReduce = streamWindow.reduce(<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><span style='mso-spacerun:yes'>  </span>(item1, item2)
=&gt; (item1._1, item1._2 + item2._2)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>)<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>将聚合数据写入文件</span><span lang=EN-US style='color:
#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>streamReduce.print<o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'><o:p>&nbsp;</o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:#00B050'>// </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:宋体;mso-ascii-font-family:"Courier New";mso-hansi-font-family:
"Courier New";color:#00B050'>执行程序</span><span lang=EN-US style='color:#00B050'><o:p></o:p></span></b></p>

<p class=a0><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='color:black'>env.execute(&quot;TumblingWindow&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>相邻相差超过</span><span lang=EN-US>5</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>秒</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1122" type="#_x0000_t75" style='width:567pt;height:212.4pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image179.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=354
src="Flink.files/image179.png" v:shapes="_x0000_i1122"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman";mso-no-proof:yes'>改为</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='color:black'>new
BoundedOutOfOrdernessTimestampExtractor[String](</span><span lang=EN-US
style='color:red'>Time.milliseconds(3000)</span><span lang=EN-US
style='color:black'>)</span></b><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>，即延迟</span><span
lang=EN-US style='color:black'>3</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>秒，结合相邻的数据相差</span><span
lang=EN-US style='color:black'>5</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>秒，故相邻的数据要相差</span><span
lang=EN-US style='color:black'>8</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman";color:black'>秒才触发</span><span
lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1123" type="#_x0000_t75" style='width:567pt;height:172.8pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image181.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=288
src="Flink.files/image181.png" v:shapes="_x0000_i1123"><![endif]></span><span
lang=EN-US style='color:black'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><!--[if gte vml 1]><v:shape
 id="_x0000_i1124" type="#_x0000_t75" style='width:567pt;height:171pt;
 visibility:visible'>
 <v:imagedata src="Flink.files/image183.png" o:title=""/>
</v:shape><![endif]--><![if !vml]><img border=0 width=945 height=285
src="Flink.files/image183.png" v:shapes="_x0000_i1124"><![endif]><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h1><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>第八章</span> <span style='font-family:
宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>总结</span></h1>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>       </span>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>是一个真正意义上的流计算引擎，在满足低延迟和低容错开销的基础之上，完美的解决了</span><span
lang=EN-US>exactly-once</span><span style='font-family:宋体;mso-ascii-font-family:
"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的目标，正是由于</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>具有诸多优点，越来越多的企业开始使用</span><span
lang=EN-US>Flink</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>作为流处理框架，逐步替换掉了原本的</span><span
lang=EN-US>Storm</span><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>和</span><span lang=EN-US>Spark</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>技术框架。</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-tab-count:1'>       </span></span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>本课程对</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的基本概念进行了讲解，并对</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>的流处理进行了较为详细的解析，希望能够帮助同学们入门</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>技术框架，让同学们能够使用</span><span lang=EN-US>Flink</span><span
style='font-family:宋体;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:
"Times New Roman"'>完成更为完美的流式处理任务。</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>更多见阿里公开教程：</span><span lang=EN-US><a
href="https://github.com/flink-china/flink-training-course">https://github.com/flink-china/flink-training-course</a>
</span></p>

</div>

</body>

</html>
