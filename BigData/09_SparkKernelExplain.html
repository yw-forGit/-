<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 15">
<meta name=Originator content="Microsoft Word 15">
<link rel=File-List href="09_SparkKernelExplain.files/filelist.xml">
<link rel=Edit-Time-Data href="09_SparkKernelExplain.files/editdata.mso">
<link rel=themeData href="09_SparkKernelExplain.files/themedata.thmx">
<link rel=colorSchemeMapping
href="09_SparkKernelExplain.files/colorschememapping.xml">
</head>

<body lang=ZH-CN style='tab-interval:21.0pt'>

<div class=WordSection1>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:0cm;
margin-bottom:0cm;margin-left:34.0pt;margin-bottom:.0001pt;text-align:center;
text-indent:-.5pt'><span lang=EN-US style='font-size:22.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:22.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>内核解析</span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:29.0pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'>      </span></span><span style='font-size:12.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>作者：尚硅谷章鹏</span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:26.05pt;
margin-bottom:8.85pt;margin-left:0cm;text-align:center'><span lang=EN-US
style='font-size:12.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:21.5pt;
margin-bottom:8.85pt;margin-left:0cm;text-align:right'><span style='font-size:
12.0pt;mso-bidi-font-size:11.0pt;line-height:107%'>整理</span><span
style='font-size:12.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-ascii-font-family:Calibri;mso-hansi-font-family:Calibri'>：小</span>邹<span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
mso-fareast-font-family:宋体'>[yw_forgit@163.com]</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:102.15pt;margin-bottom:
23.95pt;margin-left:177.15pt;text-indent:-39.25pt;line-height:144%'><span
lang=EN-US style='font-size:12.0pt;mso-bidi-font-size:11.0pt;line-height:144%;
font-family:"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑'><span
style='mso-spacerun:yes'> </span></span></p>

<h1 style='margin-left:-.25pt'><span lang=EN-US>1.</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
lang=EN-US>Spark </span><span style='font-family:宋体;mso-bidi-font-family:宋体;
font-weight:normal'>内核概述</span> </h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
21.15pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>内核泛指 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的核心运行机制，包括 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>核心组件的运行机制、</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>任务调度机制、</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>内存管理机制、</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>核心功能的运行原理等，熟练掌握
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>内核原理，能够帮助我们更好地完成
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>代码设计，并能够帮助我们准确锁定项目运行过程中出现的问题的症结所在。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:23.25pt;margin-left:
-.25pt'><span lang=EN-US>1.1 Spark </span><span style='font-family:黑体;
mso-bidi-font-family:黑体;font-weight:normal'>核心组件回顾</span> </h2>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:16.3pt;margin-left:
-.25pt'><span lang=EN-US>1.1.1 Driver </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>驱动器节点，用于执行 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>任务中的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>main
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>方法，负责实际代码的执行工作。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>作业执行时主要负责：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.35pt;margin-left:41.05pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:126%;mso-list:l12 level1 lfo1'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>将用户查询转化为任务；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.25pt;margin-left:41.05pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:125%;mso-list:l12 level1 lfo1'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>在 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>之间调度任务；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.25pt;margin-left:41.05pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:125%;mso-list:l12 level1 lfo1'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>跟踪 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的执行情况（</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>Driver</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>会监控<span
lang=EN-US>Executor</span>的运行情况，运行失败会尝试重新分发<span lang=EN-US>Task</span>给其他<span
lang=EN-US>Executor</span></span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>）；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
21.8pt;margin-left:41.05pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:126%;mso-list:l12 level1 lfo1'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>通过 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>UI </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>展示查询运行情况；</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:16.35pt;margin-left:
-.25pt'><span lang=EN-US>1.1.2 Executor </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.5pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>节点是一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>JVM
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进程</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，负责在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>作业中运行具体任务，任务彼此之间相互独立。</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>应用启动时，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>节点被同时启动，并且始终伴随着整个</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>应用的生命周期而存在。如果有 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>节点发生了故障或崩溃，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>应用也可以继续执行，会将出错节点上的任务调度到其他
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>节点上继续运行。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>有两个核心功能：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.35pt;margin-bottom:
.35pt;margin-left:23.05pt;text-indent:0cm;line-height:126%;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>负责运行组成 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>应用的任务（执行<span lang=EN-US>Task</span>），并将结果返回给驱动器进程；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.35pt;margin-bottom:
21.4pt;margin-left:23.05pt;text-indent:0cm;line-height:125%;mso-list:l0 level1 lfo2'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>它们通过自身的块管理器（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Block
Manager</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>）为用户程序中要求缓存的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>提供内存式存储。</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>是直接缓存在 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程内的，因此任务可以在运行时充分利用缓存数据加速运算。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:11.0pt;margin-left:
-.25pt'><span lang=EN-US style='font-family:"Arial","sans-serif";mso-fareast-font-family:
Arial'>1.2 Spark </span><span style='font-family:黑体;mso-bidi-font-family:黑体;
font-weight:normal'>通用运行流程概述</span><span style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:43.1pt;margin-bottom:
11.0pt;margin-left:156.3pt;text-indent:-130.6pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shapetype id="_x0000_t75" coordsize="21600,21600"
 o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f"
 stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="Picture_x0020_233" o:spid="_x0000_i1073" type="#_x0000_t75"
 style='width:363.6pt;height:271.2pt;visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image001.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-1 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>核心运行流程</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.05pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>图 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1-1
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>通用运行流程，不论 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>以何种模式进行部署，任务提交后，都会先启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进程，随后 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进程向集群管理器注册应用程序，之后集群管理器根据此任务的配置文件分配 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>并启动，当 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>所需的资源全部满足后，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
30.7pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Driver </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>开始执行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>main
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>函数，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>查询为懒执行，当执行到 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>action </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>算子时开始反向推算，根据宽依赖进行 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的划分，随后每一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>对应一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>taskset</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>taskset </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中有多个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，根据本地化原则，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>会被分发到指定的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>去执行，在任务执行的过程中，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>也会不断与 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进行通信，报告任务运行情况。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h1 style='margin-left:-.25pt'><span lang=EN-US>2.</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
lang=EN-US>Spark </span><span style='font-family:宋体;mso-bidi-font-family:宋体;
font-weight:normal'>部署模式</span> </h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>支持 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>3 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>种集群管理器（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Cluster
Manager</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>），分别为：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l9 level1 lfo3'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Standalone</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：独立模式，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>原生的简单集群管理器，自带完整的服务，可单独部署到一个集群中，无需依赖任何其他资源管理系统，使用 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Standalone
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>可以很方便地搭建一个集群；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.75pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;mso-list:l9 level1 lfo3'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Apache
Mesos</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>：一个强大的分布式资源管理框架，它允许多种不同的框架部署在其上，包括
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>yarn</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:125%;mso-list:l9 level1 lfo3'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Hadoop
YARN</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>：统一的资源管理机制，在上面可以运行多套计算框架，如 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map
reduce</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>、</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>storm
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>等，根据 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>在集群中的位置不同，分为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>yarn
client </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>yarn
cluster</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>实际上，除了上述这些通用的集群管理器外，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>内部也提供了一些方便用户测试和学习的简单集群部署模式。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>由于在实际工厂环境下使用的绝大多数的集群管理器是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Hadoop YARN</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，因此我们关注的重点是
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Hadoop YARN </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>模式下的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Spark </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>集群部署</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
5.5pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的运行模式取决于传递给 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>SparkContext </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>MASTER </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>环境变量的值，个别模式还需要辅助的程序接口来配合使用，目前支持的
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Master </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>字符串及 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>URL
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>包括：</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:0cm;margin-left:.5pt;margin-bottom:.0001pt;text-align:center;
text-indent:-.5pt'><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:黑体;mso-bidi-font-family:黑体'>表 </span><span
lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'>2-1 Spark</span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
黑体;mso-bidi-font-family:黑体'>运行模式配置</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=732
 style='width:439.05pt;margin-left:-5.3pt;border-collapse:collapse;mso-yfti-tbllook:
 1184;mso-padding-alt:8.2pt 2.65pt 2.95pt 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:23.9pt'>
  <td width=232 valign=bottom style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-bottom:solid #70AD47 2.25pt;padding:8.2pt 2.65pt 2.95pt 5.4pt;
  height:23.9pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.5pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>Master URL </span></p>
  </td>
  <td width=500 valign=bottom style='width:299.8pt;border-top:solid #70AD47 1.0pt;
  border-left:none;border-bottom:solid #70AD47 2.25pt;border-right:solid #70AD47 1.0pt;
  mso-border-left-alt:solid #70AD47 1.0pt;padding:8.2pt 2.65pt 2.95pt 5.4pt;
  height:23.9pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:0cm;
  margin-bottom:0cm;margin-left:19.75pt;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>Meaning </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:23.25pt'>
  <td width=232 valign=bottom style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 2.25pt;background:#DBEBD0;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:23.25pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.55pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>local </span></p>
  </td>
  <td width=500 valign=top style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 2.25pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:8.2pt 2.65pt 2.95pt 5.4pt;height:23.25pt'>
  <p class=MsoNormal align=right style='margin-top:0cm;margin-right:5.2pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>在本地运行，只有一个工作进程，无并行计算能力。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:43.2pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:8.2pt 2.65pt 2.95pt 5.4pt;
  height:43.2pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.6pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>local[K] </span></p>
  </td>
  <td width=500 valign=top style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:43.2pt'>
  <p class=MsoNormal align=right style='margin-top:0cm;margin-right:3.5pt;
  margin-bottom:6.45pt;margin-left:0cm;text-align:right'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>在本地运行，有 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>K
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>个工作进程，通常设置 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>K
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>为机器的</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>CPU
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>核心数量。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:42.75pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:42.75pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.6pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>local[*] </span></p>
  </td>
  <td width=500 valign=top style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:8.2pt 2.65pt 2.95pt 5.4pt;height:42.75pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-align:
  justify;text-justify:inter-ideograph;text-indent:23.05pt'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>在本地运行，工作进程数量等于机器的 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>CPU
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>核心数量。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:63.3pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:8.2pt 2.65pt 2.95pt 5.4pt;
  height:63.3pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.55pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>spark://HOST:PORT </span></p>
  </td>
  <td width=500 valign=bottom style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:63.3pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:6.1pt;
  margin-left:23.05pt'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>以 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Standalone
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>模式运行，这是 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>自身提供的集群</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>运行模式，默认端口号</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:
  7077</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>。详细文档见</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:Spark
  standalone cluster</span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:62.7pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:62.7pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.45pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>mesos://HOST:PORT </span></p>
  </td>
  <td width=500 valign=bottom style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:8.2pt 2.65pt 2.95pt 5.4pt;height:62.7pt'>
  <p class=MsoNormal align=right style='margin-top:0cm;margin-right:3.5pt;
  margin-bottom:6.1pt;margin-left:0cm;text-align:right'><span style='font-size:
  10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
  宋体'>在 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'>Mesos </span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>集群上运行，</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>进程和 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Worker
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>进程运行</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Mesos
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>集群上，部署模式必须使用固定值</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:--deploy-mode
  cluster</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>。详细文档见</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:MesosClusterDispatcher.
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:83.3pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:8.2pt 2.65pt 2.95pt 5.4pt;
  height:83.3pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.55pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>yarn-client </span></p>
  </td>
  <td width=500 valign=bottom style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:83.3pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:6.15pt;
  margin-left:23.05pt'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>集群上运行，</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>进程在本地，</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Work
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>进程</span></p>
  <p class=MsoNormal style='margin-bottom:.1pt;text-align:justify;text-justify:
  inter-ideograph;line-height:152%'><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:152%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  152%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  152%;font-family:宋体;mso-bidi-font-family:宋体'>集群上，部署模式必须使用固定值</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  152%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:--deploy-mode
  client</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:152%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  152%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  152%;font-family:宋体;mso-bidi-font-family:宋体'>集群地址必须在</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HADOOP_CONF_DIRorYARN_CONF_DIR
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>变量里定义。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;mso-yfti-lastrow:yes;height:82.8pt'>
  <td width=232 valign=top style='width:139.2pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:8.2pt 2.65pt 2.95pt 5.4pt;height:82.8pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:3.55pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>yarn-cluster </span></p>
  </td>
  <td width=500 valign=bottom style='width:299.8pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:8.2pt 2.65pt 2.95pt 5.4pt;height:82.8pt'>
  <p class=MsoNormal align=right style='margin-top:0cm;margin-right:3.05pt;
  margin-bottom:6.15pt;margin-left:0cm;text-align:right'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>集群上运行，</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>进程在 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>集群上，</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Work</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-align:
  justify;text-justify:inter-ideograph;line-height:154%'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:154%;
  font-family:宋体;mso-bidi-font-family:宋体'>进程也在 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:154%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  154%;font-family:宋体;mso-bidi-font-family:宋体'>集群上，部署模式必须使用固定值</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  154%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>:--deploy-mode
  cluster</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:154%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  154%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Yarn
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  154%;font-family:宋体;mso-bidi-font-family:宋体'>集群地址必须在</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HADOOP_CONF_DIRorYARN_CONF_DIR
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>变量里定义。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:24.05pt;
margin-bottom:2.75pt;margin-left:.5pt;text-align:right;text-indent:-.5pt'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>用户在提交任务给 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>处理时，以下两个参数共同决定了 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>的运行方式。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>·</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>–</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>master
MASTER_URL </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>：决定了 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>任务提交给哪种集群处理。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
21.2pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>·</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>–</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>deploy-mode
DEPLOY_MODE</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>：决定了 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的运行方式，可选值为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Client
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>或者 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Cluster</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>2.1 Standalone </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>模式运行机制</span>
</h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Standalone </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>集群有四个重要组成部分，分别是：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
3.45pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l6 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：是一个进程，我们编写的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>应用程序就运行在 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>上，由 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进程执行；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l6 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Master</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：是一个进程，主要负责资源的调度和分配，并进行集群的监控等职责；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:125%;mso-list:l6 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Worker</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>：是一个进程，一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>运行在集群中的一台服务器上，主要负责两个职责，一个是用自己的内存存储 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的某个或某些 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>；另一个是启动其他进程和线程（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>），对 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>上的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>partition </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>进行并行的处理和计算。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
21.15pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:125%;mso-list:l6 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>：是一个进程，一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上可以运行多个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>通过启动多个线程（</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>）来执行对 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>进行并行计算，也就是执行我们对 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>定义的例如 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>flatMap</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduce </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>等算子操作。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:10.35pt;margin-left:
-.25pt'><span lang=EN-US>2.1.1</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>Standalone Client </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>模式</span> </h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:17.5pt;margin-bottom:
11.0pt;margin-left:152.05pt;text-indent:-152.7pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_819" o:spid="_x0000_i1072"
 type="#_x0000_t75" style='width:415.2pt;height:213.6pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image002.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>2-1 Standalone Client </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>模式</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
23.75pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Standalone
Client </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>模式下，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>在任务提交的本地机器上运行，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>启动后向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>注册应用程序，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>根据 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>submit </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>脚本的资源需求找到内部资源至少可以启动一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的所有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，然后在这些 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Worker </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>之间分配 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动后会向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>反向注册，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>所有的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Executor </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>注册完成后，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Driver </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>开始执行 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>main </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>函数</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，之后执行到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>算子时，开始划分 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>生成对应的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>taskSet</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，之后将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>分发到各个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:16.4pt;margin-left:
-.25pt'><span lang=EN-US>2.1.2</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>Standalone Cluster </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>模式</span> </h3>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:25.9pt;
margin-bottom:3.3pt;margin-left:0cm;text-align:right'><span lang=EN-US
style='mso-no-proof:yes'><v:shape id="Picture_x0020_924" o:spid="_x0000_i1071"
 type="#_x0000_t75" style='width:415.8pt;height:190.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image003.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.8pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>2-2 Standalone Cluster </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>模式</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Standalone
Cluster </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>模式下，任务提交后，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Master
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会找到一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Worker </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动后向 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>注册应用程序，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>根据 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>submit </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>脚本的资源需求找到内部资源至少可以启动一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的所有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，然后在这些 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Worker </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>之间分配 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Worker </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动后会向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>反向注册，所有的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>注册完成后，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>开始执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>main </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>函数，之后执行到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Action </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>算子时，开始划分 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>生成对应的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>taskSet</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，之后将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>分发到各个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal><span style='font-family:"微软雅黑","sans-serif";mso-bidi-font-family:
微软雅黑;color:red'>注意，</span><span lang=EN-US style='color:red'>Standalone </span><span
style='font-family:"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑;color:red'>的两种模式下（</span><span
lang=EN-US style='color:red'>client/Cluster</span><span style='font-family:
"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑;color:red'>），</span><span
lang=EN-US style='color:red'>Master </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>在接到</span><span lang=EN-US
style='color:red'> Driver </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>注册</span><span lang=EN-US
style='color:red'>Spark </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>应用程序的请求后，会获取其所管理的剩余资源能够启动一个</span><span
lang=EN-US style='color:red'> Executor </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>的所有</span><span lang=EN-US
style='color:red'> Worker</span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>，然后在这些</span><span lang=EN-US
style='color:red'> Worker </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>之间分发</span><span lang=EN-US
style='color:red'> Executor</span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>，此时的分发只考虑</span><span lang=EN-US
style='color:red'> Worker </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>上的资源是否足够使用，直到当前应用程序所需的所有</span><span
lang=EN-US style='color:red'> Executor </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>都分配完毕，</span><span lang=EN-US
style='color:red'>Executor </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>反向注册完毕后，</span><span lang=EN-US
style='color:red'>Driver </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>开始执行</span><span lang=EN-US
style='color:red'> main </span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;color:red'>程序。</span> </p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:23.3pt;margin-left:
-.25pt'><span lang=EN-US>2.2 YARN </span><span style='font-family:黑体;
mso-bidi-font-family:黑体;font-weight:normal'>模式运行机制</span> </h2>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:10.4pt;margin-left:
-.25pt'><span lang=EN-US>2.2.1</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>YARN Client </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>模式</span> </h3>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:15.35pt;
margin-bottom:10.85pt;margin-left:.5pt;text-align:right;text-indent:-.5pt;
line-height:103%'><span lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1091"
 o:spid="_x0000_i1070" type="#_x0000_t75" style='width:426pt;height:253.2pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image004.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>2-3 YARN Client </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>模式</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'> </span></span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>在 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>YARN Client </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>模式下，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>在任务提交的本地机器上运行，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>启动后会和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>通讯申请启动 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>（用到<span lang=EN-US>Yarn</span>都要提供这个），随后 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>分配 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，在合适的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>NodeManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，此时的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的功能相当于一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ExecutorLaucher</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，只负责向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>申请 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>内存。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>接到 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的资源申请后会分配 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>container</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，然后 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>在资源分配指定的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>NodeManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程启动后会向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>反向注册，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>全部注册完成后 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>开始执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>main </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>函数，之后执行到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Action </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>算子时，触发一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>job</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，并根据宽依赖开始划分 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>生成对应的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>taskSet</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，之后将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>分发到各个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>测试环境一般用这个，本地电脑起<span
lang=EN-US>Driver</span>，连接测试集群。由于测试机房有很多个<span lang=EN-US>Executor</span>都跟本地电脑<span
lang=EN-US>Driver</span>频繁通信，可能会导致网络不好，而且要考虑测试机房能与本地电脑通信。</span></p>

<h3 style='margin-left:-.25pt'><span lang=EN-US>2.2.2</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
lang=EN-US>YARN Cluster </span><span style='font-family:宋体;mso-bidi-font-family:
宋体;font-weight:normal'>模式</span> </h3>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:26.4pt;
margin-bottom:1.85pt;margin-left:0cm;text-align:right'><span lang=EN-US
style='mso-no-proof:yes'><v:shape id="Picture_x0020_1229" o:spid="_x0000_i1069"
 type="#_x0000_t75" style='width:415.2pt;height:178.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image005.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.9pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>2-4 YARN Cluster </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>模式</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='text-indent:21.0pt;mso-char-indent-count:2.0'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>在<span lang=EN-US> YARN Cluster </span>模式下，任务提交后会和<span
lang=EN-US> ResourceManager </span>通讯申请启动<span lang=EN-US>ApplicationMaster</span>，随后<span
lang=EN-US> ResourceManager </span>分配<span lang=EN-US> container</span>，在合适的<span
lang=EN-US> NodeManager </span>上启动<span lang=EN-US> ApplicationMaster</span>，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>此时的<span lang=EN-US> ApplicationMaster </span>就是<span
lang=EN-US> Driver</span></span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>。 <span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动后向 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>申请 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>内存，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>接到 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的资源申请后会分配 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>container</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，然后在合适的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>NodeManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程启动后会向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>反向注册，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>全部注册完成后 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>开始执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>main </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>函数，之后执行到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Action </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>算子时，触发一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>job</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，并根据宽依赖开始划分 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>生成对应的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>taskSet</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，之后将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>分发到各个</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
31.15pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
31.15pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>一般都是问这种模式。</span></p>

<h1 style='margin-top:0cm;margin-right:0cm;margin-bottom:19.3pt;margin-left:
-.25pt'><span lang=EN-US>3.</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>Spark </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>通讯架构</span> </h1>

<h2 style='margin-left:-.25pt'><span lang=EN-US>3.1 Spark </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>通信架构概述</span>
</h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark2.x </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>版本使用 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Netty </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>通讯框架作为内部通讯组件。</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>基于 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>netty
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>新的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>rpc </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>框架借鉴了 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Akka </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的中的设计，它是基于 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Actor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>模型，如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:94.7pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1376" o:spid="_x0000_i1068"
 type="#_x0000_t75" style='width:278.4pt;height:184.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image006.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-1 Actor </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>模型</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><span style='mso-spacerun:yes'> </span><span
style='mso-spacerun:yes'>        </span></span><span style='font-family:等线;
mso-ascii-font-family:Calibri;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri'>每个</span><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'>Actor</span><span style='font-family:
等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:Calibri'>接收数据都是从接收箱（</span><span lang=EN-US
style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'>MailBox</span><span
style='font-family:等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri'>）接收，发送数据给其他的</span><span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'>Actor</span><span
style='font-family:等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri'>都是发送给它的接收箱。</span><span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.6pt;margin-left:.5pt;text-align:justify;text-justify:inter-ideograph;
text-indent:21.0pt;mso-char-indent-count:2.0'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通讯框架中各个组件（</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Client/Master/Worker</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>）可以认为是一个个独立的实体，各个实体之间通过消息来进行通信。具体各个组件之间的关系图如下：</span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:95.55pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1395" o:spid="_x0000_i1067"
 type="#_x0000_t75" style='width:276.6pt;height:198.6pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image007.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-2 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通讯架构</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
21.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Endpoint</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>（</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Client/Master/Worker</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>1 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>InBox
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>N
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>OutBox</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>N&gt;=1</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>N </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>取决于当前 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Endpoint </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>与多少其他的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Endpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>进行通信，一个与其通讯的其他 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Endpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对应一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>OutBox</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>），</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Endpoint </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>接收到的消息被写入 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>InBox</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，发送出去的消息写入 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>OutBox </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>并被发送到其他 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Endpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>InBox </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>中。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:242.5pt;margin-bottom:
.35pt;margin-left:22.3pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-23.05pt;line-height:275%'><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:16.0pt;mso-bidi-font-size:11.0pt;line-height:275%;
font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'>3.2 Spark </span></b><span
style='font-size:16.0pt;mso-bidi-font-size:11.0pt;line-height:275%;font-family:
黑体;mso-bidi-font-family:黑体'>通讯架构解析</span><b style='mso-bidi-font-weight:normal'><span
style='font-size:16.0pt;mso-bidi-font-size:11.0pt;line-height:275%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'> <span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:242.5pt;margin-bottom:
.35pt;margin-left:22.3pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-23.05pt;line-height:275%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:275%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:275%;font-family:宋体;mso-bidi-font-family:
宋体'>通信架构如下图所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:275%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:36.6pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1490" o:spid="_x0000_i1066"
 type="#_x0000_t75" style='width:394.8pt;height:235.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image008.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图</span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 4-3 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通讯架构</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
3.55pt;margin-left:22.55pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-family:等线;mso-ascii-font-family:Calibri;
mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri'>分析：注意粉色线是一个</span><span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'>RPCEndpoint</span><span
style='font-family:等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri'>，红色线表示另一个</span><span lang=EN-US
style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'>RPCEndpoint</span><span
style='font-family:等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri'>。</span><span lang=EN-US
style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_1"
 o:spid="_x0000_i1065" type="#_x0000_t75" style='width:444pt;height:241.8pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image009.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
3.55pt;margin-left:22.55pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
3.55pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:126%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RPC </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>端点，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>针对每个节点（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Client/Master/Worker</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>）都称之为一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Rpc </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>端点，且都实现 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RpcEndpoint </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>接口，内部根据不同端点的需求，设计不同的消息和不同的业务处理，如果需要发送（询问）则调用
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Dispatcher</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
2.75pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEnv</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RPC </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>上下文环境，每个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RPC </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>端点运行时依赖的上下文环境称为</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RpcEnv</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>；</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:125%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Dispatcher</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>：消息分发器，针对于 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RPC </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端点需要发送消息或者从远程 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RPC </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>接收到的消息，分发至对应的指令收件箱</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>/</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>发件箱。如果指令接收方是自己则存入收件箱，如果指令接收方不是自己，则放入发件箱；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:125%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Inbox</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>：指令消息收件箱，一个本地 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对应一个收件箱，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Dispatcher
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>在每次向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Inbox </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>存入消息时，都将对应 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>EndpointData
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>加入内部 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ReceiverQueue
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>中，另外 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Dispatcher
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>创建时会启动一个单独线程进行轮询 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ReceiverQueue</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，进行收件箱消息消费；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:123%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>5)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpointRef</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RpcEndpointRef </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>是对远程 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RpcEndpoint </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>的一个引用。当我们需要向一个具体的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>发送消息时，一般我们需要获取到该 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>的引用，然后通过该应用发送消息。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:126%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>6)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>OutBox
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>：指令消息发件箱，对于当前 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>来说，一个目标 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>对应一个发件箱，如果向多个目标 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>发送信息，则有多个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>OutBox</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。当消息放入 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Outbox </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>后，紧接着通过 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TransportClient </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>将消息发送出去。消息放入发件箱以及发送过程是在同一个线程中进行；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:125%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>7)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RpcAddress</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>：表示远程的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RpcEndpointRef </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的地址，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Host + Port</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:123%;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>8)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TransportClient</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Netty </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:
宋体'>通信客户端，一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>OutBox </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体'>对应一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TransportClient</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>， </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TransportClient </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>不断轮询 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>OutBox</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:
宋体'>，根据 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>OutBox </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体'>消息的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>receiver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>信息，请求对应的远程 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TransportServer</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>；</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
5.85pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;mso-list:l2 level1 lfo5'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>9)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TransportServer
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>： </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Netty </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通信服务端，一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RpcEndpoint </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>对应一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TransportServer</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，接受远程消息后调用 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Dispatcher
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>分发消息至对应收发件箱；</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
5.85pt;margin-left:22.55pt;text-align:justify;text-justify:inter-ideograph'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>根据上面的分析，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>通信架构的高层视图如下图所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:94.6pt;margin-bottom:
35.5pt;margin-left:147.3pt;text-indent:-70.0pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1681" o:spid="_x0000_i1064"
 type="#_x0000_t75" style='width:261pt;height:229.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image010.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-4 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>通信框架高层视图</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h1 style='margin-left:-.25pt'><span lang=EN-US>4.</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
lang=EN-US>Spark </span><span style='font-family:宋体;mso-bidi-font-family:宋体;
font-weight:normal'>任务调度机制</span> </h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
21.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在工厂环境下，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>集群的部署方式一般为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>YARN-Cluster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>模式，之后的内核分析内容中我们默认集群的部署方式为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>YARN-Cluster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>模式。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>4.1 Spark </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>任务提交流程</span>
</h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在上一章中我们讲解了 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
YARN-Cluster </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>模式（后面讲的都是这种模式下）下的任务提交流程，如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:26.4pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1761" o:spid="_x0000_i1063"
 type="#_x0000_t75" style='width:415.2pt;height:178.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image005.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-1 YARN-Cluster </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>任务提交流程</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:21.55pt;
margin-bottom:6.35pt;margin-left:0cm;text-align:center'><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>下面的时序图清晰地说明了一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>应用程序从提交到运行的完整流程：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:55.1pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_1778" o:spid="_x0000_i1062"
 type="#_x0000_t75" style='width:358.2pt;height:290.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image011.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.8pt;
margin-bottom:10.8pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-2 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>任务提交时序图</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>提交一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>应用程序，首先通过 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Client </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>向 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>请求启动一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Application</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，同时检查是否有足够的资源满足 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Application
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的需求，如果资源条件满足，则准备 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的启动上下文，交给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，并循环监控</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Application </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>状态。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>当提交的资源队列中有资源时，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会在某个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>NodeManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会单独启动 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>后台线程，当 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>启动后，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>会通过本地的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RPC </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>连接 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Driver</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，并开始向 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>申请 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>资源运行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程（一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>对应与一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Container</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>），当 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResourceManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>返回 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>资源，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>则在对应的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>线程主要是初始化 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SparkContext </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>对象，准备运行所需的上下文，然后一方面保持与 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RPC </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>连接，通过 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>申请资源，另一方面根据用户业务逻辑开始调度任务，将任务下发到已有的空闲 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>上。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
21.05pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>当 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ResourceManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>返回 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>资源时， </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>就尝试在对应的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Container </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程起来后，会向 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>反向注册，注册成功后保持与 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的心跳，同时等待 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>分发任务，当分发的任务执行完毕后，将任务状态上报给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。从上述时序图可知，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Client </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>只负责提交 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Application </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>并监控 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Application </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的状态。对于 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的任务调度主要是集中在两个方面</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>: </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>资源申请和任务分发</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，其主要是通过 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>以及 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>之间来完成。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>4.2 Spark </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>任务调度概述</span>
</h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>当 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>起来后，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>则会根据用户程序逻辑准备任务，并根据 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>资源情况逐步分发任务。在详细阐述任务调度前，首先说明下 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>里的几个概念。</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>应用程序包括 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>以及 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>三个概念：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:126%;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>是以 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>方法为界，遇到一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Action </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>方法则触发一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Job</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>；</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:125%;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的子集，以 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>宽依赖</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>(</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>即 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle)</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>为界，遇到 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>做一次划分；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:126%;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的子集，以并行度</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>(</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>分区数</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>)</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>来衡量，分区数是多少，则有多少个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。（</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>从<span lang=EN-US>HDFS</span>读取文件，一个<span
lang=EN-US>HDFS</span>文件能够切分多少分片<span lang=EN-US>(split)</span>，初始化<span
lang=EN-US>RDD</span>就有多少个分区，然后每一个<span lang=EN-US>task</span>处理一个<span
lang=EN-US>partition</span>的数据<span lang=EN-US>(</span></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;color:red;
background:yellow;mso-highlight:yellow'>一个<span lang=EN-US>task</span>对应一个<span
lang=EN-US>RDD</span>的一个分区</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>)</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_3"
 o:spid="_x0000_i1061" type="#_x0000_t75" style='width:444pt;height:254.4pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image012.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的任务调度总体来说分两路进行，一路是 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>级的调度，一路是 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>级的调度，总体调度流程如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:49.9pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2050" o:spid="_x0000_i1060"
 type="#_x0000_t75" style='width:368.4pt;height:285pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image013.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-3 Spark </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>任务调度概览</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>通过其 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Transactions </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>操作，形成了 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>血缘关系图，即 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>DAG</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，最后通过 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的调用，触发 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>并调度执行。</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>DAGScheduler </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>负责 </span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Stage </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>级的调度</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，主要是将 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>DAG </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>切分成若干 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stages</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，并将每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>打包成 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSet </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>交给 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>调度。</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>TaskScheduler </span></b><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>负责 </span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Task </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>级的调度</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，将 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAGScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>给过来的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSet </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>按照指定的调度策略分发到 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行，调度过程中 </span><b><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>SchedulerBackend
</span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>负责提供可用资源</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，其中 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red;mso-bidi-font-weight:bold'>SchedulerBackend
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>有多种实现，分别对接不同的资源管理系统</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。有了上述感性的认识后，下面这张图描述了 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark-On-Yarn
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>模式下在任务调度期间，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ApplicationMaster</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>以及 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>内部模块的交互过程：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.15pt;margin-bottom:
11.0pt;margin-left:149.2pt;text-indent:-140.45pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2153" o:spid="_x0000_i1059"
 type="#_x0000_t75" style='width:397.8pt;height:224.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image014.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.15pt;margin-bottom:
11.0pt;margin-left:149.2pt;text-indent:-2.2pt;line-height:103%'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-4 YARN-Cluster </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>任务调度</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.25pt;
margin-bottom:2.6pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>初始化 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SparkContext
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>过程中，会分别初始化 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>DAGScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>以及 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>HeartbeatReceiver</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，并启动 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>以及 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>HeartbeatReceiver</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通过 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ApplicationMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>申请资源，并不断从 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>中拿到合适的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>分发到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>执行。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HeartbeatReceiver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>负责接收 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的心跳信息，监控 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的存活状况，并通知到 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-family:等线;mso-ascii-font-family:Calibri;
mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri'>分析：</span><span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_4"
 o:spid="_x0000_i1058" type="#_x0000_t75" style='width:444.6pt;height:247.2pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image015.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>4.3 Spark Stage </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>级调度</span> </h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.4pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的任务调度是从 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>DAG </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>切割开始，主要是由 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>DAGScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>来完成。当遇到一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>操作后就会触发一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Job </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的计算，并交给 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>DAGScheduler </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>来提交，下图是涉及到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Job </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>提交的相关方法调用流程图。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:26.4pt;
margin-bottom:6.4pt;margin-left:0cm;text-align:right'><span lang=EN-US
style='mso-no-proof:yes'><v:shape id="Picture_x0020_2230" o:spid="_x0000_i1057"
 type="#_x0000_t75" style='width:415.2pt;height:125.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image016.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-5 Job </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>提交调用栈</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.5pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Job </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>由最终的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>方法封装而成， </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SparkContext
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>将 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>交给 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAGScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>提交，它会根据 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的血缘关系构成的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>DAG </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>进行切分，将一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>划分为若干 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stages</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，具体划分策略是，由最终的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>不断通过依赖回溯判断父依赖是否是宽依赖，即以 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>为界，划分 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>，窄依赖的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>之间被划分到同一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>中，可以进行 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>pipeline </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>式的计算，如上图紫色流程部分。划分的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stages </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>分两类，一类叫做 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResultStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAG </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>最下游的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Stage</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，由 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>方法决定，另一类叫做 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ShuffleMapStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，为下游 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>准备数据，下面看一个简单的例子 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>WordCount</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:54.85pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2324" o:spid="_x0000_i1056"
 type="#_x0000_t75" style='width:358.2pt;height:131.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image017.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.9pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-6 WordCount </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>实例</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>分析：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_5"
 o:spid="_x0000_i1055" type="#_x0000_t75" style='width:444pt;height:174pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image018.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.6pt;margin-left:.5pt;text-indent:21.0pt;mso-char-indent-count:2.0'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>由 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>saveAsTextFile
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>触发，该 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>由 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD-3 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>和 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>saveAsTextFile </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>方法组成，根据</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>之间的依赖关系从 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-3
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>开始回溯搜索，直到没有依赖的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-0</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，在回溯搜索过程中，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD-3 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>依赖 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD-2</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>，并且是宽依赖，所以在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-2
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-3 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>之间划分</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD-3 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>被划到最后一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，即 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>ResultStage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>中，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD-2 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>依赖 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD-1</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-1
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>依赖 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-0</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，这些依赖都是窄依赖，所以将 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-0</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD-1 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>和 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>RDD-2 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>划分到同一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，即 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>ShuffleMapStage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>中，实际执行的时候，数据记录会一气呵成地执行 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD-0 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>到 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD-2 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>的转化。不难看出，其本质上是一个深度优先搜索算法。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Stage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>是否被提交，需要判断它的父
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Stage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>是否执行，只有在父 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>执行完毕才能提交当前 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Stage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，如果一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>没有父 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Stage</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，那么从该 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Stage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>开始提交</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>提交时会将 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>信息（分区信息以及方法等）序列化并被打包成
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSet </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>交给</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Partition </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>对应一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>，另一方面 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskScheduler </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>会监控 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Stage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>的运行状态，只有 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>丢失或者 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>由于 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Fetch </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>失败才需要重新提交失败的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Stage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>以调度运行失败的任务，其他类型的
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>失败会在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>的调度过程中重试。</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
2.75pt;margin-left:.5pt;text-indent:21.0pt;mso-char-indent-count:2.0'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>相对来说 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAGScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>做的事情较为简单，仅仅是在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>层面上划分 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAG</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>，提交 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Stage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>并监控相关状态信息。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>则相对较为复杂，下面详细阐述其细节。</span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>4.4 Spark Task </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>级调度</span> </h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark Task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的调度是由 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>来完成，由前文可知，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAGScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>将 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>打包到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSet </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>交给 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>会将 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSet </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>封装为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>加入到调度队列中，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>结构如下图所示。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:26.45pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2552" o:spid="_x0000_i1054"
 type="#_x0000_t75" style='width:136.8pt;height:73.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image019.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-7 TaskManager </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>结构</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.45pt;margin-bottom:
.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>负责监控管理同一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Tasks</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>TaskScheduler </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>就是以 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>TaskSetManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>为单元来调度任务</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。前面也提到，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>初始化后会启动 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>SchedulerBackend</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，它负责跟外界打交道，接收 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的注册信息，并维护 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的状态</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，所以说 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>是管</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>“</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>粮食</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>”</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的，同时它在启动后会定期地去</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>“</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>询问</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>”TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>有没有任务要运行，也就是说，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>它会定期地 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>“ </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>问 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>”TaskScheduler“ </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>我有这么余量，你要不要啊
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>” </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.45pt;margin-bottom:
3.65pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>SchedulerBackend“</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>问</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>”</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>它的时候，会从调度队列中按照指定的调度策略选择 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>TaskSetManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>去调度运行</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，大致方法调用流程如下图所示：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:41.3pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2618" o:spid="_x0000_i1053"
 type="#_x0000_t75" style='width:385.2pt;height:147pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image020.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-8 task </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>调度流程</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-family:宋体;mso-bidi-font-family:宋体'>分析：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_6"
 o:spid="_x0000_i1052" type="#_x0000_t75" style='width:444pt;height:194.4pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image021.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:29.25pt;
margin-bottom:2.6pt;margin-left:.5pt;text-align:right;text-indent:-.5pt'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>3-7 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>中，将 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSetManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>加入 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>rootPool </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>调度池中之后，调用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SchedulerBackend</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.35pt;margin-bottom:
20.95pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>riviveOffers
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>方法给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>driverEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>发送 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ReviveOffer
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>消息；</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>driverEndpoint
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>收到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>ReviveOffer </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>消息后调用
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>makeOffers </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>方法，过滤出活跃状态的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>（这些 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>都是任务启动时反向注册到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Driver </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Executor</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>），然后将
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Executor </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>封装成 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>WorkerOffer </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>对象</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>准备好计算资源（ </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>WorkerOffer
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>）后， </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>taskScheduler </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>基于这些资源调用
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>resourceOffer </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>在 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Executor </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>上分配 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<h3 style='margin-left:-.25pt'><span lang=EN-US>4.4.1</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>调度策略</span> </h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>前面讲到， </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会先把 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>DAGScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>给过来的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSet </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>封装成 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>扔到任务队列里，然后再从任务队列里按照一定的规则把它们取出来在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SchedulerBackend
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>给过来的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上运行。这个调度过程实际上还是比较粗粒度的，是面向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>是以树的方式来管理任务队列，树中的节点类型为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Schdulable</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，叶子节点为 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，非叶子节点为 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Pool</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>，下图是它们之间的继承关系。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:112.25pt;margin-bottom:
11.15pt;margin-left:157.85pt;text-indent:-70.6pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2757" o:spid="_x0000_i1051"
 type="#_x0000_t75" style='width:240.6pt;height:160.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image022.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-9 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:宋体;mso-bidi-font-family:
宋体'>任务队列继承关系</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>支持两种调度策略，一种是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>FIFO</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，也是默认的调度策略，另一种是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>FAIR</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。在 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>初始化过程中会实例化 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>rootPool</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，表示树的根节点，是</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
6.75pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Pool </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>类型。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h4 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'>1. FIFO </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体'>调度策略</span><span style='font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span></h4>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>如果是采用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>FIFO
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>调度策略，则直接简单地将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>按照先来先到的方式入队，出队时直接拿出最先进队的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，其树结构如下图所示，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
4.2pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>保存在一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>FIFO </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>队列中。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:71.05pt;margin-bottom:
11.15pt;margin-left:146.2pt;text-indent:-92.45pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_2800" o:spid="_x0000_i1050"
 type="#_x0000_t75" style='width:307.8pt;height:2in;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image023.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-10 FIFO </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>调度策略内存结构</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h4 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'>2. FAIR </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体'>调度策略</span><span style='font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span></h4>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>FAIR </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>调度策略的树结构如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:73.8pt;margin-bottom:.0001pt'><span lang=EN-US style='mso-no-proof:
yes'><v:shape id="Picture_x0020_2848" o:spid="_x0000_i1049" type="#_x0000_t75"
 style='width:267.6pt;height:268.8pt;visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image024.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:10.8pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>4-11 FAIR </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>调度策略内存结构</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'> </span>FAIR </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>模式中有一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>rootPool </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>和多个子</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Pool</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，各个子</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Pool </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>中存储着所有待分配的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSetMagager</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.75pt;margin-left:.5pt;text-indent:21.0pt;mso-char-indent-count:2.0'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>在 </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>FAIR </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>模式中，需要先对子 </span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Pool </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进行排序，再对子
</span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Pool
</span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>里面的</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>TaskSetMagager </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>进行排序，因为 </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Pool </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>和 </span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>TaskSetMagager
</span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>都继承了 </span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Schedulable </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>特质，因此使用相同的排序算法</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。排序过程的比较是基于 </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Fair-share </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>来比较的，每个要排序的对象包含三个属性：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> runningTasks</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>值（正在运行的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>数）、</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>minShare</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>值、</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>weight</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>值，比较时会综合考量</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>runningTasks</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>值，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>minShare </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>值以及 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>weight </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>值。注意，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>minShare</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>weight </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的值均在公平调度配置文件 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>fairscheduler.xml
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>中被指定，调度池在构建阶段会读取此文件的相关配置。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%;mso-list:l16 level1 lfo7'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>如果 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>A </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>对象的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>runningTasks </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>大于它的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>minShare</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>B
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对象的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>runningTasks
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>小于它的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>minShare</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>B </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>排在 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>A </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>前面；（</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>runningTasks </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>比 </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>minShare </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>小的先执行</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:124%;mso-list:l16 level1 lfo7'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>如果 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>A</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>、</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>B </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>对象的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>runningTasks
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>都小于它们的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>minShare</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么就比较 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>runningTasks </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>与 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>minShare </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>的比值（</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>minShare </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>使用率</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>），谁小谁排前面；（</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>minShare</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>使用率低的先执行</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%;mso-list:l16 level1 lfo7'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>如果 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>A</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>、</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>B </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>对象的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>runningTasks
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>都大于它们的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>minShare</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么就比较 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>runningTasks </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>与 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>weight </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的比值（</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>权重使用率</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>），谁小谁排前面。（</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>权重使用率低的先执行</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>）</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:124%;mso-list:l16 level1 lfo7'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>如果上述比较均相等，则比较名字。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>整体上来说就是通过 </span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>minShare </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>和 </span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>weight </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>这两个参数控制比较过程，可以做到让 </span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>minShare </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>使用率和权重使用率少（实际运行 </span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>task </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>比例较少）的先运行</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.6pt;margin-left:.5pt;text-indent:21.0pt;mso-char-indent-count:2.0'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>FAIR
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>模式排序完成后，所有的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>被放入一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ArrayBuffer
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>里，之后依次被取出并发送给 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>执行。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>从调度队列中拿到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>后，由于 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>封装了一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的所有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，并负责管理调度这些 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，那么接下来的工作就是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>按照一定的规则一个个取出 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>， </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>再交给</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SchedulerBackend
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>去发到 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3><span lang=EN-US>4.4.2</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span style='font-family:宋体'>本地化调度</span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
1.6pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:等线;mso-ascii-theme-font:
minor-fareast;mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:"Times New Roman"'>Task</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>分配给哪个<span lang=EN-US>Executor</span>。</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
1.6pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DAGScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>切割 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Job</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，划分 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Stage, </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>通过调用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>submitStage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>来提交一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>对应的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>tasks</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>submitStage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>会调用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>submitMissingTasks</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>submitMissingTasks </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>确定每个需要计算的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>preferredLocations</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>通过调用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>getPreferrdeLocations()</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>得到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>partition </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的优先位置，由于一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>partition </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>对应一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，此 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>partition
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的优先位置就是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的优先位置</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对于要提交到
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>TaskScheduler </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>TaskSet </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>中的每一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>，该 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>优先位置与其对应的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>partition </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>对应的优先位置一致</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:19.3pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:123%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>从调度队列中拿到 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>后，那么接下来的工作就是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskSetManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>按照一定的规则一个个取出 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>再交给 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>去发到 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>上执行。前面也提到，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskSetManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>封装了一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:
宋体'>的所有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体'>，并负责管理调度这些 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
6.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>根据每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的优先位置，确定 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Locality </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>级别，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Locality </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>一共有五种，优先级由高到低顺序：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:0cm;margin-left:.5pt;margin-bottom:.0001pt;text-align:center;
text-indent:-.5pt'><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:黑体;mso-bidi-font-family:黑体'>表 </span><span
lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'>4-1 Spark</span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
黑体;mso-bidi-font-family:黑体'>本地化等级</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=710
 style='width:425.95pt;margin-left:-5.3pt;border-collapse:collapse;mso-yfti-tbllook:
 1184;mso-padding-alt:7.3pt 5.8pt 0cm 5.35pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:24.55pt'>
  <td width=355 style='width:212.95pt;border:solid #70AD47 1.0pt;border-bottom:
  solid #70AD47 2.25pt;padding:7.3pt 5.8pt 0cm 5.35pt;height:24.55pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.85pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>名称 </span></p>
  </td>
  <td width=355 style='width:213.0pt;border-top:solid #70AD47 1.0pt;border-left:
  none;border-bottom:solid #DBEBD0 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-left-alt:solid #70AD47 1.0pt;mso-border-alt:solid #70AD47 1.0pt;
  mso-border-bottom-alt:solid #DBEBD0 .25pt;padding:7.3pt 5.8pt 0cm 5.35pt;
  height:24.55pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.7pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>解析 </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:40.45pt'>
  <td width=355 valign=top style='width:212.95pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 2.25pt;background:#DBEBD0;
  padding:7.3pt 5.8pt 0cm 5.35pt;height:40.45pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.2pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>PROCESS_LOCAL </span></p>
  </td>
  <td width=355 valign=top style='width:213.0pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #DBEBD0 .25pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:7.3pt 5.8pt 0cm 5.35pt;height:40.45pt'>
  <p class=MsoNormal style='margin-bottom:2.95pt;text-align:justify;text-justify:
  inter-ideograph'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>进程本地化， </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>和数据在同一个</span></p>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>中，性能最好。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:56.95pt'>
  <td width=355 valign=top style='width:212.95pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:7.3pt 5.8pt 0cm 5.35pt;
  height:56.95pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.4pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>NODE_LOCAL </span></p>
  </td>
  <td width=355 style='width:213.0pt;border-top:none;border-left:none;
  border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:7.3pt 5.8pt 0cm 5.35pt;height:56.95pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-align:
  justify;text-justify:inter-ideograph'><span style='font-size:10.5pt;
  mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
  宋体'>节点本地化，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>和数据在同一个节点中，但是
  </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>和数据不在同一个 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>中，数据需要在进程间进行传输。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:56.45pt'>
  <td width=355 valign=top style='width:212.95pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:7.3pt 5.8pt 0cm 5.35pt;height:56.45pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.3pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>RACK_LOCAL </span></p>
  </td>
  <td width=355 valign=top style='width:213.0pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:7.3pt 5.8pt 0cm 5.35pt;height:56.45pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>机架本地化，</span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>和数据在同一个机架的两个节点上，数据需要通过网络在节点之间进行传输。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:40.45pt'>
  <td width=355 valign=top style='width:212.95pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:7.3pt 5.8pt 0cm 5.35pt;
  height:40.45pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.2pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>NO_PREF </span></p>
  </td>
  <td width=355 style='width:213.0pt;border-top:none;border-left:none;
  border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:7.3pt 5.8pt 0cm 5.35pt;height:40.45pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>对于 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>来说，从哪里获取都一样，没有好坏之分。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;mso-yfti-lastrow:yes;height:39.95pt'>
  <td width=355 valign=top style='width:212.95pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:7.3pt 5.8pt 0cm 5.35pt;height:39.95pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.3pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>ANY </span></p>
  </td>
  <td width=355 valign=top style='width:213.0pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:7.3pt 5.8pt 0cm 5.35pt;height:39.95pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>和数据可以在集群的任何地方，而且不在一个机架中，性能最差。</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:.35pt;
margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;text-indent:
22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在调度执行时，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>调度总是会尽量让每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>以最高的本地性级别（<span lang=EN-US>PROCESS_LOCAL</span>）来启动，当一个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>以 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>X
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>本地性级别启动，但是该本地性级别（<span lang=EN-US>NODE_LOCAL</span>）对应的所有节点都没有空闲资源而启动失败<span
lang=EN-US>(</span>有可能在<span lang=EN-US>GC)</span>，此时并不会马上降低本地性级别启动而是在某个时间长度内再次以
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>X </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>本地性级别来启动该 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，若超过限时时间则降级启动，去尝试下一个本地性级别，依次类推。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
21.5pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>可以通过调大每个类别的最大容忍延迟时间，在等待阶段对应的
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>可能就会有相应的资源去执行此 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，这就在在一定程度上提到了运行性能。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3><span lang=EN-US>4.4.3</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span style='font-family:宋体'>失败重试与黑名单机制 <span
lang=EN-US><o:p></o:p></span></span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>除了选择合适的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>调度运行外，还需要监控 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的执行状态，前面也提到，与外部打交道的是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SchedulerBackend</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>被提交到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>启动执行后，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会将执行状态上报给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SchedulerBackend</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SchedulerBackend </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>则告诉 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>， </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>TaskScheduler </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>找到该 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>对应的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSetManager</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，并通知到该 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSetManager</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，这样 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>TaskSetManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>就知道 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的失败与成功状态，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>对于失败的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，会记录它失败的次数，如果失败次数还没有超过最大重试次数，那么就把它放回待调度的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>池子中，否则整个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Application </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>失败</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
30.55pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>在记录 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>失败次数过程中，会记录它上一次失败所在的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Executor Id </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>和 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Host</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，这样下次再调度这个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>时，会使用黑名单机制，避免它被调度到上一次失败的节点上，起到一定的容错作用</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。黑名单记录 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>上一次失败所在的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor Id </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Host</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，以及其对应的<span lang=EN-US>“</span>拉黑<span lang=EN-US>”</span>时间，<span
lang=EN-US>“</span>拉黑<span lang=EN-US>”</span>时间是指这段时间内不要再往这个节点上调度这个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>了。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h1 style='margin-top:0cm;margin-right:0cm;margin-bottom:19.25pt;margin-left:
-.25pt'><span lang=EN-US>5.</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>Spark Shuffle </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>解析</span> </h1>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:23.0pt;margin-left:
-.25pt'><span lang=EN-US>5.1 Shuffle </span><span style='font-family:黑体;
mso-bidi-font-family:黑体;font-weight:normal'>的核心要点</span> </h2>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:10.05pt;margin-left:
-.25pt'><span lang=EN-US>5.1.1 ShuffleMapStage </span><span style='font-family:
宋体;mso-bidi-font-family:宋体;font-weight:normal'>与 </span><span lang=EN-US>FinalStage
</span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:137.7pt;text-indent:-109.25pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_3503" o:spid="_x0000_i1048"
 type="#_x0000_t75" style='width:358.2pt;height:131.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image017.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5-1 ShuffleMapStage </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>与 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>FinalStage <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-family:"微软雅黑","sans-serif";mso-bidi-font-family:
微软雅黑'>分析：</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_8"
 o:spid="_x0000_i1047" type="#_x0000_t75" style='width:410.4pt;height:146.4pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image025.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:0cm;line-height:103%'><span lang=EN-US style='mso-fareast-font-family:
等线;mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在划分 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>时，最后一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>称为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>FinalStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，它本质上是一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResultStage</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>对象，前面的所有 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>被称为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ShuffleMapStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.45pt;margin-bottom:
.3pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>ShuffleMapStage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的结束伴随着 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>shuffle
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>文件的写磁盘</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
21.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>ResultStage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>基本上对应代码中的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>action
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>算子，即将一个函数应用在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的各个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>partition </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的数据集上，意味着一个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>job </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的运行结束</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-left:-.25pt'><span lang=EN-US>5.1.2 Shuffle </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>中的任务个数</span>
</h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:19.3pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:123%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>我们知道，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>分为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:
宋体'>阶段和 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>reduce </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体'>阶段，或者称之为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ShuffleRed
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>阶段和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ShuffleWrite
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>阶段，那么对于一次 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:
宋体'>过程和 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>reduce </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体'>过程都会由若干个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>来执行，那么 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>和 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduce task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>的数量是如何确定的呢？</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>假设 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>任务从 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HDFS </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>中读取数据，那么</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>初始 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>RDD </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>分区个数由该文件的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>split </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>个数决定</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>，也就是一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>split </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>对应生成的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，我们假设初始 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>partition </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>个数为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>N</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>初始 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>经过一系列算子计算后（假设没有执行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>repartition
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>coalesce </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>算子进</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>行重分区，则分区个数不变，仍为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>N</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，如果经过重分区算子，那么分区个数变为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>M</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），我们假设分区个数不变，当执行到 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>操作时，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>端的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>个数和 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>个数一致，即 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>为 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>N </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>个。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.45pt;margin-bottom:
.3pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>reduce </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>端的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>默认取 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>spark.default.parallelism </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>这个配置项的值作为分区数，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:21.25pt;
margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;line-height:
124%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:宋体;mso-bidi-font-family:宋体;color:red'>如果没有配置，则以 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>map </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>端的最后一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的分区数作为其分区数（也就是
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>N</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>），那么分区数就决定了
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>reduce </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>端的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的个数</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-left:-.25pt'><span lang=EN-US>5.1.3 reduce </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>端数据的读取</span><span
lang=EN-US><span style='mso-spacerun:yes'>  </span></span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:.25pt;
margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;text-indent:
-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>根据 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的划分我们知道，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>和 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>reduce </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>端 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>不在相同的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>中，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>位于 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ShuffleMapStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduce task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>位于 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>ResultStage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>会先执行，那么后执行的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>reduce
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>如何知道从哪里去拉取 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>落盘后的数据呢？</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> reduce </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端的数据拉取过程如下：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%;mso-list:l3 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>执行完毕后会将计算状态以及磁盘小文件位置等信息封装到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>mapStatue
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对象中，然后由本进程中的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MapOutPutTrackerWorker
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对象将 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>mapStatus </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>对象发送给 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进程的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>MapOutPutTrackerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>对象；</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.3pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:126%;mso-list:l3 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>reduce
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>开始执行之前会先让本进程中的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>MapOutputTrackerWorker </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>向 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Driver </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>进程中的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>MapoutPutTrakcerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>发动请求，请求磁盘小文件位置信息</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>；</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%;mso-list:l3 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>当所有的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Map
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>执行完毕后，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Driver </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进程中的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>MapOutPutTrackerMaster </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>就掌握了所有的磁盘小文件的位置信息</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>。此时 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MapOutPutTrackerMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会告诉 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MapOutPutTrackerWorker
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>磁盘小文件的位置信息；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:126%;mso-list:l3 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>完成之前的操作之后，由 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockTransforService
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>去 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor0 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>所在的节点拉数据，默认会启动五个子线程。每次拉取的数据量不能超过 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>48M</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>（</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduce task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>每次最多拉取 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>48M </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>数据，将拉来的数据存储到 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>内存的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>20%</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>内存中）。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:13.1pt;margin-left:
-.25pt'><span lang=EN-US>5.2 HashShuffle </span><span style='font-family:黑体;
mso-bidi-font-family:黑体;font-weight:normal'>解析</span> </h2>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'>2.0</span><span style='font-family:等线;
mso-ascii-font-family:Calibri;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
Calibri'>版本之后，</span><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'>HashShuffle</span><span style='font-family:
等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:Calibri'>就没有了。</span><span lang=EN-US style='mso-fareast-font-family:
等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
7.6pt;margin-left:21.5pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>以下的讨论都假设每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>有 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>CPU core</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>1. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>未经优化的 </span><span lang=EN-US style='font-size:11.0pt;
line-height:107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;
font-weight:normal'>HashShuffleManager <o:p></o:p></span></h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_9"
 o:spid="_x0000_i1046" type="#_x0000_t75" style='width:444pt;height:300pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image026.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle write </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>阶段，主要就是在一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>结束计算之后，为了下一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>可以执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>类的算子（比如 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduceByKey</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），而将每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>处理的数据按 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>key </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>进行<span
lang=EN-US>“</span>划分<span lang=EN-US>”</span>。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>所谓<span lang=EN-US>“</span>划分<span lang=EN-US>”</span>，就是对相同的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>key </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>执行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>hash </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>算法，从而将相同 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>key </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>都写入同一个磁盘文件中，而每一个磁盘文件都只属于下游
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>stage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。在将数据写入磁盘之前，会先将数据写入内存缓冲中，当内存缓冲填满之后，才会溢写到磁盘文件中去。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:3.0pt;margin-bottom:2.85pt;
margin-left:0cm'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'><span
style='mso-spacerun:yes'> </span><span style='mso-spacerun:yes'>   </span></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>下一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:#7030A0'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>有多少个，当前
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>stage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>的每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>就要创建多少份磁盘文件</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。比如下一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>总共有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>100 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么当前 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>的每个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>都要创建 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>100
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>份磁盘文件。如果当前 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>有 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>50 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>，总共有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>10 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>，那么每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>上总共就要创建 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>500 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>个磁盘文件，所有 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>上会创建 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5000 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>个磁盘文件。由此可见，未经优化的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle write </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>操作所产生的磁盘文件的数量是极其惊人的。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle read </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>阶段，通常就是一个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>刚开始时要做的事情。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>此时该 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>stage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的每一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>就需要将上一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>stage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的计算结果中的所有相同 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>key</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，从各个节点上通过网络都拉取到自己所在的节点上，然后进行
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>key </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的聚合或连接等操作</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>。由于 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
write </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的过程中，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>map
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>给下游 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>reduce task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>都创建了一个磁盘文件，因此 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
read </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的过程中，每个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>reduce
task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>只要从上游 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的所有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>map task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>所在节点上，拉取属于自己的那一个磁盘文件即可。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>shuffle read </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的拉取过程是一边拉取一边进行聚合的</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle read task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>都会有一个自己的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>buffer </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>缓冲，每次都只能拉取与 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>buffer </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>缓冲相同大小的数据，然后通过内存中的一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Map </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进行聚合等操作。聚合完一批数据后，再拉取下一批数据，并放到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>buffer
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>缓冲中进行聚合操作。以此类推，直到最后将所有数据到拉取完，并得到最终的结果。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>未优化的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HashShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>工作原理如图 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1-7 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:15.35pt;
margin-bottom:10.85pt;margin-left:.5pt;text-align:right;text-indent:-.5pt;
line-height:103%'><span lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_4113"
 o:spid="_x0000_i1045" type="#_x0000_t75" style='width:424.2pt;height:226.2pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image027.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-7 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>未优化的 </span><span lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>HashShuffleManager </span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>工作原理</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>2. </span><span
style='font-size:11.0pt;line-height:107%;font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑;font-weight:normal'>优化后的</span><span lang=EN-US
style='font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial;font-weight:normal'> HashShuffleManager <o:p></o:p></span></h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_10"
 o:spid="_x0000_i1044" type="#_x0000_t75" style='width:444pt;height:265.8pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image028.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:21.95pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>为了优化 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HashShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>我们可以设置一个参数， </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>spark.shuffle.
consolidateFiles</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，该参数默认值为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>false</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，将其设置为 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>true </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>即可开启优化机制，通常来说，如果我们使用 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>HashShuffleManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么都建议开启这个选项。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>开启 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>consolidate
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>机制之后，在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
write </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>过程中，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>就不是为下游 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>创建一个磁盘文件了，此时会出现 </span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>shuffleFileGroup </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的概念，</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>shuffleFileGroup </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>会对应一批磁盘文件，磁盘文件的数量与下游
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>stage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>数量是相同的</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>上有多少个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>CPU core</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，就可以并行执行多少个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>而第一批并行执行的每个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>都会创建一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>shuffleFileGroup</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，并将数据写入对应的磁盘文件内</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>当 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>CPU core </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>执行完一批 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>，接着执行下一批 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>时，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>下一批 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>就会复用之前已有的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>shuffleFileGroup</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，包括其中的磁盘文件</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，也就是说，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>此时 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>会将数据写入已有的磁盘文件中，而不会写入新的磁盘文件中</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>。因此，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>consolidate </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>机制允许不同的 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>复用同一批磁盘文件，这样就可以有效将多个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的磁盘文件进行一定程度上的合并，从而大幅度减少磁盘文件的数量，进而提升
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>shuffle write </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的性能</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>假设第二个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>stage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>有 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>100 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>，第一个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>stage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>有 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>50
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，总共还是有 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>10 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
CPU </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>个数为 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>执行 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>task</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。那么原本使用未经优化的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HashShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>时，每个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>会产生 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>500 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>个磁盘文件，所有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>会产生 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>5000
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>个磁盘文件的。但是此时经过优化之后，每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>创建的磁盘文件的数量的计算公式为：</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>CPU core </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的数量</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> * </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>下一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>stage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>数量</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，也就是说，每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>此时只会创建 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>100 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>个磁盘文件，所有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>只会创建 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1000
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>个磁盘文件。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>优化后的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HashShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>工作原理如图 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1-8 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:15.35pt;
margin-bottom:25.65pt;margin-left:.5pt;text-align:right;text-indent:-.5pt;
line-height:103%'><span lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_4325"
 o:spid="_x0000_i1043" type="#_x0000_t75" style='width:425.4pt;height:226.8pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image029.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-8 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>优化后的 </span><span lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>HashShuffleManager </span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>工作原理 </span><span lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>d </span></p>

<h2 style='margin-left:-.25pt'><span lang=EN-US>5.3 SortShuffle </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>解析</span> </h2>

<p class=MsoNormal><span style='font-family:等线;mso-ascii-font-family:Calibri;
mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:Calibri'>现在默认是这种</span><span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'>Shuffle</span><span
style='font-family:等线;mso-ascii-font-family:Calibri;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:Calibri'>。</span><span lang=EN-US
style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SortShuffleManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的运行机制主要分成两种，一种是普通运行机制，另一种是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>bypass </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>运行机制。当 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle read task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的数量小于等于 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>spark.shuffle.sort. </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
6.9pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>bypassMergeThreshold </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>参数的值时（默认为 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>200</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>），就会启用 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>bypass </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>机制。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>1. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>普通运行机制</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span><span style='font-size:11.0pt;line-height:107%;font-family:
"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑;font-weight:normal'>（先排序，然后写入磁盘，内存损耗大）</span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在该模式下，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>数据会先写入一个内存数据结构中</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，此时根据不同的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>算子，可能选用不同的数据结构。如果是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>reduceByKey
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>这种聚合类的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>算子，那么会选用 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>数据结构，一边通过 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Map </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>进行聚合，一边写入内存；如果是
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>join </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>这种普通的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>算子，那么会选用 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Array </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>数据结构，直接写入内存。接着，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>每写一条数据进入内存数据结构之后，就会判断一下，是否达到了某个临界阈值</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>如果达到临界阈值的话，那么就会尝试将内存数据结构中的数据溢写到磁盘，然后清空内存数据结构</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>在溢写到磁盘文件之前，会先根据
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>key </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>对内存数据结构中已有的数据进行排序。排序过后，会分批将数据写入磁盘文件</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。默认的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>batch </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>数量是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>10000
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>条，也就是说，排序好的数据，会以每批 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>万条数据的形式分批写入磁盘文件。写入磁盘文件是通过 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BufferedOutputStream
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>实现的。</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BufferedOutputStream
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的缓冲输出流，首先会将数据缓冲在内存中，当内存缓冲满溢之后再一次写入磁盘文件中，这样可以减少磁盘 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>IO
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>次数，提升性能。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>将所有数据写入内存数据结构的过程中，会发生多次磁盘溢写操作，也就会产生多个临时文件</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>最后会将之前所有的临时磁盘文件都进行合并，这就是
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>merge </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>过程，此时会将之前所有临时磁盘文件中的数据读取出来，然后依次写入最终的磁盘文件之中</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。此外，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>由于一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>就只对应一个磁盘文件，也就意味着该 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>为下游
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>stage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>准备的数据都在这一个文件中，因此还会单独写一份索引文件，其中标识了下游各个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>的数据在文件中的
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>start offset </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>与 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>end offset</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>（即索引文件记录着</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>ReduceTask</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>的数据的位置信息）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SortShuffleManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>由于有一个磁盘文件 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>merge </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的过程，因此大大减少了文件数量。比如第一个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>stage </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>50 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，总共有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>10 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>执行 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>5 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，而第二个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>stage </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>有 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>100
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。由于每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>最终只有一个磁盘文件，因此此时每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>上只有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>个磁盘文件，所有 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>只有 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>50
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>个磁盘文件。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
4.1pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>普通运行机制的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SortShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>工作原理如图 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1-9 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:105.4pt;text-indent:-67.7pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_4530" o:spid="_x0000_i1042"
 type="#_x0000_t75" style='width:340.2pt;height:320.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image030.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-9 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>普通运行机制的 </span><span lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>SortShuffleManager </span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:宋体;mso-bidi-font-family:
宋体'>工作原理</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>2.
bypass </span><span style='font-size:11.0pt;line-height:107%;font-family:黑体;
mso-bidi-font-family:黑体;font-weight:normal'>运行机制</span><span style='font-size:
11.0pt;line-height:107%;font-family:"Arial","sans-serif";mso-fareast-font-family:
Arial;font-weight:normal'> </span><span style='font-size:11.0pt;line-height:
107%;font-family:"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑;font-weight:
normal'>（不排序）</span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>bypass </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>运行机制的触发条件如下：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.65pt;margin-bottom:
.25pt;margin-left:42.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-21.0pt;line-height:125%;mso-list:l10 level1 lfo9'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
map task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>数量小于 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>spark.shuffle.sort.bypassMergeThreshold
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>参数的值。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.65pt;margin-bottom:
.35pt;margin-left:42.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-21.0pt;line-height:126%;mso-list:l10 level1 lfo9'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>不是聚合类的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>算子。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>此时，</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>每个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>会为每个下游 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>都创建一个临时磁盘文件，并将数据按 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>key </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>进行
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>hash </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>然后根据 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>key </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:#7030A0'>hash
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>值，将 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>key </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>写入对应的磁盘文件之中</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。当然，写入磁盘文件时也是先写入内存缓冲，缓冲写满之后再溢写到磁盘文件的。最后，同样会将所有临时磁盘文件都合并成一个磁盘文件，并创建一个单独的索引文件。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
2.6pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>该过程的磁盘写机制其实跟未经优化的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>HashShuffleManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>是一模一样的，因为都要创建数量惊人的磁盘文件，只是在最后会做一个磁盘文件的合并而已</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。因此少量的最终磁盘文件，也让该机制相对未经优化的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>HashShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>来说，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
read </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的性能会更好。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>而该机制与普通 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SortShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>运行机制的不同在于：第一，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>磁盘写机制不同</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>；第二，</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>不会进行排序</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。也就是说，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>启用该机制的最大好处在于，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>shuffle write </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>过程中，不需要进行数据的排序操作，也就节省掉了这部分的性能开销</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
4.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>普通运行机制的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SortShuffleManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>工作原理如图 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>1-10 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:0cm;
margin-bottom:35.2pt;margin-left:.5pt;text-align:right;text-indent:-.5pt;
line-height:103%'><span lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_4648"
 o:spid="_x0000_i1041" type="#_x0000_t75" style='width:441.6pt;height:283.8pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image031.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-10 bypass </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>运行机制的 </span><span lang=EN-US style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>SortShuffleManager </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>工作原理</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h1 style='margin-left:-.25pt'><span lang=EN-US>6.</span><span lang=EN-US
style='font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span
lang=EN-US>Spark </span><span style='font-family:宋体;mso-bidi-font-family:宋体;
font-weight:normal'>内存管理</span> </h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.0pt;margin-bottom:
21.4pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在执行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的应用程序时，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>集群会启动</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>和</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>两种</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> JVM </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>进程，前者为主控进程，负责创建</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>上下文，提交</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>作业（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Job</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），并将作业转化为计算任务（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Task</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），在各个</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进程间协调任务的调度，后者负责在工作节点上执行具体的计算任务，并将结果返回给</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Driver</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，同时为需要持久化的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>提供存储功能。由于</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的内存管理相对来说较为简单，本节主要对</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的内存管理进行分析，下文中的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>内存均特指</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的内存。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:13.3pt;margin-left:
-.25pt'><span lang=EN-US>6.1 </span><span style='font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>堆内和堆外内存规划</span> </h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>作为一个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>进程，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的内存管理建立在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的内存管理之上，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的堆内（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>On-heap</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>）空间进行了更为详细的分配，以充分利用内存</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。同时，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>引入了堆外（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Off-heap</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）内存，使之可以直接在工作节点的系统内存中开辟空间，进一步优化了内存的使用</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:5.9pt;
margin-left:21.5pt;text-indent:-.5pt'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>堆内内存受到
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#7030A0'>JVM </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>统一管理，堆外内存是直接向操作系统进行内存的申请和释放</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:92.3pt;margin-bottom:
6.3pt;margin-left:146.1pt;text-indent:-71.2pt;line-height:145%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_4790" o:spid="_x0000_i1040"
 type="#_x0000_t75" style='width:265.2pt;height:205.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image032.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:145%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:145%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:145%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-1 Executor </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:145%;font-family:
宋体;mso-bidi-font-family:宋体'>堆内与堆外内存</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:145%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>1. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>堆内内存</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>堆内内存的大小，由</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>应用程序启动时的</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:宋体;mso-bidi-font-family:宋体'>– </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>executor-memory
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>或</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
spark.executor.memory </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>参数配置。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>内运行的并发任务共享</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> JVM </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>堆内内存，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>这些任务在缓存</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>数据和广播（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Broadcast</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）数据时占用的内存被规划为存储（ </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Storage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）内存</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>，而</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>这些任务在执行</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Shuffle </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>时占用的内存被规划为执行（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Execution</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>）内存，剩余的部分不做特殊规划</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>那些</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>内部的对象实例，或者用户定义的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>应用程序中的对象实例，均占用剩余的空间</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。不同的管理模式下，这三部分占用的空间大小各不相同。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>对堆内内存的管理是一种逻辑上的<span lang=EN-US>”</span></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>规划式</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>”</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的管理，因为对象实例占用内存的申请和释放都由</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>完成，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>只能在申请后和释放前记录这些内存，我们来看其具体流程：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>申请内存流程如下：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.25pt;margin-left:39.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:125%;mso-list:l13 level1 lfo10'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>在代码中</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> new </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>一个对象实例；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:39.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:126%;mso-list:l13 level1 lfo10'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>JVM
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>从堆内内存分配空间，创建对象并返回对象引用（可能<span
lang=EN-US>JVM</span>还没有回收）；</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:39.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-18.0pt;line-height:126%;mso-list:l13 level1 lfo10'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>保存该对象的引用，记录该对象占用的内存。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>释放内存流程如下：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:42.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-21.0pt;line-height:126%;mso-list:l5 level1 lfo11'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>记录该对象释放的内存，删除该对象的引用；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:42.0pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-21.0pt;line-height:126%;mso-list:l5 level1 lfo11'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>等待 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>JVM </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的垃圾回收机制释放该对象占用的堆内内存。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>我们知道，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>JVM </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的对象可以以序列化的方式存储，序列化的过程是将对象转换为二进制字节流，本质上可以理解为将非连续空间的链式存储转化为连续空间或块存储，在访问时则需要进行序列化的逆过程<span
lang=EN-US>——</span>反序列化，将字节流转化为对象，序列化的方式可以节省存储空间，但增加了存储和读取时候的计算开销。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对于</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中序列化的对象，由于是字节流的形式，其占用的内存大小可直接计算</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>而对于非序列化的对象，其占用的内存是通过周期性地采样近似估算而得，即并不是每次新增的数据项都会计算一次占用的内存大小，这种方法降低了时间开销但是有可能误差较大，导致某一时刻的实际内存有可能远远超出预期</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。此外</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>，在被</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>标记为释放的对象实例，很有可能在实际上并没有被</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'> JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>回收，导致实际可用的内存小于</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>记录的可用内存</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。所以</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Spark </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>并不能准确记录实际可用的堆内内存，从而也就无法完全避免内存溢出（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>OOM,
Out of Memory</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>）的异常</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>虽然不能精准控制堆内内存的申请和释放，但</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>通过对存储内存和执行内存各自独立的规划管理，可以决定是否要在存储内存里缓存新的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>，以及是否为</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
7.05pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>新的任务分配执行内存，在一定程度上可以提升内存的利用率，减少异常的出现。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>2. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>堆外内存</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
.2pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>为了进一步优化内存的使用以及提高</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>时排序的效率，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>引入了堆外（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Off-heap</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）内存，使之可以直接在工作节点的系统内存中开辟空间，存储经过序列化的二进制数据</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:2.2pt;
margin-left:-.75pt;text-indent:23.05pt'><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:#7030A0'>堆外内存意味着把内存对象分配在 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#7030A0'>Java </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体;color:#7030A0'>虚拟机的堆以外的内存，这些内存直接受操作系统管理（而不是虚拟机）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>这样做的结果就是能保持一个较小的堆，以减少垃圾收集对应用的影响</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.1pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>利用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
JDK Unsafe API</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>（从</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark 2.0 </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>开始，在管理堆外的存储内存时不再基于</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Tachyon</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，而是与堆外的执行内存一样，基于</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
JDK Unsafe API </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>实现），</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>可以直接操作系统堆外内存，减少了不必要的内存开销，以及频繁的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> GC </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>扫描和回收，提升了处理性能</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>堆外内存可以被精确地申请和释放</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>（堆外内存之所以能够被精确的申请和释放，是由于内存的申请和释放不再通过 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>JVM
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>机制，而是直接向操作系统申请，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#7030A0'>JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:#7030A0'>对于内存的清理是无法准确指定时间点的，因此无法实现精确的释放</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>）</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，而且序列化的数据占用的空间可以被精确计算，所以相比堆内内存来说降低了管理的难度，也降低了误差</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:9.85pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在默认情况下堆外内存并不启用，可通过配置</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
spark.memory.offHeap.enabled </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>参数启用，并由</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
spark.memory.offHeap.size </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>参数设定堆外空间的大小。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>除了没有</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
other </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>空间，堆外内存与堆内内存的划分方式相同，所有运行中的并发任务共享存储内存和执行内存</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-bottom:21.3pt;text-indent:9.85pt;line-height:
126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:#A5A5A5'>*</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>该部分内存主要用于程序的共享库、</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#A5A5A5'>Perm Space</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>、线程
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:#A5A5A5'>Stack </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:#A5A5A5'>和一些 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:#A5A5A5'>Memory mapping </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>等</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:#A5A5A5'>,
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>或者类 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#A5A5A5'>C </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>方式 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:#A5A5A5'>allocate object</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:#A5A5A5'>）</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:#A5A5A5'>
</span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:14.95pt;margin-left:
-.25pt'><span lang=EN-US>6.2 </span><span style='font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>内存空间分配</span> </h2>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>1. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>静态内存管理</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>最初采用的静态内存管理机制下，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>存储内存、执行内存和其他内存的大小在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>应用程序运行期间均为固定的</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>但用户可以应用程序启动前进行配置</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，堆内内存的分配如图</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 2 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-align:justify;text-justify:inter-ideograph;
line-height:113%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:113%;font-family:宋体;mso-bidi-font-family:宋体'>（<span lang=EN-US>Other</span>存储<span
lang=EN-US>Spark</span>的元数据，以及没有被<span lang=EN-US>cache</span>的数据；<span
lang=EN-US>Execution</span>内存保存<span lang=EN-US>Shuffle</span>阶段所使用的内存，比如<span
lang=EN-US>Map</span>、<span lang=EN-US>Reduce</span>的缓冲区；<span lang=EN-US>Storage</span>存储所有缓存的<span
lang=EN-US>RDD</span>数据、广播变量的数据（广播变量是一个<span lang=EN-US>Node</span>一份数据，这个<span
lang=EN-US>Node</span>不是节点<span lang=EN-US>Worker</span>，而是<span lang=EN-US>Executor</span>，源码是这样子的</span>））<span
lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:52.45pt;margin-bottom:
11.15pt;margin-left:139.8pt;text-indent:-104.65pt;line-height:105%'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:105%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'> </span></span><span lang=EN-US style='mso-no-proof:
yes'><v:shape id="Picture_x0020_5140" o:spid="_x0000_i1039" type="#_x0000_t75"
 style='width:324pt;height:186pt;visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image033.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-2 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:宋体;mso-bidi-font-family:
宋体'>静态内存管理<span lang=EN-US>——</span>堆内内存</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
6.2pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>可以看到，可用的堆内内存的大小需要按照代码清单
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>1-1 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的方式计算：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:4.4pt;margin-left:0cm;text-align:center'><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体'>代码清单 </span><span lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Arial","sans-serif";mso-fareast-font-family:
Arial'>1-1 </span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:黑体;mso-bidi-font-family:黑体'>堆内内存计算公式</span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:28.3pt;margin-bottom:
0cm;margin-left:-.25pt;margin-bottom:.0001pt;text-indent:-.5pt;background:#E0E0E0'><span
style='font-size:8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>可用的存储内存</span><span lang=EN-US style='font-size:
8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Courier New";
mso-fareast-font-family:"Courier New"'> = systemMaxMemory *
spark.storage.memoryFraction * spark.storage.safety </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:28.3pt;margin-bottom:
1.0pt;margin-left:-.25pt;text-indent:-.5pt;background:#E0E0E0'><span
lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Courier New";mso-fareast-font-family:"Courier New"'>Fraction </span><span
style='font-size:8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>可用的执行内存</span><span lang=EN-US style='font-size:
8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Courier New";
mso-fareast-font-family:"Courier New"'> = systemMaxMemory *
spark.shuffle.memoryFraction * spark.shuffle.safety </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:28.3pt;margin-bottom:
9.05pt;margin-left:-.25pt;text-indent:-.5pt;background:#E0E0E0'><span
lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Courier New";mso-fareast-font-family:"Courier New"'>Fraction </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>其中</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
systemMaxMemory </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>取决于当前</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>堆内内存的大小，最后可用的执行内存或者存储内存要在此基础上与各自的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
memoryFraction </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>参数和</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> <span
lang=EN-US>safetyFraction </span></span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>参数相乘得出。上述计算公式中的两个</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> safetyFraction </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>参数，其意义在于在逻辑上预留出</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
1-safetyFraction </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>这么一块保险区域，降低因实际内存超出当前预设范围而导致</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
OOM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的风险（上文提到，对于非序列化对象的内存采样估算会产生误差）。值得注意的是，这个预留的保险区域仅仅是一种逻辑上的规划，在具体使用时</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>并没有区别对待，和<span
lang=EN-US>”</span>其它内存<span lang=EN-US>”</span>一样交给了</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> JVM </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>去管理。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Storage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>内存和 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Execution
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>内存都有预留空间，目的是防止 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>OOM</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，因为 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>堆内内存大小的记录是不准确的，需要留出保险区域</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>堆外的空间分配较为简单，只有存储内存和执行内存，如图
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>1-3 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>所示。可用的执行内存和存储内存占用的空间大小直接由参数
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>spark.memory.storageFraction </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>决定，</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>由于堆外内存占用的空间可以被精确计算，所以无需再设定保险区域</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:77.4pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_5241" o:spid="_x0000_i1038"
 type="#_x0000_t75" style='width:313.2pt;height:148.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image034.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.8pt;
margin-bottom:10.8pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-3 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>静态内存管理</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
6.55pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>静态内存管理机制实现起来较为简单，但</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>如果用户不熟悉</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的存储机制，或没有根据具体的数据规模和计算任务或做相应的配置，很容易造成</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>”</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>一半海水，一半火焰</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>”</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的局面，即存储内存和执行内存中的一方剩余大量的空间，而另一方却早早被占满，不得不淘汰或移出旧的内容以存储新的内容</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。由于新的内存管理机制的出现，这种方式目前已经很少有开发者使用，出于兼容旧版本的应用程序的目的，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>仍然保留了它的实现。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>3. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>统一<span lang=EN-US>(</span>动态<span lang=EN-US>)</span>内存管理</span><span
style='font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial;font-weight:normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
4.05pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark 1.6 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>之后引入的统一内存管理机制，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>与静态内存管理的区别在于存储内存<span lang=EN-US>(Storage)</span>和执行内存<span
lang=EN-US>(Execution)</span>共享同一块空间，可以动态占用对方的空闲区域</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，统一内存管理的堆内内存结构如图</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> 1-4 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:85.7pt;margin-bottom:
3.45pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
text-indent:36.35pt;line-height:126%'><span lang=EN-US style='mso-no-proof:
yes'><v:shape id="Picture_x0020_5322" o:spid="_x0000_i1037" type="#_x0000_t75"
 style='width:296.4pt;height:165.6pt;visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image035.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-4 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>统一内存管理<span lang=EN-US>——</span>堆内内存</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>统一内存管理的堆外内存结构如图</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> 1-5 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:78.25pt;margin-bottom:
.25pt;margin-left:23.05pt;text-indent:37.9pt;line-height:125%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_5341" o:spid="_x0000_i1036"
 type="#_x0000_t75" style='width:293.4pt;height:141pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image036.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-5 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>统一内存管理<span lang=EN-US>——</span>堆外内存</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>其中最重要的优化在于动态占用机制，其规则如下：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.6pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l15 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>设定基本的存储内存和执行内存区域（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>spark.storage.storageFraction
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>参数），该设定确定了双方各自拥有的空间的范围；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.6pt;margin-bottom:
.45pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:124%;mso-list:l15 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>双方的空间都不足时，则存储到硬盘；若己方空间不足而对方空余时，可借用对方的空间</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>;</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>（存储空间不足是指不足以放下一个完整的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Block</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>）</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.6pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l15 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>执行内存<span lang=EN-US>(Execution)</span>的空间被对方<span
lang=EN-US>(Storage)</span>占用后，可让对方将占用的部分转存到硬盘<span lang=EN-US>(</span>前提是要有<span
lang=EN-US>Disk</span>，没有<span lang=EN-US>Disk</span>就会直接删除，所以<span lang=EN-US>cache</span>一般结合<span
lang=EN-US>CheckPoint</span>使用<span lang=EN-US>)</span>，然后<span lang=EN-US>” </span>归还<span
lang=EN-US>”</span>借用的空间</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.6pt;margin-bottom:
.35pt;margin-left:22.65pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US>SparkCore</span><span style='font-family:
"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑'>的</span><span lang=EN-US>Checkpoint</span><span
style='font-family:"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑'>就是把数据存到分布式系统，而</span><span
lang=EN-US>SparkStreaming</span><span style='font-family:"微软雅黑","sans-serif";
mso-bidi-font-family:微软雅黑'>的</span><span lang=EN-US>checkpoint</span><span
style='font-family:"微软雅黑","sans-serif";mso-bidi-font-family:微软雅黑'>会把数据和数据运行的环境都保存</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.6pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l15 level1 lfo12'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>存储内存<span lang=EN-US>(Storage)</span>的空间被对方占用后，无法让对方<span
lang=EN-US>(Execution)</span>“归还<span lang=EN-US>”</span></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，因为需要考虑</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>过程中的很多因素，实现起来较为复杂。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> <span lang=EN-US>(</span></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>不够用，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Storage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>就使用</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>LRU</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>算法删除数据</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>)</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
4.3pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>统一内存管理的动态占用机制如图</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
1-6 </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>所示：</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:56.3pt;margin-bottom:
11.15pt;margin-left:131.35pt;text-indent:-92.45pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_5427" o:spid="_x0000_i1035"
 type="#_x0000_t75" style='width:337.2pt;height:136.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image037.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>1-6 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:宋体;mso-bidi-font-family:
宋体'>同一内存管理<span lang=EN-US>——</span>动态占用机制</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
21.45pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>凭借统一内存管理机制，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>在一定程度上提高了堆内和堆外内存资源的利用率，降低了开发者维护</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>内存的难度，但并不意味着开发者可以高枕无忧。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>如果存储内存的空间太大或者说缓存的数据过多，反而会导致频繁的全量垃圾回收，降低任务执行时的性能，因为缓存的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>数据通常都是长期驻留内存的</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。所以要想充分发挥</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的性能，需要开发者进一步了解存储内存和执行内存各自的管理方式和实现原理。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:14.95pt;margin-left:
-.25pt'><span lang=EN-US>6.3 </span><span style='font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>存储内存管理</span> </h2>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>1. RDD </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>的持久化机制</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>弹性分布式数据集（</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>）作为</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>最根本的数据抽象，是只读的分区记录（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Partition</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）的集合，只能基于在稳定物理存储中的数据集上创建，或者在其他已有的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>上执行转换（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Transformation</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）操作产生一个新的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> RDD</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>。转换后的</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>与原始的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>之间产生的依赖关系，构成了血统（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Lineage</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>凭借血统，</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>保证了每一个</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> RDD </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>都可以被重新恢复</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>。但</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的所有转换都是惰性的，即只有当一个返回结果给</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Driver </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的行动（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Action</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）发生时，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>才会创建任务读取</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> RDD</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>，然后真正触发转换的执行。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>在启动之初读取一个分区时，会先判断这个分区是否已经被持久化，如果没有则需要检查</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Checkpoint </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>或按照血统重新计算。所以如果一个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>上要执行多次行动，可以在第一次行动中使用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
persist </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>或</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
cache </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>方法，在内存或磁盘中持久化或缓存这个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>，从而在后面的行动时提升计算速度。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>事实上，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>cache
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>方法是使用默认的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
MEMORY_ONLY </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的存储级别将</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>持久化到内存，故缓存是一种特殊的持久化。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>堆内和堆外存储内存的设计，便可以对缓存</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> RDD </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>时使用的内存做统一的规划和管理</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的持久化由</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Storage </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>模块负责，实现了</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>与物理存储的解耦合。</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Storage
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>模块负责管理</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>在计算过程中产生的数据，将那些在内存或磁盘、在本地或远程存取数据的功能封装了起来</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。在具体实现时</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端和</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Storage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>模块构成了主从式的架构，即</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>为</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Master</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>端的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
BlockManager </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>为</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Slave</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.25pt;margin-bottom:
3.4pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Storage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>模块在逻辑上以</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Block </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>为基本存储单位，</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>RDD </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的每个</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Partition </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>经过处理后唯一对应一个</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Block</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>（</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockId </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的格式为</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
rdd_RDD-ID_PARTITION-ID </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>）。 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>端的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>负责整个</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>应用程序的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Block </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的元数据信息的管理和维护，而 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>端的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Slave </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>需要将</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Block </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的更新等状态上报到</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Master</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，同时接收</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Master </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的命令，例如新增或删除一个</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> RDD</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:74.05pt;
margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:right'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_5691" o:spid="_x0000_i1034"
 type="#_x0000_t75" style='width:319.8pt;height:165.6pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image038.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:29.05pt;
margin-bottom:10.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5-1 Storage </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>模块示意图</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
5.15pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在对</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>持久化时，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>规定了</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> MEMORY_ONLY</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>、</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>MEMORY_AND_DISK </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>等</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 7 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>种不同的</span><span lang=EN-US><a
href="http://spark.apache.org/docs/latest/programming-guide.html#rdd-persistence"><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:宋体;mso-bidi-font-family:宋体;color:black;text-decoration:none;
text-underline:none'><span lang=EN-US>存储级别</span></span></a><a
href="http://spark.apache.org/docs/latest/programming-guide.html#rdd-persistence"><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:black;
text-decoration:none;text-underline:none'> </span></a><a
href="http://spark.apache.org/docs/latest/programming-guide.html#rdd-persistence"><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:宋体;mso-bidi-font-family:宋体;color:black;text-decoration:none;
text-underline:none'><span lang=EN-US>，</span></span></a></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>而存储级别是以下</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 5 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>个变量的组合：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.9pt;
margin-bottom:2.55pt;margin-left:.5pt;text-align:center;text-indent:-.5pt'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
黑体;mso-bidi-font-family:黑体'>代码清单 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'>5-1 resourceOffer</span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体'>代码</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:196.25pt;margin-bottom:
9.05pt;margin-left:-.25pt;text-indent:-.5pt;background:#E0E0E0'><span
lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Courier New";mso-fareast-font-family:"Courier New"'>class StorageLevel
private( private var _useDisk: Boolean, //</span><span style='font-size:8.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>磁盘</span><span lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>
private var _useMemory: Boolean, //</span><span style='font-size:8.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>这里其实是指堆内内存</span><span lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>
private var _useOffHeap: Boolean, //</span><span style='font-size:8.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>堆外内存</span><span lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>
private var _deserialized: Boolean, //</span><span style='font-size:8.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>是否为非序列化</span><span lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>
private var _replication: Int = 1 //</span><span style='font-size:8.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>副本个数</span><span lang=EN-US style='font-size:8.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Courier New";mso-fareast-font-family:"Courier New"'>
) </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
6.0pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>中 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>7
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>种存储级别如下：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal align=center style='margin-top:0cm;margin-right:28.95pt;
margin-bottom:0cm;margin-left:.5pt;margin-bottom:.0001pt;text-align:center;
text-indent:-.5pt'><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:黑体;mso-bidi-font-family:黑体'>表 </span><span
lang=EN-US style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Arial","sans-serif";mso-fareast-font-family:Arial'>5-1 Spark</span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
黑体;mso-bidi-font-family:黑体'>持久化级别</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial;color:#222222'> </span></p>

<table class=TableGrid border=0 cellspacing=0 cellpadding=0 width=710
 style='width:425.95pt;margin-left:-5.3pt;border-collapse:collapse;mso-yfti-tbllook:
 1184;mso-padding-alt:2.6pt 0cm 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:17.45pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-bottom:solid #70AD47 2.25pt;padding:2.6pt 0cm 0cm 5.4pt;height:17.45pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:5.45pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>持久化级别 </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:solid #70AD47 1.0pt;
  border-left:none;border-bottom:solid #70AD47 2.25pt;border-right:solid #70AD47 1.0pt;
  mso-border-left-alt:solid #70AD47 1.0pt;padding:2.6pt 0cm 0cm 5.4pt;
  height:17.45pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:5.15pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>含义 </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:63.7pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 2.25pt;background:#DBEBD0;
  padding:2.6pt 0cm 0cm 5.4pt;height:63.7pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:5.6pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>MEMORY_ONLY </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 2.25pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:2.6pt 0cm 0cm 5.4pt;height:63.7pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center;line-height:122%'><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:122%;font-family:宋体;mso-bidi-font-family:宋体'>以非序列化的 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:宋体;mso-bidi-font-family:宋体'>对象的方式持久化在 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>JVM
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:宋体;mso-bidi-font-family:宋体'>内存中。如果内存无法完全存储 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  122%;font-family:宋体;mso-bidi-font-family:宋体'>所有的</span></p>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'>partition</span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>，那么那些没有持久化的 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>就会在下一次需要使用它们的时候，重新被计算</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:32.4pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:2.6pt 0cm 0cm 5.4pt;
  height:32.4pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:5.45pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>MEMORY_AND_DISK </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:2.6pt 0cm 0cm 5.4pt;height:32.4pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:-.1pt;margin-bottom:
  0cm;margin-left:.85pt;margin-bottom:.0001pt;text-align:justify;text-justify:
  inter-ideograph;text-indent:-.85pt'><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>同上，但是当某些 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>无法存储在内存中时，会持久化到磁盘中。下次需要使用这些 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>partition</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:16.75pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:2.6pt 0cm 0cm 5.4pt;
  height:16.75pt'>
  <p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:2.6pt 0cm 0cm 5.4pt;height:16.75pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>时，需要从磁盘上读取</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:63.2pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:2.6pt 0cm 0cm 5.4pt;height:63.2pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.45pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>MEMORY_ONLY_SER </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:2.6pt 0cm 0cm 5.4pt;height:63.2pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center;line-height:120%'><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:120%;font-family:宋体;mso-bidi-font-family:宋体'>同 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  120%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MEMORY_ONLY</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:120%;
  font-family:宋体;mso-bidi-font-family:宋体'>，但是会使用 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:120%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  120%;font-family:宋体;mso-bidi-font-family:宋体'>序列化方式，将 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:120%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  120%;font-family:宋体;mso-bidi-font-family:宋体'>对象序列化后进行持久化。可以减少内存开销，但是需要进行反序列化，因此会加大</span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  120%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>CPU
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  120%;font-family:宋体;mso-bidi-font-family:宋体'>开销</span><span style='font-size:
  10.5pt;mso-bidi-font-size:11.0pt;line-height:120%;font-family:"Times New Roman","serif";
  mso-fareast-font-family:"Times New Roman"'> </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:120%'>(</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:120%'>序列化之后内存会更小，时间换空间<span
  lang=EN-US>)</span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:32.4pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:2.6pt 0cm 0cm 5.4pt;
  height:32.4pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.35pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>MEMORY_AND_DISK_SER </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:2.6pt 0cm 0cm 5.4pt;height:32.4pt'>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>同 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MEMORY_AND_DISK</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:宋体;mso-bidi-font-family:宋体'>，但是使用序列化方式持久化 </span><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Java
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:宋体;mso-bidi-font-family:宋体'>对象</span><span style='font-size:
  10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
  mso-fareast-font-family:"Times New Roman"'> </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:31.95pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;background:#DBEBD0;
  padding:2.6pt 0cm 0cm 5.4pt;height:31.95pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.5pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:等线;mso-bidi-font-family:等线'>DISK_ONLY </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  background:#DBEBD0;padding:2.6pt 0cm 0cm 5.4pt;height:31.95pt'>
  <p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
  margin-left:82.9pt;margin-bottom:.0001pt;text-indent:-82.8pt'><span
  lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  107%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><span
  style='mso-spacerun:yes'> </span></span><span style='font-size:10.5pt;
  mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
  宋体'>使用非序列化 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'>Java </span><span style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>对象的方式持久化，完全存储到磁盘上</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;mso-yfti-lastrow:yes;height:63.6pt'>
  <td width=328 valign=top style='width:196.7pt;border:solid #70AD47 1.0pt;
  border-top:none;mso-border-top-alt:solid #70AD47 1.0pt;padding:2.6pt 0cm 0cm 5.4pt;
  height:63.6pt'>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.25pt;
  margin-bottom:3.7pt;margin-left:0cm;text-align:center'><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>MEMORY_ONLY_2 </span></p>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.45pt;
  margin-bottom:3.7pt;margin-left:0cm;text-align:center'><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>MEMORY_AND_DISK_2 </span></p>
  <p class=MsoNormal align=center style='margin-top:0cm;margin-right:.4pt;
  margin-bottom:0cm;margin-left:0cm;margin-bottom:.0001pt;text-align:center'><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:等线;mso-bidi-font-family:等线'>等等 </span></p>
  </td>
  <td width=382 valign=top style='width:229.25pt;border-top:none;border-left:
  none;border-bottom:solid #70AD47 1.0pt;border-right:solid #70AD47 1.0pt;
  mso-border-top-alt:solid #70AD47 1.0pt;mso-border-left-alt:solid #70AD47 1.0pt;
  padding:2.6pt 0cm 0cm 5.4pt;height:63.6pt'>
  <p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
  1.55pt;line-height:121%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
  11.0pt;line-height:121%;font-family:"Times New Roman","serif";mso-fareast-font-family:
  "Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:121%;
  font-family:宋体;mso-bidi-font-family:宋体'>如果是尾部加了 </span><span lang=EN-US
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:121%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>2
  </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
  121%;font-family:宋体;mso-bidi-font-family:宋体'>的持久化级别，表示将持久化数据复用一份，保存到其他节点，从而在数据</span></p>
  <p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
  text-align:center'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
  line-height:107%;font-family:宋体;mso-bidi-font-family:宋体'>丢失时，不需要再次计算，只需要使用备份数据即可</span><span
  style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
  font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
  </span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:29.35pt;
margin-bottom:2.75pt;margin-left:.5pt;text-align:right;text-indent:-.5pt'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>通过对数据结构的分析，可以看出存储级别从三个维度定义了</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Partition</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>（同时也就是</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Block</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>）的存储方式：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l11 level1 lfo13'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>存储位置：磁盘／堆内内存／堆外内存。如</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
MEMORY_AND_DISK </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>是同时在磁盘和堆内内存上存储，实现了冗余备份。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>OFF_HEAP
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>则是只在堆外内存存储，目前选择堆外内存时不能同时存储到其他位置。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
2.75pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;mso-list:l11 level1 lfo13'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>存储形式： </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Block </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体'>缓存到存储内存后，是否为非序列化的形式。如</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>MEMORY_ONLY </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>是非序列化方式存储，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>OFF_HEAP </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>是序列化方式存储。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
6.15pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l11 level1 lfo13'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>副本数量：大于</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 1 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>时需要远程冗余备份到其他节点。如</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> DISK_ONLY_2 </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>需要远程备份</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> 1 </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>个副本。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>2. RDD </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>的缓存过程</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> <span lang=EN-US><o:p></o:p></span></span></h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_12"
 o:spid="_x0000_i1033" type="#_x0000_t75" style='width:425.4pt;height:291pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image039.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>在缓存到存储内存之前，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Partition
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中的数据一般以迭代器（</span><span
lang=EN-US><a
href="http://www.scala-lang.org/docu/files/collections-api/collections_43.html"><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red;
text-decoration:none;text-underline:none'>Iterator</span></a><a
href="http://www.scala-lang.org/docu/files/collections-api/collections_43.html"><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:宋体;mso-bidi-font-family:宋体;color:red;text-decoration:none;
text-underline:none'><span lang=EN-US>）</span></span></a></span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的数据结构来访问，这是</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
Scala </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>语言中一种遍历数据集合的方法</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。通过</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Iterator </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>可以获取分区中每一条序列化或者非序列化的数据项</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>(Record)</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，这些</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Record </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>的对象实例在逻辑上占用了</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> JVM </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>堆内内存的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> other </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>部分的空间，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>同一</span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
Partition </span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的不同</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Record </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的存储空间并不连续</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>RDD </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>在缓存到存储内存之后，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Partition </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>被转换成</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Record </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>在堆内或堆外存储内存中占用一块连续的空间。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>将 </span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Partition
</span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>由不连续的存储空间转换为连续存储空间的过程，</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>称之为</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>&quot;</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>展开</span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>&quot;</span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>（</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Unroll</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>）</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Block
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>有序列化和非序列化两种存储格式，具体以哪种方式取决于该</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>的存储级别。非序列化的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>以一种</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
DeserializedMemoryEntry </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的数据结构定义，用一个数组存储所有的对象实例，序列化的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>则以</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
SerializedMemoryEntry </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的数据结构定义，用字节缓冲区（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>ByteBuffer</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>）来存储二进制数据。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>每个</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Executor </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Storage </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>模块用一个链式</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Map </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>结构（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>LinkedHashMap</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）来管理堆内和堆外存储内存中所有的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对象的实例，对这个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> LinkedHashMap </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>新增和删除间接记录了内存的申请和释放</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>因为不能保证存储空间可以一次容纳</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Iterator </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>中的所有数据，当前的计算任务在</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Unroll </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>时要向</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> MemoryManager </span></b><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>申请足够的</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Unroll </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>空间来临时占位，空间不足则</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Unroll </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>失败，空间足够时可以继续进行</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:.35pt;
margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;line-height:
126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:宋体;mso-bidi-font-family:宋体'>对于序列化的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Partition</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，其所需的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Unroll </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>空间可以直接累加计算，一次申请。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>对于非序列化的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Partition </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>则要在遍历</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Record </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>的过程中依次申请，即每读取一条</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Record</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，采样估算其所需的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Unroll </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>空间并进行申请，空间不足时可以中断，释放已占用的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Unroll </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>空间。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.65pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>如果最终</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Unroll </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>成功，当前</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Partition </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>所占用的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Unroll </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>空间被转换为正常的缓存</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的存储空间，如下图所示。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:171.55pt;text-indent:-124.15pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_6260" o:spid="_x0000_i1032"
 type="#_x0000_t75" style='width:320.4pt;height:205.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image040.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:171.55pt;text-indent:-24.55pt;line-height:103%'><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>5-2 Spark Unroll </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
6.5pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>在静态内存管理时，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体'>在存储内存中专门划分了一块</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Unroll </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>空间，其大小是固定的，</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>统一内存管理时则没有对</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
Unroll </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>空间进行特别区分，当存储空间不足时会根据动态占用机制进行处理</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h3 style='margin-top:0cm;margin-right:0cm;margin-bottom:5.25pt;margin-left:
22.8pt'><span lang=EN-US style='font-size:11.0pt;line-height:107%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:normal'>3. </span><span
style='font-size:11.0pt;line-height:107%;font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>淘汰与落盘</span><span style='font-size:11.0pt;line-height:
107%;font-family:"Arial","sans-serif";mso-fareast-font-family:Arial;font-weight:
normal'> </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
.2pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>由于同一个</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Executor </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的所有的计算任务共享有限的存储内存空间，当有新的</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Block </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>需要缓存但是剩余空间不足且无法动态占用时，就要对</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> LinkedHashMap </span></b><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>中的旧</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Block </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进行淘汰（</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Eviction</span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>），而被淘汰的</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> Block </span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>如果其存储级别中同时包含存储到磁盘的要求，则要对其进行落盘（</span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Drop</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>），否则直接删除该</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Block</span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>存储内存的淘汰规则为：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:11.15pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:126%;mso-list:l8 level1 lfo14'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>被淘汰的旧</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>要与新</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
MemoryMode </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>相同，即同属于堆外或堆内内存；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:11.15pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:126%;mso-list:l8 level1 lfo14'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>新旧</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>不能属于同一个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>，避免循环淘汰；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:11.15pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:126%;mso-list:l8 level1 lfo14'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>旧</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> <span
lang=EN-US>Block </span></span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>所属</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>不能处于被读状态，避免引发一致性问题；</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.25pt;margin-left:11.15pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.85pt;line-height:125%;mso-list:l8 level1 lfo14'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>遍历</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
LinkedHashMap </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>中</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Block</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>，按照</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>最近最少使用（</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>LRU</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>）</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的顺序淘汰，直到满足新</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> Block </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>所需的空间。其中</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
LRU </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>是</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
LinkedHashMap </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的特性。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
23.95pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>落盘的流程则比较简单，如果其存储级别符合</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>_useDisk </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>为</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> true </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的条件，再根据其</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>_deserialized </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>判断是否是非序列化的形式，若是则对其进行序列化，最后将数据存储到磁盘，在</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Storage </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>模块中更新其信息。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h2 style='margin-top:0cm;margin-right:0cm;margin-bottom:14.95pt;margin-left:
-.25pt'><span lang=EN-US>6.4 </span><span style='font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>执行内存管理</span> </h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>执行内存主要用来存储任务在执行</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Shuffle </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>时占用的内存，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>是按照一定规则对</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> RDD </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>数据重新分区的过程，我们来看</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Write </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>和</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Read </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>两阶段对执行内存的使用：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
1.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:Wingdings;mso-fareast-font-family:
Wingdings;mso-bidi-font-family:Wingdings'>l</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle
Write (</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>即<span lang=EN-US>MapTask</span>，就<span
lang=EN-US>map</span>端执行的阶段</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>)</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.35pt;margin-bottom:
.35pt;margin-left:0cm;text-indent:22.6pt;line-height:126%;mso-list:l1 level1 lfo15'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>若在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>端选择</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>普通的排序方式</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，会采用</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> ExternalSorter </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>进行外排，在内存中存储数据时主要占用堆内执行空间（存放排序结果）。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:26.35pt;margin-bottom:
.25pt;margin-left:0cm;text-indent:22.6pt;line-height:125%;mso-list:l1 level1 lfo15'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>若在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> map </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>端选择</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Tungsten </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>的排序方式</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>(</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:windowtext'>Tungsten</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:windowtext'>钨丝计划：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>把堆内或堆外的内存进一步封装成内存页，数据放到内存页，获取需要提供哪一页、这一页中的偏移量，可提高效率、提升性能<span
lang=EN-US>)</span>，则采用</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> ShuffleExternalSorter </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>直接对以序列化形式存储的数据排序，在内存中存储数据时可以占用堆外或堆内执行空间，取决于用户是否开启了堆外内存以及堆外执行内存是否足够。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:Wingdings;mso-fareast-font-family:
Wingdings;mso-bidi-font-family:Wingdings'>l</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Arial","sans-serif";mso-fareast-font-family:Arial'> </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle
Read (</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>即<span lang=EN-US>ReduceTask</span>，就<span
lang=EN-US>reduce</span>端执行的阶段</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>)</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.65pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l14 level1 lfo16'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>在对</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> reduce </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>端的数据进行聚合时，要将数据交给</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Aggregator </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>处理，在内存中存储数据时占用堆内执行空间。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:14.65pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l14 level1 lfo16'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>如果需要进行最终结果排序，则要将再次将数据交给</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
ExternalSorter </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>处理，占用堆内执行空间。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> ExternalSorter </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>和</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Aggregator </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>会使用一种叫</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> AppendOnlyMap </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的哈希表在堆内执行内存中存储数据</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>，但在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Shuffle </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>过程中所有数据并不能都保存到该哈希表中，</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>当这个哈希表占用的内存会进行周期性地采样估算，当其大到一定程度，无法再从</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>
MemoryManager </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>申请到新的执行内存时，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>就会将其全部内容存储到磁盘文件中，这个过程被称为溢存</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>(Spill)</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>，溢存到磁盘的文件最后会被归并</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>(Merge)</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Shuffle Write </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>阶段中用到的</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Tungsten </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>是</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Databricks </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>公司提出的对</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>优化内存和</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> CPU </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>使用的计划（钨丝计划），解决了一些</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> JVM </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>在性能上的限制和弊端。</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>会根据</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Shuffle </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>的情况来自动选择是否采用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
Tungsten </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>排序。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:7.55pt;margin-bottom:
.2pt;margin-left:-.75pt;text-indent:22.65pt;line-height:125%'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Tungsten
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>采用的页式内存管理机制建立在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> MemoryManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>之上，即</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Tungsten </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对执行内存的使用进行了一步的抽象，这样在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Shuffle </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>过程中无需关心数据具体存储在堆内还是堆外</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>每个内存页用一个</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> MemoryBlock </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>来定义，并用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Object obj </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>和</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> long offset </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>这两个变量统一标识一个内存页在系统内存中的地址</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.05pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>堆内的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
MemoryBlock </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>是以</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
long </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>型数组的形式分配的内存，其</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
obj </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的值为是这个数组的对象引用，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>offset
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>是</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> long </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>型数组的在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> JVM </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>中的初始偏移地址，两者配合使用可以定位这个数组在堆内的绝对地址；堆外的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
MemoryBlock </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>是直接申请到的内存块，其</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
obj </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>为</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> null</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>offset </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>是这个内存块在系统内存中的</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> 64 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>位绝对地址。</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:124%'><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Spark
</span></b><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>用</span><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> MemoryBlock </span></b><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>巧妙地将堆内和堆外内存页统一抽象封装，并用页表</span></p>

<p class=MsoNormal style='margin-bottom:2.4pt'><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>(pageTable)</span></b><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>管理每个</span><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Task </span></b><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>申请到的内存页</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:107%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal align=right style='margin-top:0cm;margin-right:29.35pt;
margin-bottom:2.75pt;margin-left:.5pt;text-align:right;text-indent:-.5pt'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Tungsten
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>页式管理下的所有内存用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
64 </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
107%;font-family:宋体;mso-bidi-font-family:宋体'>位的逻辑地址表示，由页号和页内偏移量组成：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l4 level1 lfo17'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>页号：占</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 13 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>位，唯一标识一个内存页，</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在申请内存页之前要先申请空闲页号。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:0cm;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%;mso-list:l4 level1 lfo17'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;line-height:126%;font-family:Wingdings;
mso-fareast-font-family:Wingdings;mso-bidi-font-family:Wingdings'><span
style='mso-list:Ignore'>l<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>页内偏移量：占</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> 51 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>位，是在使用内存页存储数据时，数据在页内的偏移地址。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.05pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>有了统一的寻址方式，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>可以用</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> 64 </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>位逻辑地址的指针定位到堆内或堆外的内存，整个</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Shuffle
Write </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>排序的过程只需要对指针进行排序，并且无需反序列化，整个过程非常高效，对于内存访问效率和</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
CPU </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>使用效率带来了明显的提升。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.9pt;margin-bottom:
30.5pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的存储内存和执行内存有着截然不同的管理方式：</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>对于存储内存来说，
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Spark </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>用一个</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'> LinkedHashMap </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>来集中管理所有的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'> Block</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Block
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>由需要缓存的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> RDD </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Partition </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>转化而成</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>；</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>而对于执行内存，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>用</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> AppendOnlyMap </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>来存储</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Shuffle </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>过程中的数据，在</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> Tungsten </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>排序中甚至抽象成为页式内存管理，开辟了全新的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'> JVM </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>内存管理机制</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h1 style='margin-top:0cm;margin-right:0cm;margin-bottom:19.4pt;margin-left:
-.25pt'><span lang=EN-US>7.</span><span lang=EN-US style='font-family:"Arial","sans-serif";
mso-fareast-font-family:Arial'> </span><span lang=EN-US>Spark </span><span
style='font-family:宋体;mso-bidi-font-family:宋体;font-weight:normal'>核心组件解析</span>
</h1>

<h2 style='margin-left:-.25pt'><span lang=EN-US>7.1 BlockManager </span><span
style='font-family:黑体;mso-bidi-font-family:黑体;font-weight:normal'>数据存储与管理机制</span>
</h2>

<p class=MsoNormal style='text-indent:21.0pt;mso-char-indent-count:2.0'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;
font-family:宋体;mso-bidi-font-family:宋体'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>是整个<span lang=EN-US> Spark </span>底层负责数据存储与管理的一个组件，<span
lang=EN-US>Driver </span>和<span lang=EN-US>Executor </span>的所有数据都由对应的<span
lang=EN-US> BlockManager </span>进行管理。 <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>上有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManagerMaster</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，负责对各个节点上的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>内部管理的数据的元数据进行维护，比如 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>block
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的增删改等操作，都会在这里维护好元数据的变更。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>每个节点都有一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，每个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>创建之后，第一件事即使去向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManagerMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>进行注册，此时 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManagerMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会为其长难句对应的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManagerInfo</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:21.5pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>运行原理如下图所示：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:17.05pt;margin-bottom:
11.0pt;margin-left:157.95pt;text-indent:-158.6pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_6865" o:spid="_x0000_i1031"
 type="#_x0000_t75" style='width:415.8pt;height:268.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image041.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-1 BlockManager </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>原理</span><span style='font-size:9.0pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:19.3pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:123%'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManagerMaster
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>与 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体'>的关系非常像 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>NameNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>与 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DataNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>的关系，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>BlockManagerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>中保存中 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
123%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>内部管理数据的元数据，进行维护，当 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>BlockManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Block </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:123%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>增删改等操作时，都会在 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>BlockManagerMaster </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:123%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中进行元数据的变更</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>，这与 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>NameNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>维护 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DataNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>的元数据信息，</span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>DataNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>中数据发生变化时 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>NameNode </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:
宋体;mso-bidi-font-family:宋体'>中的元数据信息也会相应变化是一致的。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:123%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>每个节点上都有一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>中有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>3 </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>个非常重要的组件：</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>· </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>DiskStore</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：负责对磁盘数据进行读写；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>· </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MemoryStore</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>：负责对内存数据进行读写；</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:23.55pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>· </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockTransferService </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>：负责建立 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>到远程其他节点的</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的连接，负责对远程其他节点的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>的数据进行读写；</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>BlockManager </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>创建之后，做的第一件事就是向
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>BlockManagerMaster </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>进行注册，此时 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>BlockManagerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>会为其创建对应的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>BlockManagerInfo</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>（</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>的信息）</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:.35pt;
margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;line-height:
126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:宋体;mso-bidi-font-family:宋体'>使用 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>进行写操作时，比如说，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>RDD
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>运行过程中的一些中间数据，</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>或者我们手动指定了 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>persist()</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，会优先将数据写入内存中，如果内存大小不够，会使用自己的算法，将内存中的部分数据写入磁盘；此外，如果 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>persist()</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>指定了要 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>replica</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，那么会使用 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockTransferService </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>将数据 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>replicate </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>一份到其他节点的 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>上去。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>使用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>进行读操作时，比如说，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffleRead
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>操作，如果能从本地读</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:24.6pt;margin-bottom:
2.7pt;margin-left:-.25pt;text-align:justify;text-justify:inter-ideograph;
text-indent:-.5pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>取，就利用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>DiskStore
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>或者 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>MemoryStore
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>从本地读取数据，但是本地没有数据的话，那么会用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockTransferService
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>与有数据的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>建立连接，然后用 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockTransferService
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>从远程 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>读取数据；例如，</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>shuffle
Read </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>操作中，很有可能要拉取的数据在本地没有，那么此时就会到远程有数据的节点上，找那个节点的
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>BlockManager </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>来拉取需要的数据。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='text-indent:21.0pt;mso-char-indent-count:2.0'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>只要使用</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>执行了数据增删改的操作，那么必须将</span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> Block </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockStatus </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>上报到</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManagerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>，在</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManagerMaster </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>上会对指定</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManager </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockManagerInfo </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>内部的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> BlockStatus </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:
宋体;mso-bidi-font-family:宋体'>进行增删改操作，从而达到元数据的维护功能。</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:107%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
21.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>在保存缓存两份<span
lang=EN-US>(</span>副本<span lang=EN-US>)</span>的时候，当前<span lang=EN-US>Executor</span>的</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>会在当前的<span lang=EN-US>Executor</span>内存中存一份，另一份会通过</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>发送给另一个<span lang=EN-US>Executor</span>，由接收的那个<span
lang=EN-US>Executor</span>的</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>BlockManager</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>管理这个副本。</span></p>

<h2><span lang=EN-US>7.2 Spark </span><span style='font-family:黑体;mso-bidi-font-family:
黑体;font-weight:normal'>共享变量底层实现</span> </h2>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>一个非常重要的特性就是</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>共享变量</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.4pt;margin-bottom:
.25pt;margin-left:-.75pt;text-indent:22.55pt;line-height:125%'><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>默认情况下，如果在一个算子的函数中使用到了某个外部的变量，那么这个变量的值会</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>被拷贝到每个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>中</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>，此时每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>只能操作自己的那份变量副本。如果多个 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>task </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:
宋体'>想要共享某个变量，那么这种方式是做不到的。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
21.2pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>为此提供了两种共享变量，一种是 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Broadcast Variable</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>（</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>广播变量</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>），另一种是 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Accumulator</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>（</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>累加变量</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>）。</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Broadcast Variable </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>会将用到的变量，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>仅仅为每个节点拷贝一份</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，即每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>拷贝一份，更大的用途是优化性能，减少网络传输以及内存损耗。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Accumulator
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>则可以</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>让多个 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>task </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>共同操作一份变量</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>，主要可以进行累加操作。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Broadcast
Variable </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>是共享读变量，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>不能去修改它，而 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Accumulator
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>可以让多个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>操作一个变量。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3><span lang=EN-US>7.2.1 </span><span style='font-family:宋体'>广播变量 </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.2pt;margin-bottom:
.45pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.55pt;line-height:124%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>广播变量允许编程者在每个
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:124%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Executor </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>上保留外部数据的只读变量（多个<span lang=EN-US>task</span>公用），而不是给每个任务<span
lang=EN-US>(Task)</span>发送一个副本</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:124%;font-family:宋体;mso-bidi-font-family:宋体'>。</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:124%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'><span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_13"
 o:spid="_x0000_i1030" type="#_x0000_t75" style='width:444.6pt;height:185.4pt;
 visibility:visible;mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image042.png" o:title=""/>
</v:shape></span><span lang=EN-US style='mso-fareast-font-family:等线;mso-fareast-theme-font:
minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-fareast-font-family:等线;
mso-fareast-theme-font:minor-fareast'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.65pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>都会保存一份它所使用的外部变量的副本，当一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>上的多个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>都使用一个大型外部变量时，对于 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>内存的消耗是非常大的，因此，我们可以将大型外部变量封装为广播变量，此时一个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>保存一个变量副本，此 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>上的所有 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>共用此变量，不再是一个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>单独保存一个副本，这在一定程度上降低了 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>任务的内存占用。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:112.25pt;margin-bottom:
11.15pt;margin-left:159.55pt;text-indent:-64.75pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_7161" o:spid="_x0000_i1029"
 type="#_x0000_t75" style='width:225.6pt;height:139.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image043.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-2 task </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>使用外部变量</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:112.25pt;margin-bottom:
11.15pt;margin-left:166.85pt;text-indent:-74.35pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_7203" o:spid="_x0000_i1028"
 type="#_x0000_t75" style='width:230.4pt;height:142.2pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image044.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-3 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:宋体;mso-bidi-font-family:
宋体'>使用广播变量</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>还尝试使用高效的广播算法分发广播变量，以降低通信成本。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>提供的 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Broadcast Variable </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>是</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>只读的</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，并且在每个 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>上只会有一个副本，而不会为每个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>都拷贝一份副本，因此，</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>它的最大作用，就是减少变量到各个节点的网络传输消耗，以及在各个节点上的内存消耗</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。此外，</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>内部也使用了高效的广播算法来减少网络消耗。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>可以通过调用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SparkContext
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>broadcast()</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>方法来针对每个变量创建广播变量。然后在算子的函数内，使用到广播变量时，每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>只会拷贝一份副本了，每个 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>可以使用广播变量的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>value()</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>方法获取值。</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
3.8pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>在任务运行时，</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>并不获取广播变量，当 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>执行到</span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>使用广播变量的代码时，会向 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Executor </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的内存中请求广播变量，如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:136.6pt;text-indent:-97.7pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_7261" o:spid="_x0000_i1027"
 type="#_x0000_t75" style='width:337.2pt;height:220.8pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image045.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-4 task </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>向 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Executor </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>请求广播变量</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.15pt;margin-bottom:
.25pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:125%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:125%;font-family:宋体;mso-bidi-font-family:宋体'>之后 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Executor
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>会通过 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>BlockManager
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
125%;font-family:宋体;mso-bidi-font-family:宋体'>向 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>拉取广播变量，然后提供给 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:125%;font-family:
宋体;mso-bidi-font-family:宋体'>进行使用，如下图所示：</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:125%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:57.5pt;margin-bottom:
11.0pt;margin-left:132.05pt;text-indent:-91.95pt;line-height:103%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_7312" o:spid="_x0000_i1026"
 type="#_x0000_t75" style='width:334.8pt;height:218.4pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image046.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:103%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-5 Executor </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>从 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:103%;font-family:
宋体;mso-bidi-font-family:宋体'>拉取广播变量</span><span style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:103%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
20.95pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>广播大变量是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>中常用的基础优化方法，通过减少内存占用实现任务执行性能的提升。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<h3><span lang=EN-US>7.2.2 </span><span style='font-family:宋体'>累加器 </span></h3>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>累加器（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>accumulator</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>）：</span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Accumulator </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>是</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>仅仅被相关操作累加的变量</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，因此可以在并行中被有效地支持。它们可用于实现</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>计数器</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>（如 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>MapReduce</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>）或</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>总和计数</span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>
</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:23.45pt;margin-bottom:
.3pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:23.05pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Accumulator </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>是存在于 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Driver
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>端的，集群上运行的 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>task </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进行 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Accumulator </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的累加，随后把值发到
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Driver </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>端，在 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";color:red'>Driver </span><span style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体;color:red'>端汇总</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>（</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
UI </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>SparkContext
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>创建时被创建，即在 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>端被创建，因此它可以读取 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Accumulator
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>的数值），</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>由于 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Accumulator
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>存在于 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Driver </span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>端，从节点读取不到 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Accumulator </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>的数值</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman";color:red'>Spark </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体;color:red'>提供的 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>Accumulator
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>主要用于多个节点对一个变量进行共享性的操作</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>。 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Accumulator </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>只提供了累加的功能，但是却给我们提供了多个 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>task </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>对于同一个变量并行操作的功能，但是 </span><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";color:red'>task
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>只能对 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman";
color:red'>Accumulator </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体;color:red'>进行累加操作，不能读取它的值</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>，只有 </span><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Driver </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>程序可以读取 </span><span lang=EN-US style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Accumulator </span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
宋体;mso-bidi-font-family:宋体'>的值。</span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:23.05pt;text-align:justify;text-justify:inter-ideograph;
line-height:126%'><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Accumulator </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的底层原理如下图所示：</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:40.7pt;margin-bottom:
35.5pt;margin-left:170.55pt;text-indent:-147.9pt;line-height:105%'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="Picture_x0020_7444" o:spid="_x0000_i1025"
 type="#_x0000_t75" style='width:368.4pt;height:240pt;visibility:visible;
 mso-wrap-style:square'>
 <img src="09_SparkKernelExplain.files/image047.jpg" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:
宋体;mso-bidi-font-family:宋体'>图 </span><span lang=EN-US style='font-size:9.0pt;
mso-bidi-font-size:11.0pt;line-height:105%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>7-6 </span><span style='font-size:
9.0pt;mso-bidi-font-size:11.0pt;line-height:105%;font-family:宋体;mso-bidi-font-family:
宋体'>累加器原理</span><span style='font-size:9.0pt;mso-bidi-font-size:11.0pt;
line-height:105%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'> </span></p>

<h1><span lang=EN-US>8. </span><span style='font-family:宋体;mso-bidi-font-family:
宋体;font-weight:normal'>总结</span> </h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:29.25pt;margin-bottom:
.35pt;margin-left:-.75pt;text-align:justify;text-justify:inter-ideograph;
text-indent:22.65pt;line-height:126%'><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:11.0pt;line-height:126%;font-family:"Times New Roman","serif";
mso-fareast-font-family:"Times New Roman"'>Spark </span><span style='font-size:
10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:
宋体'>的内核原理对于更好的使用 </span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>完成开发任务有着非常重要的作用，在本课程的学习中，我们对
</span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;
line-height:126%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'>Spark </span><span style='font-size:10.5pt;mso-bidi-font-size:
11.0pt;line-height:126%;font-family:宋体;mso-bidi-font-family:宋体'>的部署模式、通信架构、任务调度机制、</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Shuffle
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>过程、内存管理机制以及 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>核心组件进行了详细分析，这些内容都是 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>最为重要的架构原理，希望在之后的学习中大家可以不断深化对于 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>内核架构的理解，在更高的层次上去使用 </span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;
font-family:"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'>Spark
</span><span style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:
126%;font-family:宋体;mso-bidi-font-family:宋体'>技术框架。</span><span
style='font-size:10.5pt;mso-bidi-font-size:11.0pt;line-height:126%;font-family:
"Times New Roman","serif";mso-fareast-font-family:"Times New Roman"'> </span></p>

</div>

</body>

</html>
